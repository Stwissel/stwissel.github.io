<!DOCTYPE html>
<html lang="en">
<head>
<title>Pattern in your Apex Controller - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - Pattern in your Apex Controller" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2018/12/pattern-in-your-apex-controller.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - Pattern in your Apex Controller" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2018,2019 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="A (software) design pattern is a general, reusable solution to a commonly occurring problem withing a given context. Christoper Alexander inspired the Gang of four to apply pattern to software and enu" />
<meta name="Keywords"
	content="Apex,Salesforce,Software," />
<meta name="Abstract"
	content="A (software) design pattern is a general, reusable solution to a commonly occurring problem withing a given context. Christoper Alexander inspired the Gang of four to apply pattern to software and enu" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shCore.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shThemeMidnight.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link href='//fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css' />
<link href='//fonts.googleapis.com/css?family=Ubuntu:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css' />
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

    <script> 
var $buoop = {notify:{e:-0.01,f:-0.01,o:-0.01,s:-0.01,c:-0.01},insecure:true,unsupported:true,api:5}; 
function $buo_f(){ 
 var e = document.createElement("script"); 
 e.src = "//browser-update.org/update.min.js"; 
 document.body.appendChild(e);
};
try {document.addEventListener("DOMContentLoaded", $buo_f,false)}
catch(e){window.attachEvent("onload", $buo_f)}
</script>

    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2018/">2018</a> <span class="divider">/</span></li>
  <li><a href="/blog/2018/12/">December</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/apex.html">Apex</a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/salesforce.html">Salesforce</a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/software.html">Software</a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2018/12/lwc-quick-overview.html"><i class="icon-hand-left"></i>Lightning Web Components (LWC) quick overview</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2019/01/avoid-the-clean-code-shock-with-pmd.html">Avoid the "Clean Code Shock" with PMD<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>Pattern in your Apex Controller</small></h1>
					<hr />
					<div><p>A (software) <a href="https://en.wikipedia.org/wiki/Software_design_pattern">design pattern</a> is a general, reusable solution to a commonly occurring problem withing a given context. <a href="https://en.wikipedia.org/wiki/Christopher_Alexander">Christoper Alexander</a> inspired the <a href="https://en.wikipedia.org/wiki/Design_Patterns">Gang of four</a> to apply pattern to software and enumerate 23 classic software pattern.</p> 
<p>This article discusses how to use some of them in the context of <a href="https://en.wikipedia.org/wiki/Salesforce.com#Apex">Apex</a> controllers.</p> 
<h3><a href="#the-context-same-same-but-different" id="the-context-same-same-but-different">The context: Same same, but different</a></h3> 
<p>You are creating an application to support construction on force.com that will serve multiple countries. Part of the requirements is to compute a risk score for any given project. While <a href="https://www.iso.org/news/2012/12/Ref1685.html">ISO standards</a> form the foundation of the assessment, each jurisdiction has some specialties that alter the logic eventually.</p> 
<p>This is just one of the requirements, you have many more that follow the <code>pattern</code> <a href="https://www.samesamebutdifferent.site/2017/08/same-same-but-different-origin/">Same Same - But different</a>.</p> 
<h3><a href="#patterns-used" id="patterns-used">Patterns used</a></h3> 
<ul> 
 <li><a href="https://en.wikipedia.org/wiki/Interface-based_programming">Interface based programming</a></li> 
 <li><a href="https://msdn.microsoft.com/en-us/library/aa480019.aspx">Metadata driven application design</a></li> 
 <li><a href="https://en.wikipedia.org/wiki/Facade_pattern">Facade pattern</a></li> 
 <li><a href="https://en.wikipedia.org/wiki/Factory_method_pattern">Factory pattern</a></li> 
</ul> 
<p>Besides those, you want to know <a href="https://trailhead.salesforce.com/en/search?keywords=%22Apex%20Enterprise%20Patterns%22">Apex Enterprise Patterns</a>. Go Trailhead and learn.</p><h3><a href="#the-details" id="the-details">The details</a></h3> 
<p>The Apex controller isn't used to retrieve records, that's the job of the <a href="https://developer.salesforce.com/docs/atlas.en-us.lightning.meta/lightning/data_service.htm">Lightning Data Service</a>. It is however used for auxiliary information, like the computation of the risk score or check which part of your component should be rendered or or or. Most of the functionality is needed elsewhere too (like compute risk score in a trigger), so coding it into a <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_annotation_AuraEnabled.htm"><code>@AuraEnabled</code></a> static method doesn't make much sense.</p> 
<p>Therefore the Apex controller is implemented as a <a href="https://en.wikipedia.org/wiki/Facade_pattern">Facade</a>. No actual logic is implemented, but execution is delegated to specific classes (sample below).</p> 
<p>The controller shouldn't contain logic to pick the concrete class, since each new country you start business in would require a change to the controller. Picking the right class is left to a <a href="https://en.wikipedia.org/wiki/Factory_method_pattern">factory</a>. A common approach for factories is to have a factory class with one factory method. You can design that class static or to be instantiated, depending on the amount of context your factory needs. In my case I used a static <code>RiskAssessmentFactory</code> class with a single static method <code>RiskAssessor getRiskAssessor(String countryId)</code> that would return?.</p> 
<p>An instance of an interface (e.g. <code>RiskAssessor</code>)! This is an important element of maintainability. A factory method should always return an (instance of an) <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_interfaces.htm">interface</a>. Not a base class or one specific class, but an interface. Returning a concrete class defeats the very purpose of the factory pattern, returning a base class limits the flexibility of your solution. Factory and Interface belong together like <a href="https://en.wikipedia.org/wiki/Laurel_and_Hardy">Stand and Ollie</a>, <a href="https://www.historyhit.com/julius-caesar-and-cleopatra-a-match-made-in-power/">Caesar and Cleopatra</a> or <a href="https://en.wikipedia.org/wiki/Peanut_butter_and_jelly_sandwich">peanut butter and jelly</a>.</p> 
<p>Repeat after me:</p> 
<h4><a href="#a-factory-method-returns-an-instance-of-an-interface" id="a-factory-method-returns-an-instance-of-an-interface">A factory method returns an instance of an interface</a></h4> 
<p>When you define your factory without interfaces, on each call a kitten must die and an <a href="https://plugon.us/theartist/a-unicorn-candle-that-cries-rainbows-e7631">unicorn cries</a>.</p> 
<h3><a href="#where-does-the-metadata-fit-in" id="where-does-the-metadata-fit-in">Where does the metadata fit in?</a></h3> 
<p>Analyzing the business requirements, you notice that the rules are quite similar, just some of the factors are different. E.g. in one jurisdiction number of stories is multiplied by 1.2, in another by 1.5 and in another not considered (= multiplied by 0).</p> 
<p>So you design a <a href="https://help.salesforce.com/articleView?id=custommetadatatypes_overview.htm&amp;type=5">custom metadata object</a> (don't make the mistake and use a custom object - it will only add headache to your sandbox testing) and create records for your countries, so the same class can cater for multiple jurisdictions. Your factory will read that meta data before instantiating a class that implements the <code>RiskAssesor</code> interface.</p> 
<p>To maintain your flexibility, after all you suspect that the building code for <a href="https://en.wikipedia.org/wiki/Category:Fictional_African_countries">Zamunda</a> is vastly different, the metadata record contains a field <code>CustomRiskClass</code>. When that field isn't empty your factory will not instantiate the common base class, but use this class. Storing the class name in metadata allows you to keep your country specific implementations in their own <a href="https://developer.salesforce.com/docs/atlas.en-us.sfdx_dev.meta/sfdx_dev/sfdx_dev_dev2gp.htm">package</a>.</p> 
<p>A country package would as a minimum contain the meta data record. If the need for a custom class arises, that class would be in the country package too.</p> 
<h3><a href="#a-sample" id="a-sample">A sample</a></h3> 
<p>Fair warning: that code is typed here, probably not ready for copy and paste.</p> 
<pre class="brush: java">public interface RiskAssessor {
	RiskAssessor setMetadata(CountryRiskConfig_mdt countryMetadata);
	int isoRisk(ProjectPlan__c theProject);
	String countryRiskLevel(ProjectPlan__c theProject);
	RiskResult(String projectPlanId);
}

public class RiskAssessmentFactory {
	static RiskAssessor getRiskAssessor(String countryId) {
		RiskAssessor result;
		CountryRiskConfig_mdt countryMetadata = getCountryMeta(countryId);
		if (countryMetadata.CustomRiskClass != null) {
			result = (RiskAssessor) Type.forName(countryMetadata.CustomRiskClass).newInstance();
		} else {
			result = new RiskAssessorDefault;
		}
		result.setMetadata(countryMetadata);
		return result;
	}
}

public virtual class RiskAssessorDefault implements RiskAssessor {
	// TODO: implement interfaces here
}
</pre> 
<p>The <code>RiskAssessorDefault</code> class is defined using the <code>virtual</code> keyword, so you can subclass it as need arises. To be clear: the subclassing helps to avoid duplicate code, it doesn't break the need for interfaces.</p> 
<p>As usual: YMMV</p></div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 29 December 2018
<span class="divider">|</span>
<a href="/blog/2018/12/pattern-in-your-apex-controller.html#comments">Comments (0)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/apex.html">Apex</a>  <a href="/blog/categories/salesforce.html">Salesforce</a>  <a href="/blog/categories/software.html">Software</a> 

						<div class="shariff" data-lang="en" data-url="https://www.wissel.net/blog/2018/12/pattern-in-your-apex-controller.html" data-services="[&quot;whatsapp&quot;,&quot;facebook&quot;,&quot;twitter&quot;,&quot;mail&quot;]" data-title="Pattern in your Apex Controller" data-twitter-via="@notessensei"></div>
						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2018/12/pattern-in-your-apex-controller.html";
						</script>
					</p>

				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_01f2e0e0-0b04-11e9-8f1f-178be3bffe51" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_01f2e0e0-0b04-11e9-8f1f-178be3bffe51"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li id="nocomments">
							<h5>No comments yet, be the first to comment</h5>
						</li>
					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2018/12/lwc-quick-overview.html"><i class="icon-hand-left"></i>Lightning Web Components (LWC) quick overview</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2019/01/avoid-the-clean-code-shock-with-pmd.html">Avoid the "Clean Code Shock" with PMD<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2018/">2018</a> <span class="divider">/</span></li>
  <li><a href="/blog/2018/12/">December</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/apex.html">Apex</a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/salesforce.html">Salesforce</a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/software.html">Software</a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I'm a Cloud "Program Architect Director", working for Salesforce. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://astore.amazon.com/wissenetblog-20">Amazon Store</a></li>
						<li><a href="https://kindle.amazon.com/profile/Stephan-H--Wissel/1659300">Amazon Kindle</a></li>
						<li><a href="http://notessensei.spreadshirt.com/">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2019 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2018/12/pattern-in-your-apex-controller.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="/blog/js/shariff.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/shCore.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJava.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJScript.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushXml.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushBash.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushPlain.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushVb.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushCss.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>
    <script type="text/javascript">
    $(document).ready(function() {
            SyntaxHighlighter.all();
    });
    </script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "01f2e0e0-0b04-11e9-8f1f-178be3bffe51");
 		};
	</script>

</body>
</html>
