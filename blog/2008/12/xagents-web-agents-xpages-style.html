<!DOCTYPE html>
<html lang="en">
<head>
<title>XAgents - Web Agents XPages style - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
<meta name="ROBOTS" content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title" content="NotesSensei's Weblog - XAgents - Web Agents XPages style" />
<meta name="Author" content="Stephan H. Wissel" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta name="description"
	content="Thoughts, Insights and Opinions of Stephan H. Wissel. Topics included: IBM Lotus Notes and Domino, IBM Websphere, other IBM Lotus stuff,  J2EE, .Net, Software Archtecture, Personcentric Development, Agile Software, SDLC, Singapore and my Twins" />
<meta name="Keywords"
	content="lotus,domino,quickplace,sametime,blog,template,blogging,blogger,notes,r9,verse,r8,r7,r6,r5,raven,k-station,nsf,ntf,websphere,agile,sdlc,j2ee,.net,personcentric,singapore,twins,JavaScript,vertx, nodejs" />
<meta name="Abstract"
	content="Thoughts, Insights and Opinions of Stephan H. Wissel. Topics included: IBM Lotus Notes and Domino, IBM Websphere, other IBM Lotus stuff,  J2EE, .Net, Software Archtecture, Personcentric Development, Agile Software, SDLC, Singapore and my Twins" />
<meta name="ICBM" content="1.2994, 103.8425" />
<meta name="Copyright"
	content="2008,2017 Stephan H. Wissel - Creative commons licence" />
<meta HTTP-EQUIV="Content-Language" content="en" />
<meta property="fb:admins" content="567103136" />
<meta property="fb:app_id" content="219323514774289">
<meta property="og:title"
	content="wissel.net - XAgents - Web Agents XPages style" />
<meta property="og:type" content="blog" />
<meta property="og:url" content="https://wissel.net/blog" />
<meta property="og:image"
	content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="twitter:site" content="@notessensei" />
<meta name="twitter:card" content="summary" />
<meta name="xing:author"
	content="https://www.xing.com/profile/StephanH_Wissel" />

<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shCore.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shThemeMidnight.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link href='//fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css' />
<link href='//fonts.googleapis.com/css?family=Ubuntu:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css' />
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<!-- Masthead
		================================================== -->
		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

    <!--[if lt IE 10]>
  <div style='border: 1px solid #F7941D; background: #FEEFDA; text-align: center; clear: both; height: 75px; position: relative;'>
    <div style='position: absolute; right: 3px; top: 3px; font-family: courier new; font-weight: bold;'><a href='#' onclick='javascript:this.parentNode.parentNode.style.display="none"; return false;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-cornerx.jpg' style='border: none;' alt='Close this notice'/></a></div>
    <div style='width: 640px; margin: 0 auto; text-align: left; padding: 0; overflow: hidden; color: black;'>
      <div style='width: 75px; float: left;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-warning.jpg' alt='Warning!'/></div>
      <div style='width: 275px; float: left; font-family: Arial, sans-serif;'>
        <div style='font-size: 14px; font-weight: bold; margin-top: 12px;'>You are using an outdated browser</div>
        <div style='font-size: 12px; margin-top: 6px; line-height: 12px;'>For a better experience using this site, please upgrade to a modern web browser.</div>
      </div>
      <div style='width: 75px; float: left;'><a href='http://www.firefox.com' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-firefox.jpg' style='border: none;' alt='Get Firefox'/></a></div>
      <div style='width: 75px; float: left;'><a href='http://www.browserforthebetter.com/download.html' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-ie8.jpg' style='border: none;' alt='Get Internet Explorer 11'/></a></div>
      <div style='width: 73px; float: left;'><a href='http://www.apple.com/safari/download/' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-safari.jpg' style='border: none;' alt='Get Safari'/></a></div>
      <div style='float: left;'><a href='http://www.google.com/chrome' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-chrome.jpg' style='border: none;' alt='Get Google Chrome'/></a></div>
    </div>
  </div>
<![endif]-->

    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2008/">2008</a> <span class="divider">/</span></li>
  <li><a href="/blog/2008/12/">December</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/.html"></a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/.html"></a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2008/12/the-real-impact-of-xpages.html"><i class="icon-hand-left"></i>The &quot;real&quot; impact of XPages</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2008/12/i-want-one-part-v.html">I want one - Part V<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>XAgents - Web Agents XPages style</small></h1>
					<hr />
					<div>In Domino Agents are the Swiss Army Knife of development. They can be called from the client, triggered on schedule, automatically run on an event, be associated with a web action (Open, Close) or directly called from an URL using ?OpenAgent. The ?OpenAgent use of agents is subject of this blog entry. A agent triggered from an URL can use 
<i>Print</i> statements to output results back to the browser. When the first line of your print statements is "Content-Type:..." you also can serve XML or JSON or whatever exotic format your agent logic was able to conceive. Agents come with the usual drawback: the runtime environment is intitialized new for every agent run, so you need to update a document if you want to keep track (Replication conflicts anyone?) 
<br>XPages don't have a notion of agents (you can call them in the backend, but you won't get anything back from the print statements), so it seems a step back. On closer inspection however one can see, that XPages offer a greater flexibility for the same pattern of use. Every element on an XPages has a "render" attribute which determines if the element should be rendered. "Every" includes the page itself. So when you set the page's render property to 
<i>false</i>, well the XPage engine renders 
<b>nothing</b>. So you get an empty canvas you can paint on. XPages still provides you with the page event and access to 
<a href="http://www-10.lotus.com/ldd/ddwiki.nsf/dx/xpages-scoped-variables.htm">scoped variables</a>, so you can code better performing "agents" since you can keep lookups in memory. To get the equivalent to the LotusScript print you need the ResponseWriter from the externalContext. To set the content type you use the response.setContentType also to be found in the external Context. A sample snippet you could put in the afterRenderResponse event of your page would look like this (error handling omitted): 
<br> 
<pre width="80"><font color="#B22222">// The external context gives access to the servlet environment</font>
var exCon = facesContext.getExternalContext(); 

<font color="#B22222">// The writer is the closest you get to a PRINT statement</font>
<font color="#B22222">// If you need to output binary data, use the stream instead</font>
var writer = facesContext.getResponseWriter();

<font color="#B22222">// The servlet's response, check the J2EE documentation what you can do</font>
var response = exCon.getResponse();

<font color="#B22222">// In this example we want to deliver xml and make sure it doesn't get cached</font>
response.setContentType(<font color="#666666">"text/xml"</font>);
response.setHeader(<font color="#666666">"Cache-Control"</font>, <font color="#666666">"no-cache"</font>);

<font color="#B22222">// Here all your output will be written</font>
writer.write(<font color="#666666">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;christmas date\"24Dec\" /&gt;"</font>);

<font color="#B22222">// We tell the writer we are through</font>
writer.endDocument();
facesContext.responseComplete();
writer.close();
</pre> 
<b> // Update</b>:On 8.5.2 or later 
<code>writer.close()</code> seems not be necessary/be rather harmful. Read the 
<a href="/blog/d6plinks/SHWL-8BYMW8">revisited entry</a> 
<br> More information about the 
<a href="http://www-10.lotus.com/ldd/ddwiki.nsf/dx/xpages-jsf-context-objects.htm">FacesContext</a> can be found in the 
<a href="http://www-10.lotus.com/ldd/ddwiki.nsf/">Domino Developer Wiki</a>. 
<br> 
<br> 
<b>Bonus Tip</b>: Since you do not render anything from the XPage you just used, why not take that empty page and write the documentation for that XAgent? 
<br> 
<b>Update</b>: Other posts on rendering your own output in XPages: 
<ul> 
 <li><a href="/blog/d6plinks/SHWL-8248MT" title="Rendering ODF documents in your XPages">Rendering ODF documents in your XPages</a></li> 
 <li><a href="/blog/d6plinks/SHWL-8BYMW8" title="Rendering your own output in XPages revisited">Rendering your own output in XPages revisited</a></li> 
</ul> Have fun writing 
<b>XAgents</b>!</div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 2008-12-19 07:20
<span class="divider">|</span>
<a href="/blog/2008/12/xagents-web-agents-xpages-style.html#comments">Comments (19)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/Show-N-Tell Thursday.html">Show-N-Tell Thursday</a>  <a href="/blog/categories/XPages.html">XPages</a> 

						<div class="shariff" data-lang="en" data-url="https://www.notessensei.com/blog/2008/12/xagents-web-agents-xpages-style.html" data-services="[&quot;whatsapp&quot;,&quot;facebook&quot;,&quot;twitter&quot;,&quot;googleplus&quot;]" data-title="XAgents - Web Agents XPages style"></div>
						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2008/12/xagents-web-agents-xpages-style.html";
						</script>
					</p>

				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_031B3A086A2F4A0648257524003E58B5" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_031B3A086A2F4A0648257524003E58B5"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li>
<img src="//www.gravatar.com/avatar/2e3de330fe2037641c7c13fad5d61154.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Fredrik St??ckel</b> on <i>Wednesday 07 January 2009 AD - 18:31 Coordinated Universal Time</i>:<br /> 
  Very useful and powerful! I really like the native access to the servlet backend. Direct binary outupt is awesome. 
  <br /> 
  <br />Do you know if it's possible to set or manage desired charset in some way? I have tried 
  <br /> 
  <br />response.setCharacterEncoding(&quot;UTF-8&quot;); 
  <br />response.setContentType(&quot;text/xml; charset=UTF-8&quot;); 
  <br /> 
  <br />request.setCharacterEncoding(&quot;UTF-8&quot;); 
  <br /> 
  <br />...but it doesn't seem to work when &quot;echoing&quot; variables from the querystring of a request (request.getParameter(&lt;paramName&gt;)) 
  <br /> 
  <br />
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/e5e1c0062185ad13af12de214a44c179.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Sigurbjorn</b> on <i>Wednesday 28 January 2009 AD - 22:15 Coordinated Universal Time</i>:<br /> 
  While trying to use facesContext.getResponseStream() it returns null, but if we do 
  <br />facesContext.getExternalContext().getResponse().getOutputStream() 
  <br />it throws the Exception 'Can't get an OutputStream while a Writer is already in use'. 
  <br /> 
  <br />Any suggestions?
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/751f00593edbdb7ff298ffbaf4607902.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>simon mottram</b> on <i>Friday 06 March 2009 AD - 06:14 Coordinated Universal Time</i>:<br /> 
  Interesting but do I really have to write serious code in JavaScript? 
  <br /> 
  <br />Could you use Java instead? Enough languages in Domino already and I'm very unwilling to get into writing complex code in a language that has no type checking, no variable declaration, no debugging etc.
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/751f00593edbdb7ff298ffbaf4607902.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Simon Mottram</b> on <i>Wednesday 06 May 2009 AD - 08:38 Coordinated Universal Time</i>:<br /> 
  I have to say I don't believe this works for binary output. I get exactly the same result as Sigurbjorn. 
  <br /> 
  <br />We cannot get a binary outputstream it seems. 
  <br /> 
  <br />Can you confirm you have sent binary data? XML dont count =) 
  <br /> 
  <br />S
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/8b244c19421b34079796e5e64fc8ff75.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Stephan H. Wissel</b> on <i>Friday 08 May 2009 AD - 08:33 Coordinated Universal Time</i>:<br /> 
  @Simon: You can do variable declarations on server side javascript to include the type: var myvar:String = &quot;Hello World&quot;; 
  <br />You can write a java class to do your bidding (just not in the default namespace) and then do: 
  <br />var x = new com.acme.outputstuff.RenderX(); 
  <br />return x.toString(); 
  <br />If you want to return 
  <b>binary</b> data the 
  <i>writer</i> is the wrong object. You need the stream. There the same caution like servlet programming applies: once you (or something else) opens a writer to the output you can't get a stream object anymore. So when you put code into the &quot;afterRenderResponse&quot; event XPages had initialized the writer, so no more access to the stream is possible. To get to the stream you need to act &quot;earlier&quot; and use the beforeRenderResult. 
  <br /> 
  <img alt="Emoticon shocked.gif" src="/blog/images/emoticons/shocked.gif" border="0" /> stw
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/751f00593edbdb7ff298ffbaf4607902.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Simon</b> on <i>Friday 08 May 2009 AD - 22:02 Coordinated Universal Time</i>:<br /> 
  Hi Stephan 
  <br /> 
  <br />Thanks very much for the reply. Yeah I understand all that, the bit I didn't get was that the Writer had already been setup by the afterRenderResponse event. 
  <br /> 
  <br />I had actually had that idea myself but the trouble is, I can get no output from the beforeRenderResponse event using either Writer or Stream, so I had given up. Am I missing something really obvious here? 
  <br /> 
  <br />This would really make my life fun if I could get this to work =) 
  <br /> 
  <br />Cheers 
  <br /> 
  <br />Simon
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/751f00593edbdb7ff298ffbaf4607902.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Simon</b> on <i>Sunday 10 May 2009 AD - 15:20 Coordinated Universal Time</i>:<br /> 
  Hi Stephan 
  <br /> 
  <br />Sorry if this constitutes spam =) Bet you are sorry I found this page! I did get time to do a few tests this weekend though... 
  <br /> 
  <br />First, having discovered print()!, I tried the following fragment in all events, one at a time. 
  <br /> 
  <br />print(&quot;start&quot;); 
  <br />var rs = facesContext.getResponseStream(); 
  <br />if(rs == null) { 
  <br /> print(&quot;fc.getResponseStream() == null&quot;); 
  <br />} else { 
  <br /> print(rs.getClass().getName()); 
  <br />} 
  <br />print(&quot;end&quot;) 
  <br /> 
  <br />This prints fce.getResponseStream() == null, in all events. I don't know if this is broken or 'working as intended' 
  <br /> 
  <br /> 
  <br />I then tried the following. 
  <br /> 
  <br />print(&quot;start&quot;); 
  <br />var ex = facesContext.getExternalContext(); 
  <br />var response = ex.getResponse(); 
  <br />var rs = response.getOutputStream(); 
  <br />if(rs == null) { 
  <br /> print(&quot;response.getOutputStream() == null&quot;); 
  <br />} else { 
  <br /> print(rs.getClass().getName()); 
  <br />} 
  <br />print(&quot;end&quot;) 
  <br /> 
  <br />As you predicted, the getOutputStream() fails on the afterRenderResponse() event. On all other events I see the following: 
  <br /> 
  <br />10/05/2009 19:02:25 HTTP JVM: start 
  <br />10/05/2009 19:02:25 HTTP JVM: com.ibm.xsp.webapp.XspHttpServletResponse$InternalOutputStream 
  <br />10/05/2009 19:02:25 HTTP JVM: end 
  <br />10/05/2009 19:02:25 HTTP JVM: SEVERE: CLFAD####E: Exception thrown 
  <br />10/05/2009 19:02:25 HTTP JVM: SEVERE: CLFAD####E: Exception occurred servicing request for: /test/TestCharts.nsf/test.xsp - HTTP Code: 500 
  <br />10/05/2009 19:02:25 HTTP Web Server: Command Not Handled Exception [/test/TestCharts.nsf/test.xsp] 
  <br /> 
  <br />Somehow, just instantiating this object causes the XSP server to explode. I have tried flushing/closing/printing rubbish. 
  <br /> 
  <br />Feels like I'm either just one step away, or doomed forever! 
  <br /> 
  <br />Thanks for your help, appreciated. 
  <br /> 
  <br />S
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/751f00593edbdb7ff298ffbaf4607902.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Simon</b> on <i>Monday 11 May 2009 AD - 19:52 Coordinated Universal Time</i>:<br /> 
  More spam, but I beat you to it =) 
  <br /> 
  <br />If you put code into the beforeRenderResponse event, you need to tell JSF that you have finished rendering and not to proceed to the afterRenderReponse() 
  <br /> 
  <br />cue: 
  <br />facesContext.responseComplete(); 
  <br /> 
  <br />Really close, thanks for the pointer! 
  <br /> 
  <br />S
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Andrew Tjecklowsky</b> on <i>Friday 15 May 2009 AD - 07:56 Coordinated Universal Time</i>:<br /> 
  Hi Stephan! 
  <br />I've struggled with XPages and the request stream for several weeks now and found this entry that shows me that you might be the right guy to get an answer from 
  <img alt="Emoticon smile.gif" src="/blog/images/emoticons/smile.gif" border="0" /> 
  <br /> 
  <br />I'm trying to create an XPage which will be called from an HTML form POST. The HTML form will contain form fields and one or multiple fileupload controls. The XPage is created with NO UI Components (thus no FileUpload control). 
  <br /> 
  <br />I can create logic in the afterRenderResponse event that outputs the field names and values posted from the HTML form, but I can't seem to find a way to get the inputstreams (or File object or what-ever) of the uploaded files. 
  <br /> 
  <br />If I output the parameters comming in from the HTML form I can output the names and values of all fields posted, and for file uploads I get the name of the file upload control and the value is something like 'com.ibm.xsp.http.UploadedFile@6cc16cc1'. I guess that somehow it should be possible to get to the InputStream or File object of each uploaded file without using Apache Commons FileUpload or the like. 
  <br /> 
  <br />Do you know of a way to get a reference to the uploaded file(s)?
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/8b244c19421b34079796e5e64fc8ff75.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Stephan H. Wissel</b> on <i>Tuesday 19 May 2009 AD - 01:52 Coordinated Universal Time</i>:<br /> 
  @Andrew: No website, no email -&gt; no advise. 
  <br /> 
  <img alt="Emoticon biggrin.gif" src="/blog/images/emoticons/biggrin.gif" border="0" /> stw 
  <br /> 
  <br />P.S.: It's mime multi-parts there are no fields in a file upload, only stream.
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/9c272dd2f0ef2f2f07d0ab9ae5fbf5c0.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Andrew Tjecklowsky</b> on <i>Thursday 21 May 2009 AD - 16:35 Coordinated Universal Time</i>:<br /> 
  Hi Stephan, sorry 
  <img alt="Emoticon wink.gif" src="/blog/images/emoticons/wink.gif" border="0" />, here is my email and some more information about what I've tried to do: 
  <br /> 
  <br />Put Apache Commons File Upload ({ 
  <a href="http://commons.apache.org/fileupload/streaming.html" rel="nofollow" target="blank">Link</a> } into WebContent/WEB-INF/lib (and included the file in the Java build path) and then tried the following in both beforeRenderResponse and afterRenderResponse events: 
  <br /> 
  <br />var exCon = facesContext.getExternalContext(); 
  <br />var request:HttpServletRequest = exCon.getRequest(); 
  <br />var parser:com.acme.FormParser = new com.acme.FormParser(); 
  <br />parser.parseRequest(request); 
  <br /> 
  <br />com.acme.FormParser class is like: 
  <br /> 
  <br />package com.acme; 
  <br /> 
  <br />import java.io.File; 
  <br />import java.io.IOException; 
  <br />import java.io.InputStream; 
  <br /> 
  <br />import javax.servlet.http.HttpServletRequest; 
  <br /> 
  <br />import org.apache.commons.fileupload.FileItemIterator; 
  <br />import org.apache.commons.fileupload.FileItemStream; 
  <br />import org.apache.commons.fileupload.FileUploadException; 
  <br />import org.apache.commons.fileupload.servlet.ServletFileUpload; 
  <br />import org.apache.commons.fileupload.util.Streams; 
  <br /> 
  <br /> 
  <br />public class FormParser { 
  <br /> 
  <br /> 
  <br /> public FormParser() { 
  <br /> System.out.println(&quot;FormParser...&quot;); 
  <br /> } 
  <br /> 
  <br /> public void parseRequest(HttpServletRequest request) { 
  <br /> System.out.println(&quot;parseRequest(request)...&quot;); 
  <br /> try { 
  <br /> // Check that we have a file upload request 
  <br /> boolean isMultipart = ServletFileUpload.isMultipartContent(request); 
  <br /> String contentType = request.getContentType(); 
  <br /> String characterEncoding = request.getCharacterEncoding(); 
  <br /> System.out.println(&quot;Multipart: &quot; + isMultipart); 
  <br /> System.out.println(&quot;Content type: &quot; + contentType); 
  <br /> System.out.println(&quot;Character encoding: &quot; + characterEncoding); 
  <br /> 
  <br /> ServletFileUpload upload = new ServletFileUpload(); 
  <br /> FileItemIterator iter = upload.getItemIterator(request); 
  <br /> while (iter.hasNext()) { 
  <br /> // We never get to this statement &lt;==================================!!! 
  <br /> FileItemStream item = iter.next(); 
  <br /> String name = item.getFieldName(); 
  <br /> InputStream stream = item.openStream(); 
  <br /> if (item.isFormField()) { 
  <br /> System.out.println(&quot;Form field &quot; + name + &quot; with value &quot; + Streams.asString(stream) + &quot; detected.&quot;); 
  <br /> } else { 
  <br /> System.out.println(&quot;File field &quot; + name + &quot; with file name &quot; + item.getName() + &quot; detected.&quot;); 
  <br /> } 
  <br /> } 
  <br /> } catch (FileUploadException fue) { 
  <br /> fue.printStackTrace(); 
  <br /> } catch (IOException ioe) { 
  <br /> ioe.printStackTrace(); 
  <br /> } 
  <br /> } 
  <br /> 
  <br />}
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/9c272dd2f0ef2f2f07d0ab9ae5fbf5c0.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Andrew Tjecklowsky</b> on <i>Thursday 21 May 2009 AD - 16:38 Coordinated Universal Time</i>:<br /> 
  Hi Stephan, 
  <br />sorry 
  <img alt="Emoticon wink.gif" src="/blog/images/emoticons/wink.gif" border="0" />, here is my email and some more information about what I've tried to do: 
  <br /> 
  <br />Put Apache Commons File Upload ({ 
  <a href="http://commons.apache.org/fileupload/streaming.html)" rel="nofollow" target="blank">Link</a> } into WebContent/WEB-INF/lib (and included the file in the Java build path) and then tried the following in both beforeRenderResponse and afterRenderResponse events: 
  <br /> 
  <br />var exCon = facesContext.getExternalContext(); 
  <br />var request:HttpServletRequest = exCon.getRequest(); 
  <br />var parser:com.acme.FormParser = new com.acme.FormParser(); 
  <br />parser.parseRequest(request); 
  <br /> 
  <br />com.acme.FormParser class is like: 
  <br /> 
  <br />package com.acme; 
  <br /> 
  <br />import java.io.File; 
  <br />import java.io.IOException; 
  <br />import java.io.InputStream; 
  <br /> 
  <br />import javax.servlet.http.HttpServletRequest; 
  <br /> 
  <br />import org.apache.commons.fileupload.FileItemIterator; 
  <br />import org.apache.commons.fileupload.FileItemStream; 
  <br />import org.apache.commons.fileupload.FileUploadException; 
  <br />import org.apache.commons.fileupload.servlet.ServletFileUpload; 
  <br />import org.apache.commons.fileupload.util.Streams; 
  <br /> 
  <br /> 
  <br />public class FormParser { 
  <br /> 
  <br /> 
  <br /> public FormParser() { 
  <br /> System.out.println(&quot;FormParser...&quot;); 
  <br /> } 
  <br /> 
  <br /> public void parseRequest(HttpServletRequest request) { 
  <br /> System.out.println(&quot;parseRequest(request)...&quot;); 
  <br /> try { 
  <br /> // Check that we have a file upload request 
  <br /> boolean isMultipart = ServletFileUpload.isMultipartContent(request); 
  <br /> String contentType = request.getContentType(); 
  <br /> String characterEncoding = request.getCharacterEncoding(); 
  <br /> System.out.println(&quot;Multipart: &quot; + isMultipart); 
  <br /> System.out.println(&quot;Content type: &quot; + contentType); 
  <br /> System.out.println(&quot;Character encoding: &quot; + characterEncoding); 
  <br /> 
  <br /> ServletFileUpload upload = new ServletFileUpload(); 
  <br /> FileItemIterator iter = upload.getItemIterator(request); 
  <br /> while (iter.hasNext()) { 
  <br /> System.out.println(&quot;We never get to this statement????&quot;); 
  <br /> FileItemStream item = iter.next(); 
  <br /> String name = item.getFieldName(); 
  <br /> InputStream stream = item.openStream(); 
  <br /> if (item.isFormField()) { 
  <br /> System.out.println(&quot;Form field &quot; + name + &quot; with value &quot; + Streams.asString(stream) + &quot; detected.&quot;); 
  <br /> } else { 
  <br /> System.out.println(&quot;File field &quot; + name + &quot; with file name &quot; + item.getName() + &quot; detected.&quot;); 
  <br /> } 
  <br /> } 
  <br /> } catch (FileUploadException fue) { 
  <br /> fue.printStackTrace(); 
  <br /> } catch (IOException ioe) { 
  <br /> ioe.printStackTrace(); 
  <br /> } 
  <br /> } 
  <br /> 
  <br />} 
  <br />
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/9c272dd2f0ef2f2f07d0ab9ae5fbf5c0.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Andrew Tjecklowsky</b> on <i>Tuesday 02 June 2009 AD - 03:10 Coordinated Universal Time</i>:<br /> 
  Hi Stephan, 
  <br />I've just realized that I have submitted the above question twice. Sorry about that... 
  <br />I'm still looking around for a solution or some more guidelines about how to overcome my problem regarding upload files. Hoping that you could give me some more hints as to where to look?
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Edwin</b> on <i>Sunday 07 June 2009 AD - 03:50 Coordinated Universal Time</i>:<br /> 
  Thanks all for your help.
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/50c331611fd88ac9f05d1382003bffdb.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Joe Randel</b> on <i>Saturday 31 October 2009 AD - 08:07 Coordinated Universal Time</i>:<br /> 
  Thanks this post is very helpful. 
  <br />I'm new to xPage development and would like to use this technique to export the contents of a joined notes view to JSON. I have the view joined following Nathans tutorial, just don't know how to get it to JSON. Any ideas?
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/29fe7c89751645e5511b900c3925ee42.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Simon O&#39;Doherty</b> on <i>Sunday 28 February 2010 AD - 17:57 Coordinated Universal Time</i>:<br /> 
  Very cool. Will suggest this as a workaround where customer needs an intensive web agent. 
  <br /> 
  <br />
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/292b9e4b4b7dea47d836afb6456cb461.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Meenakshi</b> on <i>Tuesday 02 March 2010 AD - 17:59 Coordinated Universal Time</i>:<br /> 
  Hi, 
  <br /> 
  <br /> I have created one XPage and have a similar form.But whatever data I am saving is not getting updated in the view after i pressed the save button in XPages. 
  <br /> 
  <br /> Documents are not created. 
  <br /> 
  <br />Please share your thoughts. 
  <br />
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/f6a8b032c88b19d0efe9c428645cc193.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Todd Harris</b> on <i>Wednesday 03 March 2010 AD - 01:15 Coordinated Universal Time</i>:<br /> 
  Stephan, 
  <br />Is it possible to grab the response html that has been generated by JSF and sent to the browser? I understand from your comment @5 why my attempt to use facesContext.getResponseStream won't work from the afterRenderResponse event, but is there another way? 
  <br />Thank you.
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/8b244c19421b34079796e5e64fc8ff75.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Stephan H. Wissel</b> on <i>Wednesday 03 March 2010 AD - 01:26 Coordinated Universal Time</i>:<br /> 
  Few clarifications: 
  <ol> 
   <li>The method described here is for rendering your <b>own</b> response, <b>instead</b> of the XPages stuff.</li> 
   <li> The XPage needs to be set to &quot;render=false&quot;.</li> 
   <li>For the Writer afterRenderResponse is fine.</li> 
   <li>For the Stream use beforeRenderResponse</li> 
   <li>You can only have one: the writer or the stream.</li> 
   <li>You can't (at least to my current knowledge) intercept the render output from XPages.</li> 
   <li>&quot;Agents XPages style&quot; are for OUTPUT not for upload. For uploads use the XPages file upload control or (soon) the Quickr controls.</li> 
  </ol> 
  <img alt="Emoticon biggrin.gif" src="/blog/images/emoticons/biggrin.gif" border="0" /> stw
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/292b9e4b4b7dea47d836afb6456cb461.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Meenakshi</b> on <i>Friday 27 August 2010 AD - 14:12 Coordinated Universal Time</i>:<br /> 
  Hi Stephan, 
  <br /> 
  <br />I Have a java agent for exporting notes doc to pdf,now I want to export the xpage into PDF.Kindly advice me how to use this existing java agent in xpages 
  <br /> 
  <br />Thank you so much 
  <br /> 
  <br />
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/46c186542ee30afc6e831abf3bb82fcb.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Wright Furman</b> on <i>Thursday 02 December 2010 AD - 07:04 Coordinated Universal Time</i>:<br /> 
  Stephan, 
  <br /> 
  <br />This got me started and was just what I was looking for, but I can't seem to include dojo.js from my server file system when render is set to false for the XPage and use it in the AfterRenderResponse event to turn a JavaScript object into JSON using dojo.toJson(). Have you tried that? 
  <br /> 
  <br />When I do it, it errors out I and I get an empty page.
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/8b244c19421b34079796e5e64fc8ff75.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Stephan H. Wissel</b> on <i>Thursday 02 December 2010 AD - 16:39 Coordinated Universal Time</i>:<br /> 
  @Meenakshi, 
  <br />Presumably your agent is written well and just calls a custom class that does all the work: Just add that to the XPages classpath and use Java from JavaScript. Check the Domino designer wiki for info how to do that. 
  <br /> 
  <br />@Wright 
  <br />dojo is client side JavaScript. You can't use that in SSJS. AfterRenderResponse is SSJS. Checkout the Extension Library, they have JSON support.
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/cdd133e54e177d1bb5faa48b270bc1a4.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Don Mottolo</b> on <i>Friday 03 December 2010 AD - 19:18 Coordinated Universal Time</i>:<br /> 
  VERY IMPORTANT: If you are using Domino 8.5.2 you must remove the last line: 
  <br />writer.close(); 
  <br /> 
  <br />Otherwise, you'll get &quot;Error 500 HTTP Web Server: Command Not Handled Exception&quot; 
  <br />
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/e8ba19d734d74ba265685b680c637eb6.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Doug</b> on <i>Thursday 09 December 2010 AD - 05:34 Coordinated Universal Time</i>:<br /> 
  I am trying to create XML that contains HTML. I have tried every combination of cdata that I can think of. 
  <br /> 
  <br />Any thoughts. An xagent seems like a great idea, but I can not get it to work. 
  <br /> 
  <br />The same type of code using Print statement in a Lotusscript agent works fine. 
  <br /> 
  <br />Thanks Doug
 
							<hr style="clear : both" />
						</li> 						<li>
<img src="//www.gravatar.com/avatar/d994b3a1371aaf1bc145f25ed5a900a8.jpg?s&#61;88" class="gravatarimg" />
							posted by <b>Philippe</b> on <i>Wednesday 29 December 2010 AD - 20:59 Coordinated Universal Time</i>:<br /> 
  Hi Stephan, 
  <br /> 
  <br />Great article! 
  <br /> 
  <br />Your sample did not work on 8.5.2, but the solution of @23 Don Mottolo fixes this. Maybe put this info in your article? So other people won't lose time and get a little frustrated like me, before they notice the 23th comment 
  <img alt="Emoticon smile.gif" src="/blog/images/emoticons/smile.gif" border="0" /> 
  <br /> 
  <br />Also many thanks to Don Mottolo
 
							<hr style="clear : both" />
						</li> 					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2008/12/the-real-impact-of-xpages.html"><i class="icon-hand-left"></i>The &quot;real&quot; impact of XPages</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2008/12/i-want-one-part-v.html">I want one - Part V<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2008/">2008</a> <span class="divider">/</span></li>
  <li><a href="/blog/2008/12/">December</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/.html"></a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/.html"></a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I'm a Cloud "Program Architect Director", working for Salesforce. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://plus.google.com/+StephanWissel/about" rel="author" style="text-decoration: none;">
						    <img src="https://ssl.gstatic.com/images/icons/gplus-16.png" alt="" style="border: 0; width: 16px; height: 16px;" /> Google+</a></li>
						<li><a href="skype://notessensei?chat">Skype</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://astore.amazon.com/wissenetblog-20">Amazon Store</a></li>
						<li><a href="https://kindle.amazon.com/profile/Stephan-H--Wissel/1659300">Amazon Kindle</a></li>
						<li><a href="http://notessensei.spreadshirt.com/">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2018 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2008/12/xagents-web-agents-xpages-style.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="/blog/js/shariff.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/shCore.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJava.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJScript.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushXml.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushBash.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushPlain.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushVb.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushCss.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>
    <script type="text/javascript">
    $(document).ready(function() {
            SyntaxHighlighter.all();
    });
    </script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "031B3A086A2F4A0648257524003E58B5");
 		};
	</script>

</body>
</html>
