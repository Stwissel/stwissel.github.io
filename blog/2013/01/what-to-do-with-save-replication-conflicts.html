<!DOCTYPE html>
<html lang="en">
<head>
<title>What to do with Save &amp;amp;amp; Replication conflicts - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - What to do with Save &amp;amp;amp; Replication conflicts" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2013/01/what-to-do-with-save-replication-conflicts.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - What to do with Save &amp;amp;amp; Replication conflicts" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2013,2018 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Thoughts, Insights and Opinions of Stephan H. Wissel. Topics included:  Salesforce, IBM, JEE, .Net, Software Archtecture, Personcentric Development, Agile Software, SDLC, Singapore and my Twins" />
<meta name="Keywords"
	content="lotus,domino,quickplace,sametime,blog,template,blogging,blogger,notes,r9,verse,r8,r7,r6,r5,raven,k-station,nsf,ntf,websphere,agile,sdlc,jee,ml,salesforce,.net,personcentric,singapore,twins,JavaScript,vertx, nodejs" />
<meta name="Abstract"
	content="Thoughts, Insights and Opinions of Stephan H. Wissel. Topics included: Salesforce, IBM , JEE, NodeJS, ML, .Net, Vert.x, Software Archtecture, Personcentric Development, Agile Software, SDLC, Singapore and my Twins" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shCore.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shThemeMidnight.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link href='//fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css' />
<link href='//fonts.googleapis.com/css?family=Ubuntu:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css' />
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

    <script> 
var $buoop = {notify:{e:-0.01,f:-0.01,o:-0.01,s:-0.01,c:-0.01},insecure:true,unsupported:true,api:5}; 
function $buo_f(){ 
 var e = document.createElement("script"); 
 e.src = "//browser-update.org/update.min.js"; 
 document.body.appendChild(e);
};
try {document.addEventListener("DOMContentLoaded", $buo_f,false)}
catch(e){window.attachEvent("onload", $buo_f)}
</script>

    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2013/">2013</a> <span class="divider">/</span></li>
  <li><a href="/blog/2013/01/">January</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2012/12/avoiding-login-prompts-in-mobile-approvals.html"><i class="icon-hand-left"></i>Avoiding login prompts in mobile approvals</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2013/01/explaining-web-enablement-challenges-to-business-users.html">Explaining web enablement challenges to business users<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>What to do with Save &amp;amp; Replication conflicts</small></h1>
					<hr />
					<div>When customers start developing new Domino applications, the distributed nature of Domino can pose a stumbling block. Suddenly the unheard of 
<i>replication conflict</i> crops up and wants to be dealt with. A customer recently asked: 
<br> " 
<i>I need to check with you about the Conflict Handling in Lotus Notes application. Default I will set the Conflict Handling to Create Conflicts, but I found my application have create more and more replication or save conflict documents. What can I do for all these replication or save conflict documents, and I found some information in conflict documents is not in original document? How can I prevent the system to generate conflict document?</i>" 
<br> 
<img src="/blog/images/2013/replicationconflict.jpg" border="0" alt="Replication Conflict Handling"> 
<br> Before going into details, lets have a closer look how Notes handles its data. There's quite some hierarchy involved: 
<ol> 
 <li>to replicate two databases need to have the same replica id. The replica id is created when a database is created and only can be changed using the C API (or <a href="http://www.openntf.org/p/Surely Template">a wrapper</a> around it). When a NSF is copied on the file system, you actually create a replica (but you <a href="/blog/2011/10/moving-a-nsf-from-one-server-to-another.html">wouldn't do that</a>, would you?</li> 
 <li>Inside a database 2 documents need to have the same document unique id (<a href="http://publib.boulder.ibm.com/infocenter/domhelp/v8r0/index.jsp?topic=%2Fcom.ibm.designer.domino.main.doc%2FH_DOCUMENTUNIQUEID.html">UNID</a>), which is created from a time stamp at document creation time. The UNID is actually read/write in LotusScript and Java and a <a href="http://planetlotus.org/profiles/nathan-t-freeman">certain gentleman</a> can teach you about creative 
  <strike>
    ab 
  </strike>use of this capability. In addition in the document properties a sequence number is stored that gets incremented when a document is changed. Together with the last modification date this forms the <a href="http://en.wikipedia.org/wiki/IBM_Lotus_Notes#Data_replication">patented</a> Notes replication.</li> 
 <li>Inside the document the Notes items are stored. This are not just field values in a schema (like in an RDBMS) but little treasure troves of information. An item has a name, an array of values, a data type, an actual length and a <b>sequence number</b>. Notes can (and does) use this sequence number to see what items have been altered (note the difference: a form contains fields, a document contains items)</li> 
</ol> So how do the form options behave for conflicts (which are stored as $ConflictAction item in the document)? First Notes determines a "winner" and a "loser" document. The winner is the 
<a href="http://publib.boulder.ibm.com/infocenter/domhelp/v8r0/topic/com.ibm.notes85.help.doc/rep_save_conflicts_t.html">most edited document</a>. If there same amount of edits, only then the document saved last wins (savour this: an older document still can be a winner). Once the winner is determined, the conflict resolution is executed: 
<ul> 
 <li><b>Create conflicts</b> (no $ConflictAction item)<br> The "loser" document is converted into a response document of the winner document and an item $Conflict is created. The conflicts are shown in in views unless excluded by view selection formula (<code>&amp; !@isAvailable($Conflict)</code>). Conflict resolution is manual (an agent you write is considered manual too) </li> 
 <li><b>Merge conflicts</b> ($ConflictAction = "1")<br> If a document has been edited concurrently but different field have been altered, then they are merged into the one document and no conflict is created. If the same fields are altered a conflict is still generated.<br> Sounds good? In practise I often see this fail, when true distributed edits by users are the conflict cause, since applications habitually contain a field "LastEditedBy" with @UserName as formula - a lesson to be learned when designing distributed apps: update only what is really necessary</li> 
 <li><b>Merge/No Conflicts</b> ($ConflictAction = "3")<br> Same as above: if different fields have been altered, then they are merged. If the same fields were altered the loser document is silently discarded. One could argue: why not merge at least the different fields. But that would create rather a data mess</li> 
 <li><b>No Conflicts</b> ($ConflictAction = "2")<br> The radical solution: the winner takes it all, the loser disappears and nobody will ever know. I haven't seen a good use case for that, but the world is big</li> 
</ul> So what to do about them? First you need to have clarity: They are called "Replication and 
<b>Save</b>" conflicts. So they can also happen on the same server. Some pointers how to prevent them: 
<ul> 
 <li>Using <a href="http://publib.boulder.ibm.com/infocenter/domhelp/v8r0/index.jsp?topic=/com.ibm.notes.help.doc/DOC/H_LOCKING_YOUR_DOCUMENTS_OVER.html">document locking</a> prevents them when edits happen on the same server</li> 
 <li>Also make sure, that you scheduled agent don't run on <a href="http://www-10.lotus.com/ldd/dominowiki.nsf/dx/02172008091426PMWEB4N3.htm">two servers concurrently</a></li> 
 <li>A nice rookie mistake is to use <code>NotesDocument.save(...)</code> in a querySave (or postSave without closing the form) event - Domino will (or has) saved the document, get out of its way</li> 
 <li>Recheck your application flow: Can you limit the current allowed editor using <a href="/blog/2010/09/access-control-in-domino-part-2-inside-your-nsf.html">Author</a> fields/items? Quite often removing access in querySave combined with an agent altering access "on documents changed" makes a lot of sense</li> 
 <li>Check your forms: are there fields that are "computed" and changed by agents? You could/should set them to "computed when composed"</li> 
 <li>Avoid <code>NotesDocument.computeWithForm(..)</code> in agents unless you are sure it isn't the source of your conflict</li> 
 <li>If your business logic mandates that you have multiple concurrent edits, consider to implement the <a href="/blog/2009/05/notes-pattern-inversion-of-logging.html">inversion of logging</a> pattern (with XPages you can make that real snappy)</li> 
 <li>last not least: replicate more often or consider to cluster your servers</li> 
</ul> As usual YMMV</div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 02 January 2013
<span class="divider">|</span>
<a href="/blog/2013/01/what-to-do-with-save-replication-conflicts.html#comments">Comments (6)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a> 

						<div class="shariff" data-lang="en" data-url="https://www.notessensei.com/blog/2013/01/what-to-do-with-save-replication-conflicts.html" data-services="[&quot;whatsapp&quot;,&quot;facebook&quot;,&quot;twitter&quot;,&quot;googleplus&quot;]" data-title="What to do with Save &amp;amp; Replication conflicts"></div>
						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2013/01/what-to-do-with-save-replication-conflicts.html";
						</script>
					</p>

				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_C43E700E0F42237748257AE7003F0D9E" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_C43E700E0F42237748257AE7003F0D9E"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li>
							posted by <b>Dragon Cotterill</b> on <i>Wednesday 02 January 2013 AD</i>:<br /> 
  The Grammar Nazi in me is screaming; &quot;It's 'loser' not 'looser'&quot;. The Notes Dev in me is yelling; &quot;Yeah, I know that. So what?&quot;. The Blogger is me is shouting; &quot;Nice Article&quot;.
 
							<hr style="clear : both" />
						</li> 						<li>
							posted by <b>Stephan H. Wissel</b> on <i>Wednesday 02 January 2013 AD</i>:<br /> 
  @Dragon: for the grammar Nazi: wrong party, the spelling Nazi would have been needed 
  <img alt="Emoticon biggrin.gif" src="/blog/images/emoticons/biggrin.gif" border="0" />, but fixed now. For the Notes dev: &quot; 
  <a href="http://www.coachlee.com/articles/article_08.htm" rel="nofollow" target="blank">Always send the elevator back downLink</a>&quot; and for the blogger: glad you like it.
 
							<hr style="clear : both" />
						</li> 						<li>
							posted by <b>Glen Urban</b> on <i>Thursday 03 January 2013 AD</i>:<br /> 
  I've seen a lot of applications where edit history fields e.g.&quot;Jon Smith last updated on 1 Jan 2013&quot; have caused conflicts. If two users edit the same document on different replicas then there's going to be a conflict, even if they edited different fields and merge conflicts is turned on. 
  <br /> 
  <br />For Notes client applications it's worth noting the distinction between &quot;soft locking&quot; which is operating by default and &quot;document locking&quot; which you need to turn on. &quot;Soft locking&quot; prevents users on the same server from editing the same document. &quot;Document locking&quot; locks documents across all replicas on multiple servers.
 
							<hr style="clear : both" />
						</li> 						<li>
							posted by <b>Dragon Cotterill</b> on <i>Thursday 03 January 2013 AD</i>:<br /> 
  Thanks Stephan. The Grammar Nazi is back in his box. The Spelling Nazi has headed off elsewhere muttering about &quot;your, you're, and yaw&quot;. The Notes Dev needs to take his finger off the lift call button and the Blogger is currently digging through the old blog articles trying to find the one which has a special form for handling conflicts by showing all the differences between the original and conflict and allows the user to select which fields to keep before eventually deleting the conflict.
 
							<hr style="clear : both" />
						</li> 						<li>
							posted by <b>Patrick Kwinten</b> on <i>Thursday 24 January 2013 AD</i>:<br /> 
  thanks for explaining. 
  <br /> 
  <br />Are there any tools available that can help us with replication conflicts e.g. merge docs?
 
							<hr style="clear : both" />
						</li> 						<li>
							posted by <b>Norbert Goeth</b> on <i>Monday 24 June 2013 AD</i>:<br /> 
  Profile documents have set automatically the radical solution with $ConflictAction=&quot;2&quot;. 
  <br /> 
  <br />If this selection makes sense for other &quot;normal&quot; documents I cannot say. 
  <br /> 
  <br />But the existance of this value makes sense, since you have no opportunity to &quot;solve&quot; a conflict in a profile document.
 
							<hr style="clear : both" />
						</li> 					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2012/12/avoiding-login-prompts-in-mobile-approvals.html"><i class="icon-hand-left"></i>Avoiding login prompts in mobile approvals</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2013/01/explaining-web-enablement-challenges-to-business-users.html">Explaining web enablement challenges to business users<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2013/">2013</a> <span class="divider">/</span></li>
  <li><a href="/blog/2013/01/">January</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I'm a Cloud "Program Architect Director", working for Salesforce. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://plus.google.com/+StephanWissel/about" rel="author" style="text-decoration: none;">
						    <img src="https://ssl.gstatic.com/images/icons/gplus-16.png" alt="" style="border: 0; width: 16px; height: 16px;" /> Google+</a></li>
						<li><a href="skype://notessensei?chat">Skype</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://astore.amazon.com/wissenetblog-20">Amazon Store</a></li>
						<li><a href="https://kindle.amazon.com/profile/Stephan-H--Wissel/1659300">Amazon Kindle</a></li>
						<li><a href="http://notessensei.spreadshirt.com/">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2018 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2013/01/what-to-do-with-save-replication-conflicts.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="/blog/js/shariff.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/shCore.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJava.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJScript.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushXml.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushBash.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushPlain.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushVb.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushCss.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>
    <script type="text/javascript">
    $(document).ready(function() {
            SyntaxHighlighter.all();
    });
    </script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "C43E700E0F42237748257AE7003F0D9E");
 		};
	</script>

</body>
</html>
