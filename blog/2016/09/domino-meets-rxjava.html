<!DOCTYPE html>
<html lang="en">
<head>
<title>Domino meets RXJava - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - Domino meets RXJava" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2016/09/domino-meets-rxjava.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - Domino meets RXJava" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2002,2020 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Domino meets RXJava - Verse on premises (VoP) is nearing its second beta release and fellow Notes experts are wondering if they need to install Apache Solr as part of the VoP deployment. There was a lengthy, high quality discussion and quite some effort evaluating alternatives. In conclusion it was decided to deliver the" />
<meta name="Keywords"
	content="IBM Notes," />
<meta name="Abstract"
	content="Domino meets RXJava - Verse on premises (VoP) is nearing its second beta release and fellow Notes experts are wondering if they need to install Apache Solr as part of the VoP deployment. There was a lengthy, high quality discussion and quite some effort evaluating alternatives. In conclusion it was decided to deliver the" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/prism.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body class="line-numbers">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

     
    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2016/">2016</a> <span class="divider">/</span></li>
  <li><a href="/blog/2016/09/">September</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/ibmnotes.html">IBM Notes</a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2016/05/metawork-nobody-is-capable-but-all-participate-grudgingly.html"><i class="icon-hand-left"></i>Metawork, nobody is capable but all participate grudgingly</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2016/12/the-totally-inofficial-guide-to-verse-on-premises.html">The totally inofficial guide to Verse on Premises<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>Domino meets RXJava</small></h1>
					<hr />
					<div>Verse on premises (VoP) is nearing its second beta release and fellow Notes experts are wondering if they need to install <a href="http://lucene.apache.org/solr/">Apache Solr</a> as part of the VoP deployment. There was a lengthy, high quality discussion and quite some effort evaluating alternatives. In conclusion it was decided to deliver the subset of Solr capabilities needed for VoP as series of OSGi plugins to the Domino server. The project was formed out of the experience with ProjectCastle, which continues as Project OrangeBox to deliver these plugins. In VoP you might encounter one or the other reference to PoB, so now you know where it comes from. 
<br> One of the design challenges to solve was to emulate the facet results of the Solr search engine. I build some prototypes and finally settled on the use of <a href="https://github.com/ReactiveX/RxJava">RxJava</a>. 
<br> RxJava is a member of the <a href="http://reactivex.io/">ReactiveX</a> programming family, which is designed around the Observer pattern, iterators and functional programming. Check out the <a href="http://reactivex.io/">main site</a> to get into the groove. 
<br> The task at hand is to convert something Domino (a ViewNavigator, a DocumentCollection or a Document) into something that emits subscribable events. I started with turning a document into an NotesItem emitter. Purpose of this was the creation of lighweight Java objects that contain the items I'm interested in. Since Domino's Java has <a href="http://www-01.ibm.com/support/docview.wss?uid=swg21097861">special needs</a> and I couldn't use the <a href="https://github.com/OpenNTF/org.openntf.domino">ODA</a>, special precaution was needed. 
<br> There are <a href="https://github.com/ReactiveX/RxJava/wiki/Creating-Observables">plenty of methods</a> to create an Observable and on first look <a href="http://reactivex.io/documentation/operators/create.html">Create</a> looks most promising, but it left the question of recycling open. Luckily there is the <a href="http://reactivex.io/documentation/operators/using.html">Using</a> method that creates a companion object that lives along the Observable and gets explicitly called when the Observable is done. To create the NotesItem emitting Observable I settled on the <a href="http://reactivex.io/documentation/operators/from.html">From</a> method with an <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Iterable.html">Iterable</a> as source. The moving parts I had to create were <code>class DocumentSource implements Iterable&lt;Item&gt;</code> and <code>class ItemIterator implements Iterator&lt;Item&gt;</code> 
<br> Why Reactive? In a nutshell: a source emits data and any number of subscribers can subscribe to. Between the emission and subscription any number of filters, modifiers and aggregators can manipulate the data emitted. Since each of them lives in its own little class, testing and composition become very easy. Let's look at an example: 
<br> <code>docSource.getItemStream(session).filter(nameFilter).map(toPobItem).map(nameMapper).subscribe(new ItemAdder());</code> 
<br> You almost can read this aloud: " <i>The source emits a stream of items, they get filtered by Name, then converted into another Java object (PobItem) and renamed before added to the subscriber.</i>". In a different case you might want to collect all entities (users, groups, roles) that have access to a document, you migh create a "readerAuthorFilter". The individual classes are very easy to test. E.g. the Name filter looks like this: 
<br> 
<pre><code class="language-java">
// requiredFields is is a Collection&lt;String&gt; of NotesItem names to include or exclude
ItemNameFilter nameFilter = new ItemNameFilter(requiredFields, ItemNameFilter.FilterMode.INCLUDE);

public class ItemNameFilter implements Func1&lt;Item, Boolean&gt; {

    public enum FilterMode {
        INCLUDE, EXCLUDE;
    }

    private final Logger      logger      = Logger.getLogger(this.getClass().getName());
    private final Set&lt;String&gt; itemNameSet = new HashSet&lt;String&gt;();
    private final FilterMode  filterMode;

    /**
     * Flexible include or exclude
     *
     * @param itemNames
     *            Collection of Names to include or exclude
     * @param filterMode
     *            INCLUDE or EXCLUDE
     */
    public ItemNameFilter(Collection&lt;String&gt; itemNames, FilterMode filterMode) {
        this.filterMode = filterMode;
        this.updateItemNames(itemNames);
    }

    public ItemNameFilter(Collection&lt;String&gt; itemNames) {
        this.filterMode = FilterMode.INCLUDE;
        this.updateItemNames(itemNames);
    }

    private void updateItemNames(Collection&lt;String&gt; itemNames) {
        this.itemNameSet.addAll(itemNames);
    }

    @Override
    public Boolean call(Item incomingItem) {
        // Include unless proven otherwise
        boolean result = true;
        try {
            String itemName = incomingItem.getName();
            boolean inList = this.itemNameSet.contains(itemName.toLowerCase());
            result = (inList &amp;&amp; this.filterMode.equals(FilterMode.INCLUDE));
        } catch (NotesException e) {
            this.logger.log(Level.SEVERE, e);
            result = false;
        }
        return result;
    }
}
</code></pre> ## 
<br> The two classes are not very long and, once you are comfortable with Reactive, easy to read: 
<h3>ItemIterator</h3> 
<pre><code class="language-java">
public class ItemIterator implements Iterator&lt;Item&gt; {
    @SuppressWarnings("rawtypes")
    private final Vector theNotesItems;
    private int          itemCount = 0;
    private Item         currentItem = null;

    @SuppressWarnings("rawtypes")
    public ItemIterator(Vector vector) {
        this.theNotesItems = vector;
    }

    @Override
    public boolean hasNext() {
        return ((!this.theNotesItems.isEmpty()) &amp;&amp; (this.itemCount &lt; this.theNotesItems.size()));
    }

    @Override
    public Item next() {
        // Recycle the current item. Shred takes care of null values
        Utils.shred(this.currentItem);
        his.currentItem = (Item) this.theNotesItems.get(this.itemCount);
        this.itemCount++;
        return result;
    }

    @Override
    public void remove() {
        throw new UnsupportedOperationException();
    }

}
</code></pre> 
<br> 
<h3>DocumentSource</h3> 
<pre><code class="language-java">
public class DocumentSource implements Iterable&lt;Item&gt; {
    private final Logger logger = Logger.getLogger(this.getClass().getName());
    private Document     doc    = null;
    private final String notesURL;

    public DocumentSource(final Session session, final Document doc) throws SourceNotAvailableException {
        this.doc = doc;
        try {
            this.notesURL = doc.getNotesURL();
        } catch (final NotesException e) {
            Utils.logError(this.logger, e);
            throw new SourceNotAvailableException("Can't retrieve NotesURL");
        }
    }

    /**
     * RxJava Observable access to all Items in a Notes Document
     *
     * @param session
     *            A Domino session to access the document if needed
     * @return a Observable with NotesItems
     */
    public Observable&lt;Item&gt; getItemStream(final Session session) {

        final Observable&lt;Item&gt; itemStream = Observable.using(new Func0&lt;DocumentSource&gt;() {
            @Override
            public DocumentSource call() {
                return DocumentSource.this;
            }
        }, new Func1&lt;DocumentSource, Observable&lt;Item&gt;&gt;() {
            @Override
            public Observable&lt;Item&gt; call(final DocumentSource documentSource) {
                return Observable.from(documentSource);
            }
        },

        new Action1&lt;DocumentSource&gt;() {
            @Override
            public void call(final DocumentSource documentSource) {
                documentSource.tearDown();
            }
        });

        return itemStream;
    }

    public String getNotesURL() {
        return this.notesURL;
    }

    @Override
    @SuppressWarnings("rawtypes")
    public Iterator&lt;Item&gt; iterator() {
        Vector result;
        try {
            result = this.doc.getItems();
        } catch (final NotesException e) {
            Utils.logError(this.logger, e);
            // Using an empty vector instead
            result = new Vector();
        }
        return new ItemIterator(result);
    }

    /**
     * Cleaning up a document source to free up the memory
     * allocated in the C API
     */
    protected void tearDown() {
        Utils.shred(this.doc);
        this.doc = null;
    }

}
</code></pre> 
<br> I will report more on my RXJava meets Domino experience. As usual YMMV</div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 13 September 2016
<span class="divider">|</span>
<a href="/blog/2016/09/domino-meets-rxjava.html#comments">Comments (1)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/ibmnotes.html">IBM Notes</a> 

						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2016/09/domino-meets-rxjava.html";
						</script>
					</p>
				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_770F2C2B080A75A84825802D001E8D87" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_770F2C2B080A75A84825802D001E8D87"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li>
							posted by <b>Nathan T Freeman</b> on <i>Wednesday 14 September 2016 AD</i>:<br /> 
  It's a shame you can't use the ODA. We've bundled RxJava with it for years now, and I've been waiting for someone to get around to exploiting it. Item iterators are interesting, but we have some advanced functions like NoteLists that could do some amazing things in conjunction with Reactive.
 
							<hr style="clear : both" />
						</li> 					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2016/05/metawork-nobody-is-capable-but-all-participate-grudgingly.html"><i class="icon-hand-left"></i>Metawork, nobody is capable but all participate grudgingly</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2016/12/the-totally-inofficial-guide-to-verse-on-premises.html">The totally inofficial guide to Verse on Premises<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2016/">2016</a> <span class="divider">/</span></li>
  <li><a href="/blog/2016/09/">September</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/ibmnotes.html">IBM Notes</a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I work as "Solution Director Innovation" for HCL Software. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://notessensei.myspreadshop.com">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
						<li><a rel="me" href="https://chaos.social/@stw">Chat on Mastodon</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2022 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2016/09/domino-meets-rxjava.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/prism.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "770F2C2B080A75A84825802D001E8D87");
 		};
	</script>

</body>
</html>
