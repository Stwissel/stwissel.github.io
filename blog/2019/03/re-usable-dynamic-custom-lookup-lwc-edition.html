<!DOCTYPE html>
<html lang="en">
<head>
<title>Re-Usable Dynamic Custom Lookup LWC edition - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - Re-Usable Dynamic Custom Lookup LWC edition" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2019/03/re-usable-dynamic-custom-lookup-lwc-edition.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - Re-Usable Dynamic Custom Lookup LWC edition" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2002,2020 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Re-Usable Dynamic Custom Lookup LWC edition - Over at sfdcmonkey there&#39;s a nice AURA component that allows for dynamic lookup of a given object. Super nice and useful. I wondered what it would take to be rebuild in LWC Same, Same but different I want to achieve the same functionality, but would accept subtle differences. This is what I got: The" />
<meta name="Keywords"
	content="Lightning,Salesforce,Software," />
<meta name="Abstract"
	content="Re-Usable Dynamic Custom Lookup LWC edition - Over at sfdcmonkey there&#39;s a nice AURA component that allows for dynamic lookup of a given object. Super nice and useful. I wondered what it would take to be rebuild in LWC Same, Same but different I want to achieve the same functionality, but would accept subtle differences. This is what I got: The" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/prism.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body class="line-numbers">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

     
    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2019/">2019</a> <span class="divider">/</span></li>
  <li><a href="/blog/2019/03/">March</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/lightning.html">Lightning</a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/salesforce.html">Salesforce</a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/software.html">Software</a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2019/03/mapping-recordids-to-object-names-offline-edition.html"><i class="icon-hand-left"></i>Mapping recordIds to Object Names - Offline edition</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2019/03/extract-field-definitions-from-object.xml.html">Extract field definitions from object.xml<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>Re-Usable Dynamic Custom Lookup LWC edition</small></h1>
					<hr />
					<div><p>Over at <a href="http://sfdcmonkey.com/2017/07/17/re-usable-custom-lookup/">sfdcmonkey</a> there's a nice AURA component that allows for dynamic lookup of a given object. Super nice and useful. I wondered what it would take to be rebuild in <a href="https://developer.salesforce.com/docs/component-library/documentation/lwc">LWC</a></p> 
<p><img src="/blog/images/2019/DynamicLookup.png" alt="Dynamic Lookup"></p> 
<h3>Same, Same but different</h3> 
<p>I want to achieve the same functionality, but would accept subtle differences. This is what I got:</p> 
<ul> 
 <li>The original component shows the object icon on the left. My version shows the search symbol that comes out of the box with <a href="https://developer.salesforce.com/docs/component-library/bundle/lightning-input/example">lightning-input</a></li> 
 <li>I use 3 components instead of two. Input fields that trigger network calls are fairly common and it makes sense to <a href="https://www.maximintegrated.com/en/glossary/definitions.mvp/term/debounce/gpk/82">debounce</a> the input. So I created <code>c-ux-debounced-input</code> that signals entered data only after a period of 300ms</li> 
 <li>The component dispatches an event when a result has been selected or cleared, so it can be used inside other components</li> 
 <li>For now: it can be directly put on a lightning page in page builder and configured there. Useful for demos and test</li> 
 <li>When you clear the selected object, the result list opens up again, so no second network call is made until you change the input value</li> 
</ul><h3>The code</h3> 
<p>The template is slightly lighter</p> 
<pre><code class="language-xml">&lt;template&gt;
    &lt;div class={resultClass} data-select="single"&gt;
        &lt;div class="slds-form-element__control"&gt;
            &lt;!-- sequence completed record selected --&gt;
            &lt;div if:true={selectedRecord}&gt;
                &lt;label&gt;{label}&lt;/label&gt;
                &lt;div class="slds-pill-container"&gt;
                    &lt;lightning-pill
                        class="pillSize"
                        label={selectedRecord.Name}
                        onremove={handlePillRemove}&gt;
                        &lt;lightning-icon
                            icon-name={iconName}
                            variant="plain"
                            alternative-text={selectedRecord.Name}&gt;
                        &lt;/lightning-icon&gt;
                    &lt;/lightning-pill&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;!-- Input for search term --&gt;
            &lt;c-ux-debounced-input
                label={label}
                onchange={handleSearchTerm}
                if:false={selectedRecord}
                value={lastSearchValue}&gt;
            &lt;/c-ux-debounced-input&gt;
        &lt;/div&gt;
        &lt;ul
            style="min-height:40px;margin-top:0px !important"
            class="slds-listbox slds-listbox_vertical slds-dropdown slds-dropdown_fluid slds-lookup__menu slds"
            role="listbox"&gt;
            &lt;lightning-spinner
                variant="brand"
                size="small"
                if:true={showSpinner}
            &gt;&lt;/lightning-spinner&gt;
            &lt;center&gt;{message}&lt;/center&gt;
            &lt;template if:true={results} for:each={results} for:item="singleRec"&gt;
                &lt;c-ux-quick-lookup-result
                    icon-name={iconName}
                    record={singleRec}
                    onselection={handleRecordSelect}
                    key={singleRec.Id}
                &gt;&lt;/c-ux-quick-lookup-result&gt;
            &lt;/template&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/template&gt;

</code></pre> 
<p>The CSS is more or less the same</p> 
<pre><code class="language-css">.pillSize {
    width: 100%;
}
</code></pre> 
<p>The JavaScript is proper <a href="https://es6.io/">ES6</a>. It already contains some code for my "Next Stop"</p> 
<pre><code class="language-js">import { LightningElement, api, track } from 'lwc';
import fetchLookUpValues from '@salesforce/apex/CustomLookUpController.fetchLookUpValues';
import fetchExtendedLookUpValues from '@salesforce/apex/CustomLookUpController.fetchExtendedLookUpValues';

export default class UxQuickLookup extends LightningElement {
    @api objectApiName;
    @api iconName = 'standard:account';
    @api label = 'Lookup';
    @api fields = null;

    @track resultClass;
    @track selectedRecord = null;
    @track results = null;
    @track message = null;
    @track showSpinner = false;
    @track lastSearchValue;

    constructor() {
        super();
        this.switchResult(false);
    }

    handleSearchTerm(event) {
        let searchValue = event.detail;
        if (searchValue) {
            this.switchResult(true);
            this.message = 'searching...';
            this.showSpinner = true;
            let searchParams = {
                searchKeyWord: searchValue,
                objectName: this.objectApiName
            };
            if (this.fields) {
                this.addFieldsToParam(searchParams);
                fetchExtendedLookUpValues(searchParams)
                    .then(result =&gt; this.setResult(result))
                    .catch(error =&gt; this.handleError(error));
            } else {
                fetchLookUpValues(searchParams)
                    .then(result =&gt; this.setResult(result))
                    .catch(error =&gt; this.handleError(error));
            }
        } else {
            this.switchResult(false);
            this.message = null;
            this.showSpinner = false;
            this.results = null;
        }
        this.lastSearchValue = searchValue;
    }

    /* Ensure we always have Name and Id in the query */
    addFieldsToParam(searchParam) {
        let allFields = this.fields.split(',');
        allFields.push('Id');
        allFields.push('Name');
        let cleanFields = this.dedupeArray(allFields).join(',');
        searchParam.fieldsToQuery = cleanFields;
    }

    dedupeArray(incoming) {
        var uniqEs6 = arrArg =&gt; {
            return arrArg.filter((elem, pos, arr) =&gt; {
                return arr.indexOf(elem) === pos;
            });
        };
        return uniqEs6(incoming);
    }

    setResult(newValues) {
        this.showSpinner = false;
        if (newValues &amp;&amp; newValues.length &gt; 0) {
            this.message = null;
            this.results = newValues;
        } else {
            this.message = 'no results found';
        }
    }

    /* Shows and hides the result area */
    switchResult(on) {
        this.resultClass = on
            ? 'slds-form-element slds-lookup slds-is-open'
            : 'slds-form-element slds-lookup slds-is-close';
    }

    handlePillRemove() {
        this.selectedRecord = null;
        let payload = {
            detail: {
                canceled: true,
                recordId: null
            }
        };
        let selected = new CustomEvent('selection', payload);
        this.dispatchEvent(selected);
        // Restore last results
        this.switchResult(this.lastSearchValue &amp;&amp; this.results);
    }

    handleError(error) {
        this.showSpinner = false;
        this.message = "Sorry didn't work!";
        let errorDispatch = new CustomEvent('failure', { detail: error });
        this.dispatchEvent(errorDispatch);
    }

    handleRecordSelect(event) {
        let record = event.detail;
        this.selectedRecord = record;
        let selectionDispatch = new CustomEvent('recordselected', {
            detail: record
        });
        this.dispatchEvent(selectionDispatch);
        this.switchResult(false);
    }
}
</code></pre> 
<p>What you don't see here are <code>c-ux-quick-lookup-result</code> and <code>c-ux-debounced-input</code>. To check those, head over to the <a href="https://github.com/Stwissel/lwcaura">repository</a>, have a look, take a clone and deploy it with <code>sfdx force:source:deploy -p experiments/experiment5</code> into a sandbox. Add the component to a lightning page and have a look.</p> 
<h3>Next Stop</h3> 
<p>When selecting object, the name might not be enough to pick the right value. So I'm looking into a way to optional display more field values. That's an interesting challenge for visualization.</p> 
<p>As usual: YMMV</p></div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 27 March 2019
<span class="divider">|</span>
<a href="/blog/2019/03/re-usable-dynamic-custom-lookup-lwc-edition.html#comments">Comments (2)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/lightning.html">Lightning</a>  <a href="/blog/categories/salesforce.html">Salesforce</a>  <a href="/blog/categories/software.html">Software</a> 

						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2019/03/re-usable-dynamic-custom-lookup-lwc-edition.html";
						</script>
					</p>
				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_8ff284d0-5042-11e9-b56a-cd55bbbbd610" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_8ff284d0-5042-11e9-b56a-cd55bbbbd610"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li>
							posted by <b>Nagarjun</b> on <i>Wednesday 10 July 2019 AD</i>:<br /> <p>we can't able find the rest of the components c-ux-quick-lookup-result and c-ux-debounced-input in your git repo.<br />
Please share the code.</p>

							<hr style="clear : both" />
						</li> 						<li>
							posted by <b>Brooks</b> on <i>Friday 25 October 2019 AD</i>:<br /> <p>First of all, thank you so much for writing this.  Saved me and presumably many others from having to work all of this out on our own.  I noticed that the record list in your example flickers a bit and doesn't show up all the time.  I figured out that by adding the following code, it sticks around properly, so I thought I would share (one very small change to customLookup.js):</p>
<pre><code>handleOnchange(event) {
    // Collect search key from event
    const searchKey = event.detail.value;

    // Return case - (MODIFICATION)
    if (searchKey === null || searchKey === undefined) {
        return;
    }
    else if (searchKey.length === 0) {
        this.records = undefined;
        return;
    } ...
</code></pre>

							<hr style="clear : both" />
						</li> 					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2019/03/mapping-recordids-to-object-names-offline-edition.html"><i class="icon-hand-left"></i>Mapping recordIds to Object Names - Offline edition</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2019/03/extract-field-definitions-from-object.xml.html">Extract field definitions from object.xml<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2019/">2019</a> <span class="divider">/</span></li>
  <li><a href="/blog/2019/03/">March</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/lightning.html">Lightning</a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/salesforce.html">Salesforce</a>
  </li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/software.html">Software</a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I work as "Solution Director Innovation" for HCL Software. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://notessensei.myspreadshop.com">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
						<li><a rel="me" href="https://chaos.social/@stw">Chat on Mastodon</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2022 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2019/03/re-usable-dynamic-custom-lookup-lwc-edition.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/prism.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "8ff284d0-5042-11e9-b56a-cd55bbbbd610");
 		};
	</script>

</body>
</html>
