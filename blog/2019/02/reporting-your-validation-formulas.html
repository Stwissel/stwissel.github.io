<!DOCTYPE html>
<html lang="en">
<head>
<title>Reporting your validation formulas - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - Reporting your validation formulas" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2019/02/reporting-your-validation-formulas.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - Reporting your validation formulas" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2019,2019 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Reporting your validation formulas - Validation formula are a convenient way to ensure your data integrity. With great powers? comes the risk of alienating users by preventing them entering data. Why look at them? You can easily look at all formula in the Object Manager, but it is tedious to look at every formula one by one. You might " />
<meta name="Keywords"
	content="Salesforce," />
<meta name="Abstract"
	content="Reporting your validation formulas - Validation formula are a convenient way to ensure your data integrity. With great powers? comes the risk of alienating users by preventing them entering data. Why look at them? You can easily look at all formula in the Object Manager, but it is tedious to look at every formula one by one. You might " />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shCore.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shThemeMidnight.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link href='//fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css' />
<link href='//fonts.googleapis.com/css?family=Ubuntu:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css' />
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

    <script> 
var $buoop = {notify:{e:-0.01,f:-0.01,o:-0.01,s:-0.01,c:-0.01},insecure:true,unsupported:true,api:5}; 
function $buo_f(){ 
 var e = document.createElement("script"); 
 e.src = "//browser-update.org/update.min.js"; 
 document.body.appendChild(e);
};
try {document.addEventListener("DOMContentLoaded", $buo_f,false)}
catch(e){window.attachEvent("onload", $buo_f)}
</script>

    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2019/">2019</a> <span class="divider">/</span></li>
  <li><a href="/blog/2019/02/">February</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/salesforce.html">Salesforce</a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2019/01/avoid-the-clean-code-shock-with-pmd.html"><i class="icon-hand-left"></i>Avoid the "Clean Code Shock" with PMD</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2019/02/draining-the-happy-soup-part-1.html">Draining the happy soup - Part 1<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>Reporting your validation formulas</small></h1>
					<hr />
					<div><p>Validation formula are a convenient way to ensure your data integrity. With great powers? comes the risk of alienating users by preventing them entering data.</p> 
<h3><a href="#why-look-at-them" id="why-look-at-them">Why look at them?</a></h3> 
<p>You can easily look at all formula in the Object Manager, but it is tedious to look at every formula one by one. You might ask yourself:</p> 
<ul> 
 <li>Do all my formula exclude the integration profile?</li> 
 <li>Are context (e.g. the country) specific formulas set correctly?</li> 
 <li>Do validation rules follow the naming conventions?</li> 
 <li>Are messages helpful or intimidating?</li> 
</ul> 
<h3><a href="#extract-and-report" id="extract-and-report">Extract and report</a></h3> 
<p>You already use <a href="https://github.com/kgalant/PackageBuilder">PackageBuilder</a> to extract objects (and other stuff) as <a href="http://www.xml.org/">XML</a>, so it is just a small step: slap all <code>*.object</code> files into one big file and run an <a href="https://en.wikipedia.org/wiki/XSLT">XSLT</a> report over it.</p> 
<p>Not so fast! If you concatenate XML files using OS copy you end up with three problems:</p> 
<ul> 
 <li>You don't have an XML root element. Like the <a href="https://en.wikipedia.org/wiki/Highlander_(film)">Highlander</a> - there can be only one. You could sandwich the files in opening and closing tags, but then you have the next problem</li> 
 <li>XML files start <code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code> and copying that file will sprinkle that statement multiple times into your result. The XSLT processor will barf</li> 
 <li>The result will get very big and any report will take a long time or even run out of memory</li> 
</ul> 
<h3><a href="#a-bit-of-tooling" id="a-bit-of-tooling">A bit of tooling</a></h3> 
<p>I solved, for my needs, using a small <a href="https://gist.github.com/Stwissel/aeff1c523983ad7a89b33a7d2d67de43">Java class</a> and <a href="https://gist.github.com/Stwissel/cc2289fc319f468deacee7ba7649a4e6">one XSLT stylesheet</a>. Java because: I'm familiar with it and NodeJS still sucks with XML. XSLT, because: I'm familiar with it (heard that before?) and the styling of the output is independent from the processing step. I presume you know how to initiate an <a href="https://sourceforge.net/projects/saxon/files/Saxon-HE/9.9/">XSLT 2.0 transformation</a>.</p><p>The Java class uses Google's <a href="https://mvnrepository.com/artifact/com.google.guava/guava/27.0.1-jre">Guava library</a> to ensure the output path exists. You can easily comment that out, so the class uses only the JDK.</p> 
<pre class="brush: java">/** ========================================================================= *
 * Copyright (C)  2019 Salesforce Inc ( http://www.salesforce.com )           *
 *                            All rights reserved.                            *
 *                                                                            *
 *  @author     Stephan H. Wissel (stw) &lt;swissel@salesforce.com&gt;              *
 *                                       @notessensei                         *
 * @version     1.0                                                           *
 * ========================================================================== *
 *                                                                            *
 * Licensed under the  Apache License, Version 2.0  (the "License").  You may *
 * not use this file except in compliance with the License.  You may obtain a *
 * copy of the License at &lt;http://www.apache.org/licenses/LICENSE-2.0&gt;.       *
 *                                                                            *
 * Unless  required  by applicable  law or  agreed  to  in writing,  software *
 * distributed under the License is distributed on an  "AS IS" BASIS, WITHOUT *
 * WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied.  See the *
 * License for the  specific language  governing permissions  and limitations *
 * under the License.                                                         *
 *                                                                            *
 * ========================================================================== *
 */
package net.wissel.sfdc;

import java.io.File;
import java.io.FileOutputStream;
import java.io.FilenameFilter;
import java.io.IOException;
import java.io.OutputStream;
import java.util.HashMap;
import java.util.Map;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.TransformerConfigurationException;
import javax.xml.xpath.XPath;
import javax.xml.xpath.XPathConstants;
import javax.xml.xpath.XPathExpressionException;
import javax.xml.xpath.XPathFactory;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

import com.google.common.io.Files;

/**
 * @author swissel
 *
 */
public class ValidationReportGenerator {

    /**
     * @param args
     * @throws Exception
     */
    public static void main(final String[] args) throws Exception {
        if (args.length &lt; 2) {
            System.err.println("Usage ValidationReportGenerator sourceDir outputFile.xml");
            System.exit(1);
        }

        final String sourceDirName = args[0];
        final String outputFileName = args[1];

        final ValidationReportGenerator vrg = new ValidationReportGenerator();

        vrg.extractValidations(sourceDirName, outputFileName);

        System.out.println("Done");

    }

    private void addElementToOutput(final Element element, final SimpleXMLDoc output)
            throws TransformerConfigurationException, SAXException {
        output.openTag("Rule");
        final NodeList children = element.getChildNodes();
        for (int i = 0; i &lt; children.getLength(); i++) {
            Node n = children.item(i);
            if (n instanceof Element) {
                final Element childElement = (Element) n;
                output.addTag(childElement.getTagName(), childElement.getTextContent());
            }
            
        }
        output.closeTag(1);
    }

    public void extractValidations(final String sourceDirName, final String outputFileName) throws Exception {
        final File sourceDir = new File(sourceDirName);
        if (!sourceDir.exists() || !sourceDir.isDirectory()) {
            System.err.println("Source doesn't exist or isn't a directory");
            return;
        }
        final File targetFile = new File(outputFileName);
        Files.createParentDirs(targetFile);

        final SimpleXMLDoc output = new SimpleXMLDoc();
        output.openTag("Validations");

        final FilenameFilter filter = (dir, name) -&gt; name.endsWith(".object");

        for (final String curFileName : sourceDir.list(filter)) {
            this.processOneObjectDefinition(sourceDir.getAbsolutePath() + "/" + curFileName, output);
        }

        // Closure
        output.closeDocument();
        final OutputStream out = new FileOutputStream(targetFile);
        output.printToStream(out);
        out.close();

    }

    private NodeList getValidationList(final String curFileName)
            throws ParserConfigurationException, SAXException, IOException, XPathExpressionException {
        final File inFile = new File(curFileName);
        final DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();
        final DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();
        final Document doc = dBuilder.parse(inFile);
        final XPath xPath = XPathFactory.newInstance().newXPath();
        final String expression = "/CustomObject/validationRules";
        final NodeList nodeList = (NodeList) xPath.compile(expression).evaluate(doc, XPathConstants.NODESET);
        return nodeList;
    }

    private void processOneObjectDefinition(final String curFileName, final SimpleXMLDoc output)
            throws TransformerConfigurationException, SAXException, ParserConfigurationException, IOException,
            XPathExpressionException {
        final String objectName = curFileName.substring(curFileName.lastIndexOf("/")+1, curFileName.lastIndexOf("."));

        final NodeList nodeList = this.getValidationList(curFileName);

        if ((nodeList != null) &amp;&amp; (nodeList.getLength() &gt; 0)) {
            final Map&lt;String, String&gt; attributes = new HashMap&lt;&gt;();
            attributes.put("objectName", objectName);
            output.openTag("Validation", attributes);

            for (int i = 0; i &lt; nodeList.getLength(); i++) {
                final Element element = (Element) nodeList.item(i);
                this.addElementToOutput(element, output);
            }

            output.closeTag(1);
        }
    }

}

</pre> 
<p>As usual YMMV</p></div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 07 February 2019
<span class="divider">|</span>
<a href="/blog/2019/02/reporting-your-validation-formulas.html#comments">Comments (0)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/salesforce.html">Salesforce</a> 

						<div class="shariff" data-lang="en" data-url="https://www.wissel.net/blog/2019/02/reporting-your-validation-formulas.html" data-services="[&quot;whatsapp&quot;,&quot;facebook&quot;,&quot;twitter&quot;,&quot;mail&quot;]" data-title="Reporting your validation formulas" data-twitter-via="@notessensei"></div>
						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2019/02/reporting-your-validation-formulas.html";
						</script>
					</p>

				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_83a24c00-2af0-11e9-aa3f-a1b759d59560" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_83a24c00-2af0-11e9-aa3f-a1b759d59560"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li id="nocomments">
							<h5>No comments yet, be the first to comment</h5>
						</li>
					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2019/01/avoid-the-clean-code-shock-with-pmd.html"><i class="icon-hand-left"></i>Avoid the "Clean Code Shock" with PMD</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2019/02/draining-the-happy-soup-part-1.html">Draining the happy soup - Part 1<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2019/">2019</a> <span class="divider">/</span></li>
  <li><a href="/blog/2019/02/">February</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/salesforce.html">Salesforce</a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I'm a Cloud "Program Architect Director", working for Salesforce. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://astore.amazon.com/wissenetblog-20">Amazon Store</a></li>
						<li><a href="https://kindle.amazon.com/profile/Stephan-H--Wissel/1659300">Amazon Kindle</a></li>
						<li><a href="http://notessensei.spreadshirt.com/">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2019 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2019/02/reporting-your-validation-formulas.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="/blog/js/shariff.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/shCore.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJava.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJScript.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushXml.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushBash.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushPlain.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushVb.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushCss.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>
    <script type="text/javascript">
    $(document).ready(function() {
            SyntaxHighlighter.all();
    });
    </script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "83a24c00-2af0-11e9-aa3f-a1b759d59560");
 		};
	</script>

</body>
</html>
