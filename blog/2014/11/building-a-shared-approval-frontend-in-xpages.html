<!DOCTYPE html>
<html lang="en">
<head>
<title>Building a shared approval frontend in XPages - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - Building a shared approval frontend in XPages" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2014/11/building-a-shared-approval-frontend-in-xpages.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - Building a shared approval frontend in XPages" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2002,2022 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Building a shared approval frontend in XPages - The saying goes: &#39; God would not have been able to create the world in 7 days, if there would have been an installed base to take care of&#39;. As much as we wish to have divine powers, we need to make with less and look after an installed base. Point in case: You have a set of approval applications in " />
<meta name="Keywords"
	content="XPages," />
<meta name="Abstract"
	content="Building a shared approval frontend in XPages - The saying goes: &#39; God would not have been able to create the world in 7 days, if there would have been an installed base to take care of&#39;. As much as we wish to have divine powers, we need to make with less and look after an installed base. Point in case: You have a set of approval applications in " />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/prism.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body class="line-numbers">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

     
    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/">2014</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/11/">November</a></li>
	<li class="pull-right">
	<a href="/blog/d6plinks/SHWL-9QRKUV" title="originally published at /blog/d6plinks/SHWL-9QRKUV">SHWL-9QRKUV</a>
	</li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/xpages.html">XPages</a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2014/11/mustache-helper-for-domino.html"><i class="icon-hand-left"></i>{{Mustache}} Helper for Domino and XPages</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2014/11/providing-user-information-in-json.html">Providing user information in JSON<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>Building a shared approval frontend in XPages</small></h1>
					<hr />
					<div>The saying goes: " <i>God would not have been able to create the world in 7 days, if there would have been an installed base to take care of</i>". As much as we wish to have divine powers, we need to make with less and look after an installed base. Point in case: You have a set of approval applications in classic Notes client code, like: Travel, Leave, Expenses, Gifts, Training, BoM changes etc. You are challenged to provide a web and/or mobile interface for them. 
<br> Considering your options you have to decide between options: 
<ol>
 <li>Dump the applications and rebuild them on a new platform. Hope that it will take long enough, so nobody will ask you to migrate any of the existing data</li>
 <li>Enable them one-by-one</li>
 <li>Hire <a href="http://redpilldevelopment.com/">Redpill</a> to do an <i>asymmetric modernization</i></li>
 <li>Build a <i>lateral</i> approval screen across your applications and leave the full web enablement for later</li>
</ol> While #1 would allow you to silently dump all your technical debt, it will take too long and a potential data migration monster would lurk in the dark. #2 is what non-techies would expect, but again you spend too much time and you will carry forward new technical debt. After all the applications are more similar than different. Hiring Redpill would be a sensible option, but that requires board approval or is against your "we-do-it-inhouse" policy or you simply want to expand your skill horizon. 
<br> This leaves you with #4. To do this successful, you need to define your scope clearly. In the rest of the article I will work with the following assumptions, if they don't fit your situation, adjust your plan: 
<ul>
 <li>The goal is to provide the decision making screen only, not a complete workflow engine (it could evolve to that)</li>
 <li>Request submission happens in the existing application, providing a new interface for that is outside the current scope</li>
 <li>The flow logic (how many approvers per level etc.) is determined on submission by the original application</li>
 <li>Someone from a different department indicated interest to use the approval screen from a complete different system (that is the "scope creep" that happens in any project)</li>
</ul> When you look at workflow systems, while planning your application, you will notice, that there are 2 types of data: the flow state/sequence and the specific request data. The flow state is stuff like: what's the current status, what are the potential decisions (usually: Yes, No, More info please), who are the past, current, future approvers. The specific request data is stuff like: duration and type of leave, price of items to purchase, customer involved etc. 
<br> In your existing applications the two are stored together (and will stay like that), but you need to extract the flow data to your new <i>approvalCentral</i> application. On the back of a napkin you draw this sequence: 
<br><a href="/blog/images/2014/ApprovalFlow.svg" title="Click here for a SVG version"> <img src="/blog/images/2014/ApprovalFlow.png" border="0" alt="Your approval workflow"></a>
<br> (Image created with <a href="http://bramp.github.io/js-sequence-diagrams/">JS Sequence Diagrams</a> and postprocessed with <a href="https://inkscape.org/en/">InkScape</a>) 
<br>
<br> The green part of the application exists, the first question is: how to design the submission. There are a number of options you could choose from: 
<ul>
 <li>Have the Approval Central application poll participating applications on schedule. That option is least efficient, but might be your only choice if you can't touch the existing apps at all (happens more often than you think, when <strike> admins are paranoid </strike> policies are set very cautious</li>
 <li>Have each application create a flow document directly in the workflow central application. You could use a inherited LotusScript library for that. While that might have been the prefered choice a decade ago, it has two problems: first you limit your participating applications to Notes only (and there are other applications with decision requirements) and you would expose the inner workings of your application prematurely</li>
 <li>Use a web service interface to implement <a href="http://en.wikipedia.org/wiki/Design_by_contract">Contract first</a> development. While REST is the current IT fashion, you pick SOAP. The simple reason: LotusScript can talk SOAP quite well via the Webservice consumer design element, while REST would require your notification code being written in Java. So a SOAP service it is</li>
</ul>To get started two classes in LotusScript provide the interface the WebService provider needs to generate the WSDL file for submission. In a production environment you need to add validation and sanity checks to the code (and probably more fields): 
<br>
<pre><code class="language-vb">
Option Public
Option Declare

Public Class ApprovalRequest
public System As String
Public CallbackLocation As String
Public Title As String
Public Requestor As String

End Class

Public Class ApprovalSubmission
Public Function submitForApproval(request As ApprovalRequest) As String
Dim s As New NotesSession
Dim db As NotesDatabase
Dim doc As NotesDocument
submitForApproval = "OK"
Set db = s.Currentdatabase
Set doc = db.Createdocument()
call doc.Replaceitemvalue("Form", "approvalRequest" )
Call doc.Replaceitemvalue("System", request.System)
Call doc.Replaceitemvalue("Title", request.Title)
Call doc.Replaceitemvalue("CallbackLocation", request.CallbackLocation )
Call doc.Replaceitemvalue("Created", now)
Call doc.Save(true, true)
End Function
End Class
</code></pre>
<br> Using this class you can generate the WSDL by pointing to <code>ApprovalSubmission</code> as <i>PortType</i> class. The resulting WSDL looks like this: 
<br>
<pre><code class="language-xml">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions targetNamespace="urn:DefaultNamespace"
     xmlns="http://schemas.xmlsoap.org/wsdl/"
     xmlns:apachesoap="http://xml.apache.org/xml-soap"
     xmlns:impl="urn:DefaultNamespace" xmlns:intf="urn:DefaultNamespace"
     xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/"
     xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
     xmlns:wsdlsoap="http://schemas.xmlsoap.org/wsdl/soap/"
     xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
 &lt;wsdl:types&gt;
  &lt;schema targetNamespace="urn:DefaultNamespace" xmlns="http://www.w3.org/2001/XMLSchema"&gt;
   &lt;complexType name="APPROVALREQUEST"&gt;
    &lt;sequence&gt;
     &lt;element name="SYSTEM" type="xsd:string"/&gt;
     &lt;element name="CALLBACKLOCATION" type="xsd:string"/&gt;
     &lt;element name="TITLE" type="xsd:string"/&gt;
     &lt;element name="REQUESTOR" type="xsd:string"/&gt;
    &lt;/sequence&gt;
   &lt;/complexType&gt;
   &lt;element name="REQUEST" type="impl:APPROVALREQUEST"/&gt;
   &lt;element name="SUBMITFORAPPROVALReturn" type="xsd:string"/&gt;
  &lt;/schema&gt;
 &lt;/wsdl:types&gt;
 &lt;message name="SUBMITFORAPPROVALRequest"&gt;
  &lt;part element="impl:REQUEST" name="REQUEST"/&gt;
 &lt;/message&gt;
 &lt;message name="SUBMITFORAPPROVALResponse"&gt;
  &lt;part element="impl:SUBMITFORAPPROVALReturn" name="SUBMITFORAPPROVALReturn"/&gt;
 &lt;/message&gt;
 &lt;portType name="ApprovalSubmission"&gt;
  &lt;operation name="SUBMITFORAPPROVAL"&gt;
   &lt;input message="impl:SUBMITFORAPPROVALRequest" name="SUBMITFORAPPROVALRequest"/&gt;
   &lt;output message="impl:SUBMITFORAPPROVALResponse" name="SUBMITFORAPPROVALResponse"/&gt;
  &lt;/operation&gt;
 &lt;/portType&gt;
 &lt;binding name="DominoSoapBinding" type="impl:ApprovalSubmission"&gt;
  &lt;wsdlsoap:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/&gt;
  &lt;operation name="SUBMITFORAPPROVAL"&gt;
   &lt;wsdlsoap:operation soapAction="SUBMITFORAPPROVAL"/&gt;
   &lt;input name="SUBMITFORAPPROVALRequest"&gt;
    &lt;wsdlsoap:body use="literal"/&gt;
   &lt;/input&gt;
   &lt;output name="SUBMITFORAPPROVALResponse"&gt;
    &lt;wsdlsoap:body use="literal"/&gt;
   &lt;/output&gt;
  &lt;/operation&gt;
 &lt;/binding&gt;
 &lt;service name="ApprovalSubmissionService"&gt;
  &lt;port binding="impl:DominoSoapBinding" name="Domino"&gt;
   &lt;wsdlsoap:address location="http://localhost"/&gt;
  &lt;/port&gt;
 &lt;/service&gt;
&lt;/definitions&gt;
</code></pre>
<br> Using a <a href="https://addons.mozilla.org/en-US/firefox/addon/soa-client">SOAP client</a>, you can start testing that interface. When you look at the skeleton API you will see a notable absence of specific data for that request. I was thinking quite hard if the specific data should be included and if yes in what format. In conclusion I opted against it to keep the interface lean. Also the set of potential decisions (Yes,No,Try again etc.) is something I'd rather delegate to a configuration document. This will allow to gradually move the whole flow into the approval application. 
<br> The callback location would, for a Notes application, contain the notes://... URL, so <code>session.resolve(CallbackLocation)</code> will give us a handle on the document. Using our <a href="/blog/2014/11/mustache-helper-for-domino.html">newly acquired</a> {{Mustache}} skills, we can call back and pull information out as HTML blob as needed. You might want to pull different information based on the (size) capabilities of your target device. 
<br> The callback can later be used to write back values into the application document. Some planning to get that right (and some facade and factories) is required. Another consideration, once your code is working, is caching. Should you pull the data from the applications live on request or pull them when you get the request. Until your application is running well I'd opt for live pulling - unless the access to the servers is slow. 
<br> Your next step: pick a <a href="http://192.241.236.31/themes/preview/smartadmin/1.5/angularjs">UI layout</a></div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 17 November 2014
<span class="divider">|</span>
<a href="/blog/2014/11/building-a-shared-approval-frontend-in-xpages.html#comments">Comments (1)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/xpages.html">XPages</a> 

						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2014/11/building-a-shared-approval-frontend-in-xpages.html";
						</script>
					</p>
				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_33B9AD63B5AAB9EE48257D8D00539E18" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_33B9AD63B5AAB9EE48257D8D00539E18"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li>
							posted by <b>Nathan T. Freeman</b> on <i>Monday 17 November 2014 AD</i>:<br /> 
  Thanks for the nod, Stephan. For the record, I don't think our pricing requires board level approval but even in the event that it does, you can try before you buy. Setting up an in-house pilot of redpill Now that modernizes at least 100 of your own applications costs less than most firms would charge to build a project plan for your first app. 
  <br /> 
  <br />Also, though we don't yet provide a centralized workflow model like the one you describe here, we do provide centralized notification for workflow. A few mouse clicks can configure a view in an NSF to act as a notification queue, and all those queues are consolidated into a single per-user notification stream inspired by Facebook's notification model. 
  <br /> 
  <br />I'll be speaking about how centralized workflow across NSFs might be achieved as part of my talk on the Graph Revolution this Thursday at the DanNotes conference.
 
							<hr style="clear : both" />
						</li> 					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2014/11/mustache-helper-for-domino.html"><i class="icon-hand-left"></i>{{Mustache}} Helper for Domino and XPages</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2014/11/providing-user-information-in-json.html">Providing user information in JSON<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/">2014</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/11/">November</a></li>
	<li class="pull-right">
	<a href="/blog/d6plinks/SHWL-9QRKUV" title="originally published at /blog/d6plinks/SHWL-9QRKUV">SHWL-9QRKUV</a>
	</li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/xpages.html">XPages</a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I work as "Solution Director Innovation" for HCL Software. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://notessensei.myspreadshop.com">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
						<li><a rel="me" href="https://chaos.social/@stw">Chat on Mastodon</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2022 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2014/11/building-a-shared-approval-frontend-in-xpages.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/prism.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "33B9AD63B5AAB9EE48257D8D00539E18");
 		};
	</script>

</body>
</html>
