<!DOCTYPE html>
<html lang="en">
<head>
<title>{{Mustache}} Helper for Domino and XPages - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
<meta name="ROBOTS" content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title" content="NotesSensei's Weblog - {{Mustache}} Helper for Domino and XPages" />
<meta name="Author" content="Stephan H. Wissel" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta name="description"
	content="Thoughts, Insights and Opinions of Stephan H. Wissel. Topics included: IBM Lotus Notes and Domino, IBM Websphere, other IBM Lotus stuff,  J2EE, .Net, Software Archtecture, Personcentric Development, Agile Software, SDLC, Singapore and my Twins" />
<meta name="Keywords"
	content="lotus,domino,quickplace,sametime,blog,template,blogging,blogger,notes,r9,verse,r8,r7,r6,r5,raven,k-station,nsf,ntf,websphere,agile,sdlc,j2ee,.net,personcentric,singapore,twins,JavaScript,vertx, nodejs" />
<meta name="Abstract"
	content="Thoughts, Insights and Opinions of Stephan H. Wissel. Topics included: IBM Lotus Notes and Domino, IBM Websphere, other IBM Lotus stuff,  J2EE, .Net, Software Archtecture, Personcentric Development, Agile Software, SDLC, Singapore and my Twins" />
<meta name="ICBM" content="1.2994, 103.8425" />
<meta name="Copyright"
	content="2014,2017 Stephan H. Wissel - Creative commons licence" />
<meta HTTP-EQUIV="Content-Language" content="en" />
<meta property="fb:admins" content="567103136" />
<meta property="fb:app_id" content="219323514774289">
<meta property="og:title"
	content="wissel.net - {{Mustache}} Helper for Domino and XPages" />
<meta property="og:type" content="blog" />
<meta property="og:url" content="https://wissel.net/blog" />
<meta property="og:image"
	content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="twitter:site" content="@notessensei" />
<meta name="twitter:card" content="summary" />
<meta name="xing:author"
	content="https://www.xing.com/profile/StephanH_Wissel" />

<link rel="stylesheet" type="text/css" href="/blog/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/shCore.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/shThemeMidnight.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/markdown.css" />
<link href='//fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css' />
<link href='//fonts.googleapis.com/css?family=Ubuntu:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css' />
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<!-- Masthead
		================================================== -->
		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

    <!--[if lt IE 10]>
  <div style='border: 1px solid #F7941D; background: #FEEFDA; text-align: center; clear: both; height: 75px; position: relative;'>
    <div style='position: absolute; right: 3px; top: 3px; font-family: courier new; font-weight: bold;'><a href='#' onclick='javascript:this.parentNode.parentNode.style.display="none"; return false;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-cornerx.jpg' style='border: none;' alt='Close this notice'/></a></div>
    <div style='width: 640px; margin: 0 auto; text-align: left; padding: 0; overflow: hidden; color: black;'>
      <div style='width: 75px; float: left;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-warning.jpg' alt='Warning!'/></div>
      <div style='width: 275px; float: left; font-family: Arial, sans-serif;'>
        <div style='font-size: 14px; font-weight: bold; margin-top: 12px;'>You are using an outdated browser</div>
        <div style='font-size: 12px; margin-top: 6px; line-height: 12px;'>For a better experience using this site, please upgrade to a modern web browser.</div>
      </div>
      <div style='width: 75px; float: left;'><a href='http://www.firefox.com' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-firefox.jpg' style='border: none;' alt='Get Firefox'/></a></div>
      <div style='width: 75px; float: left;'><a href='http://www.browserforthebetter.com/download.html' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-ie8.jpg' style='border: none;' alt='Get Internet Explorer 11'/></a></div>
      <div style='width: 73px; float: left;'><a href='http://www.apple.com/safari/download/' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-safari.jpg' style='border: none;' alt='Get Safari'/></a></div>
      <div style='float: left;'><a href='http://www.google.com/chrome' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-chrome.jpg' style='border: none;' alt='Get Google Chrome'/></a></div>
    </div>
  </div>
<![endif]-->

    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/">2014</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/11/">November</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/XPages.html">XPages</a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
							<div class="well well-raised">
				<p>This article is part of a mini series. Read them all (latest on top):</p>
				<h3>Fun with {{Mustache}}</h3>
				<ol reversed class="nav nav-list">
					<li ><a href="/blog/2014/12/command-line-mail-merge.html">Command line mail merge</a></li>
					<li ><a href="/blog/2014/12/mail-merge-with-xpages.html">Mail Merge with XPages</a></li>
					<li  class="active"><a href="/blog/2014/11/mustache-helper-for-domino.html">{{Mustache}} Helper for Domino and XPages</a></li>
					<li ><a href="/blog/2014/09/creating-nginx-configurations-for-domino-ssl.html">Creating nginx configurations for Domino SSL</a></li>
					<li ><a href="/blog/2014/04/mustache-and-ckeditor-round-two.html">Mustache and CKEditor - Round two</a></li>
					<li ><a href="/blog/2014/04/ckeditor-and-mustache-become-friends.html">CKEditor and Mustache become friends</a></li>
					<li ><a href="/blog/2014/03/fun-with-mustache-and-notes-forms.html">Fun with {{Mustache}} and Notes Forms</a></li>
				</ol>
			</div>	

				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2014/11/karma-and-wealth.html"><i class="icon-hand-left"></i>Karma and Wealth</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2014/11/building-a-shared-approval-frontend-in-xpages.html">Building a shared approval frontend in XPages<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>{{Mustache}} Helper for Domino and XPages</small></h1>
					<hr />
					<div>Previously we had a look, how to use 
<a href="/blog/d6plinks/SHWL-9J3BJ3">Mustache with the CKEditor</a> to have an editing environment for templates. I glossed over the part where to store and how to use these templates. Let me continue there. 
<br /> I'll store the template in Notes documents and use an application managed bean to transform a document (and later other things) using these templates. 
<br /> I have 2 use cases in mind: one is to allow the configuration of HTML notification messages in applications and the other to configure the display of workflow details (more on Workflow in a later post). The approach has two parts: 
<ol> 
 <li>loading (or reloading) the existing templates</li> 
 <li>using the templates</li> 
</ol> The first one should need to run only once in the application lifecycle. Since managed beans can't have constructors with parameters, I created a seperate load function, so inside the bean there is nothing that depends on the XPages runtime environment. You therefore can use that bean in an agent, application or a plug-in. 
<br /> I also opted to load all templates into memory at once, but only compile them when actually needed. If you plan to have lots of them, you want to look for a different solution. 
<br /> The class that does the work is the 
<code>MustacheHelper.java</code>. To make it easy to use, I wrap it into a managed bean and a small SSJS Helper function: 
<pre class="brush: xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;faces-config&gt;
  &lt;managed-bean&gt;
    &lt;managed-bean-name&gt;Mustache&lt;/managed-bean-name&gt;
    &lt;managed-bean-class&gt;com.notessensei.mustache.MustacheHelper&lt;/managed-bean-class&gt;
    &lt;!--  In a production system that should be application --&gt;
    &lt;managed-bean-scope&gt;session&lt;/managed-bean-scope&gt;
  &lt;/managed-bean&gt;
  &lt;!--AUTOGEN-START-BUILDER: Automatically generated by IBM Domino Designer. Do not modify.--&gt;
  &lt;!--AUTOGEN-END-BUILDER: End of automatically generated section--&gt;
&lt;/faces-config&gt;
</pre> 
<br /> 
<pre class="brush: js">
function applyTemplate(doc, templateName) {
	try {
		// Check for init
		if (!Mustache.isInitialized()) {
			var templateView:NotesView = database.getView(&quot;templates&quot;);
			Mustache.initFromView(session, templateView);
			templateView.recycle();	
		}
		return Mustache.renderDocumentToString(templateName,doc);
	} catch (e) {
		return e.message;
	}
}
</pre> 
<br /> With this done transforming a document becomes a one liner in SSJS: 
<code>return applyTemplate(document1.getDocument(),&quot;Color&quot;);</code>. To demo how it works, I created a sample database.In 
<a href="https://dl.dropboxusercontent.com/u/865725/Mustache.nsf.zip">that database</a> I use 2 computed fields to demo the transfomation of a document into plain text and HTML. You might ask: so what? Keep in mind, that this is only to demo the technique. Real use cases would be notification eMails or cnfigurable summaries from documents where you don't know the fields while you design the solution. 
<br /> There are some interesting details: Mustache has the capability to use partials (think subforms) using the syntax 
<code>{{&gt; common/header}}</code>. By default Mustache would try to read a file from a file system for that partial. Since we don't have the partials in the file system, we need to provide our own resolver to the Mustache factory: 
<br /> 
<code>factory = new DefaultMustacheFactory(new MustacheNotesResolver(templateStrings));</code> 
<br /> The 
<code>templateStrings</code> are a 
<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Map.html">Map</a> containing the uncompiled Mustache templates. The Resolver code is quite lean: 
<br /> 
<pre class="brush: java">
public class MustacheNotesResolver implements MustacheResolver {
    
    private final Map&lt;String, String&gt; templates;
    
    public MustacheNotesResolver(Map&lt;String, String&gt; templateCollection) {
        this.templates = templateCollection;
    }

    @Override
    public Reader getReader(String resourceName) {
        if (!this.templates.containsKey(resourceName)) {
            return null;
        }
        return new StringReader(this.templates.get(resourceName));
    }
}
</pre> 
<br /> You will notice that the first time the transformation runs, there's a delay before the page displays. That's the step when all templates are loaded and the managed bean gets initialized. 
<br /> Also have a look at the 
<code>DocumentResolver</code> that turns a document into something that Mustache can process. 
<br /> 
<pre class="brush: java">
public class DefaultDocumentResolver implements DocumentResolver {
    @Override
    public Map&lt;String, Object&gt; resolve(Document doc) {
        Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;();
        try {
            for (Object o : doc.getItems()) {
                Item i = (Item) o;
                if (i.getValues().size() &gt; 1) {
                    Collection&lt;String&gt; c = new Vector&lt;String&gt;();
                    for (Object val : i.getValues()) {
                        c.add(val.toString());
                    }
                    result.put(i.getName(), c);
                } else {
                    result.put(i.getName(), i.getText());
                }      
                Utils.shred(i);
            }
        } catch (NotesException e) {
            e.printStackTrace();
        }
        return result;
    }
}
</pre> 
<br /> Some documents might need special attention, e.g. when groups of field (multi-value or sequential named) form a table of values. You can provide your own resolver for them. 
<br /> For now the templates are managed in the Notes client interface. Adding a template edit UI is left to your pleasure. 
<br /> You can generate anything that can be expressed as ASCII stream: Plain Text, HTML, XML, JSON, XSL:FO, ODF, DOCX (the later two need to be zipped before delivery), PostScript, SVG etc. Get the 
<a href="https://github.com/Stwissel/MustacheHelper">code on GitHub</a> 
<br /> As usual YMMV. Next stop: transforming other stuff like views and adding more examples.</div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 2014-11-16 05:44
<span class="divider">|</span>
<a href="/blog/2014/11/mustache-helper-for-domino.html#comments">Comments (0)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/XPages.html">XPages</a> 

						<div class="shariff" data-lang="en" data-url="https://www.notessensei.com/blog/2014/11/mustache-helper-for-domino.html" data-services="[&quot;whatsapp&quot;,&quot;facebook&quot;,&quot;twitter&quot;,&quot;googleplus&quot;]" data-title="{{Mustache}} Helper for Domino and XPages"></div>
						<script type="text/javascript">
							var permaLink = "https://www.notessensei.com/blog/2014/11/mustache-helper-for-domino.html";
						</script>
					</p>

				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_7BDA190F3F59D99248257D92003582F9" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_7BDA190F3F59D99248257D92003582F9"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li id="nocomments">
							<h5>No comments yet, be the first to comment</h5>
						</li>
					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2014/11/karma-and-wealth.html"><i class="icon-hand-left"></i>Karma and Wealth</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2014/11/building-a-shared-approval-frontend-in-xpages.html">Building a shared approval frontend in XPages<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/">2014</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/11/">November</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/XPages.html">XPages</a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I'm working as "Cloud Program Architect" for Salesforce. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://plus.google.com/+StephanWissel/about" rel="author" style="text-decoration: none;">
						    <img src="https://ssl.gstatic.com/images/icons/gplus-16.png" alt="" style="border: 0; width: 16px; height: 16px;" /> Google+</a></li>
						<li><a href="skype//:notessensei?chat">Skype</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://astore.amazon.com/wissenetblog-20">Amazon Store</a></li>
						<li><a href="https://kindle.amazon.com/profile/Stephan-H--Wissel/1659300">Amazon Kindle</a></li>
						<li><a href="http://notessensei.spreadshirt.com/">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2017 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2014/11/mustache-helper-for-domino.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery.min.js"></script>
	<script type="text/javascript" src="/blog/js/shariff.min.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/shCore.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJava.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushJScript.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushXml.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushBash.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushPlain.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushVb.js"></script>
    <script type="text/javascript" src="/blog/js2/shBrushCss.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>
    <script type="text/javascript">
    $(document).ready(function() {
            SyntaxHighlighter.all();
    });
    </script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api/js/recaptcha_ajax.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
		        SyntaxHighlighter.all();
			renderComment("6LcUOewSAAAAACAI4zVcGFVkGWmp0sUH5gabwy1q", "7BDA190F3F59D99248257D92003582F9");
		});
	</script>

</body>
</html>
