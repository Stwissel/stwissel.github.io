<!DOCTYPE html>
<html lang="en">
<head>
<title>Fun with {{Mustache}} and Notes Forms - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - Fun with {{Mustache}} and Notes Forms" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2014/03/fun-with-mustache-and-notes-forms.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - Fun with {{Mustache}} and Notes Forms" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2002,2020 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Fun with {{Mustache}} and Notes Forms - Creating output from your objects is a never ending story. In XPages we use Expression Language, in classic Notes forms (including $$ViewTemplates). For the JavaScript front-end developers there is an ever growing selection and there&#39;s the good old String concatenation. On the JavaScript side I like" />
<meta name="Keywords"
	content="Software," />
<meta name="Abstract"
	content="Fun with {{Mustache}} and Notes Forms - Creating output from your objects is a never ending story. In XPages we use Expression Language, in classic Notes forms (including $$ViewTemplates). For the JavaScript front-end developers there is an ever growing selection and there&#39;s the good old String concatenation. On the JavaScript side I like" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/prism.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body class="line-numbers">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

     
    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/">2014</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/03/">March</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/software.html">Software</a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
							<div class="well well-raised">
				<p>This article is part of a mini series. Read them all:</p>
				<h3>Fun with {{Mustache}}</h3>
				<ol reversed class="nav nav-list">
					<li  class="active"><a href="/blog/2014/03/fun-with-mustache-and-notes-forms.html">Fun with {{Mustache}} and Notes Forms</a></li>
					<li ><a href="/blog/2014/04/ckeditor-and-mustache-become-friends.html">CKEditor and Mustache become friends</a></li>
					<li ><a href="/blog/2014/04/mustache-and-ckeditor-round-two.html">Mustache and CKEditor - Round two</a></li>
					<li ><a href="/blog/2014/09/creating-nginx-configurations-for-domino-ssl.html">Creating nginx configurations for Domino SSL</a></li>
					<li ><a href="/blog/2014/11/mustache-helper-for-domino.html">{{Mustache}} Helper for Domino and XPages</a></li>
					<li ><a href="/blog/2014/12/mail-merge-with-xpages.html">Mail Merge with XPages</a></li>
					<li ><a href="/blog/2014/12/command-line-mail-merge.html">Command line mail merge</a></li>
				</ol>
			</div>	

				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2014/03/rethinking-social-software.html"><i class="icon-hand-left"></i>Rethinking Social Software</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2014/03/learning-a-new-language-or-platform.html">Learning a new language or platform<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>Fun with {{Mustache}} and Notes Forms</small></h1>
					<hr />
					<div>Creating output from your objects is a never ending story. In XPages we use <a href="https://en.wikipedia.org/wiki/Unified_Expression_Language">Expression Language</a>, in classic Notes forms (including $$ViewTemplates). For the JavaScript front-end developers there is an <a href="http://garann.github.io/template-chooser/">ever growing selection</a> and there's the good old String concatenation. On the JavaScript side I like <a href="http://angularjs.org/">AngularJS</a> and <a href="http://mustache.github.io/">Mustache</a>. 
<br> The big question with templating is: how much logic should go into the template. Mustache is one of the logic-less approaches that expects most of the logic to be presented by the controller. Logic is limited to repeats for collections and conditional rendering if a element is there or not. I like Mustache, because it is <a href="https://en.wikipedia.org/wiki/Polyglot_%28computing%29">polyglot</a> and can be used in more than one language. The creator of the <a href="https://github.com/spullara/mustache.java">Java version</a> is <a href="https://twitter.com/sampullara">Sam Spullara</a> who has a nice explanation on <a href="http://www.javarants.com/2013/03/09/mustache-is-logic-less-but-the-logic-has-to-go-somewhere/">Mustache logic-less</a>, so go and read it. Being logic-less reduces the temptation to break the <a href="https://en.wikipedia.org/wiki/Model_View_Controller">MVC</a> pattern. 
<br> Mentioning "view" always draws the mental picture of a User Interface (with access to an controller), but there are other use cases: generating a report or transforming one source code into another. I like to do these activities using XSLT (Come and <a href="http://www.entwicklercamp.de/EC14/Track1Session4">see that in action next week</a>) when the result is XML (including HTML), but that approach is not suitable when the outcome would be mainly plain text. Mustache makes that task very easy: Create a sample file and then replace the sample data with {{variables}}. 
<br> So I was looking how to apply that for XPages. The sample template is rather simple - more useful templates are subject to later posts: 
<br> 
<pre><code class="language-handlebars">
Test Result
Class: {{.}}
Form: {{form}}
Fields:
{{#fields}}
{{fieldName}}, {{fieldType}} {{#multiValue}}, Multivalue {{/multiValue}}
{{/fields}}
</code></pre> The interesting part is the Java component. With a small helper I extract the fields from a form (from an On Disk Project) and render the result. You could generate custom XPages out of existing forms, or generate data Objects to bind to (instead of binding to a document directly. You can generate reports. There's no limit for ideas (actually there is still the 86400 seconds/day limit 
<img src="/blog/images/emoticons/smile.gif">). My helpers look like this: 
<pre><code class="language-java">
package com.notessensei.domistache;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import com.github.mustachejava.DefaultMustacheFactory;
import com.github.mustachejava.Mustache;
import com.github.mustachejava.MustacheFactory;

public class CommandLine {

 public static void main(String[] args) throws IOException {
  if (args.length &lt; 3) {
   System.out.println("Usage: domistache DXLSource template output");
   System.exit(1);
  }

  CommandLine cl = new CommandLine(args[0], args[1], args[2]);
  cl.convert();
  System.out.println("Done!");

 }

 private final String sourceName;
 private final String outputName;
 private final String templateName;

 public CommandLine(String sourceName, String templateName, String outputName) {
  this.sourceName = sourceName;
  this.templateName = templateName;
  this.outputName = outputName;
 }

 public void convert() throws IOException {
  File source = new File(this.sourceName);
  File target = new File(this.outputName);
  File template = new File(this.templateName);

  InputStream templateStream = new FileInputStream(template);
  InputStream sourceStream = new FileInputStream(source);
  OutputStream out = new FileOutputStream(target);

  CoreConverter core = new CoreConverter(this.getTemplate(templateStream));
  FormConverter form = new FormConverter(sourceStream);

  form.convert(core, out);

  sourceStream.close();
  templateStream.close();
  out.close();
 }

 private Mustache getTemplate(InputStream in) {
  BufferedReader r = new BufferedReader(new InputStreamReader(in));
  MustacheFactory mf = new DefaultMustacheFactory();
  return mf.compile(r, "template");
 }
}
</code></pre>You can see from the <code>FormConverter</code> and <code>CoreConverter</code> signatures, that they don't depend on anything file system specific, but use Streams. This allows to also use them in web renderings (HTML notifications are a good candidate for that) or other places where information comes from other sources than a <code>File()</code>. 
<pre><code class="language-java">
package com.notessensei.domistache;

import java.io.InputStream;
import java.io.OutputStream;
import java.util.ArrayList;
import java.util.Collection;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.xpath.XPath;
import javax.xml.xpath.XPathConstants;
import javax.xml.xpath.XPathExpressionException;
import javax.xml.xpath.XPathFactory;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.NodeList;
import org.xml.sax.InputSource;

public class FormConverter {

 private final Document    form;
 private final Collection&lt;FieldInfo&gt; fields = new ArrayList&lt;FieldInfo&gt;();

 public FormConverter(InputStream in) {
  Document d = null;
  DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
  factory.setValidating(false); // Will blow if set to true
  factory.setNamespaceAware(true);
  InputSource source = null;
  try {
   source = new InputSource(in);
   DocumentBuilder docb = factory.newDocumentBuilder();
   d = docb.parse(source);
  } catch (Exception e) {
   e.printStackTrace();
   d = null;
  }
  this.form = d;
 }

 public boolean convert(CoreConverter converter, OutputStream out) {
  this.populateFields(this.form, this.fields);
  return converter.convert(this, out);
 }

 public final Collection&lt;FieldInfo&gt; getFields() {
  return this.fields;
 }

 public final Document getForm() {
  return this.form;
 }

 private NodeList getFieldList(Document doc) {
  Object exprResult = null;
  XPath xpath = XPathFactory.newInstance().newXPath();
  // We need that otherwise the transformations fail!
  MagicNamespaceContext nsc = new MagicNamespaceContext();
  // this makes sure our XPath works
  xpath.setNamespaceContext(nsc);

  try {
   exprResult = xpath.evaluate("//d:field", doc, XPathConstants.NODESET);
  } catch (XPathExpressionException e) {
   System.err.println("XPATH failed for //d:field");
   System.err.println(e.getMessage());
  }

  return (exprResult == null) ? null : (NodeList) exprResult;

 }

 private void populateFields(Document d, Collection&lt;FieldInfo&gt; fic) {
  NodeList nl = this.getFieldList(d);
  for (int i = 0; i &lt; nl.getLength(); i++) {
   Element e = (Element) nl.item(i);
   String type = e.getAttribute("type");
   String name = e.getAttribute("name");
   String multiValue = e.getAttribute("allowmultivalues");
   FieldInfo fi = new FieldInfo(name, type, "true".equals(multiValue));
   fic.add(fi);
  }
 }
}
</code></pre> Finally, the <code>CoreConverter</code> which is just a very light wrapper around the parsing operation. In real live situations you probably would use the template with a multitude of source files (e.g. a report for all forms), so the core converter has the template in its constructor 
<pre><code class="language-java">
package com.notessensei.domistache;

import java.io.IOException;
import java.io.OutputStream;
import java.io.PrintWriter;

import com.github.mustachejava.Mustache;

public class CoreConverter {

 private final Mustache template;

 public CoreConverter(Mustache template) {
  this.template = template;
 }

 public boolean convert(Object data, OutputStream out) {
  boolean result = true;

  try {
   PrintWriter p = new PrintWriter(out);
   this.template.execute(p, data).flush();
   p.flush();
   p.close();
  } catch (IOException e) {
   e.printStackTrace();
   result = false;
  }

  return result;
 }

}
</code>
</pre> As usual YMMV</div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 12 March 2014
<span class="divider">|</span>
<a href="/blog/2014/03/fun-with-mustache-and-notes-forms.html#comments">Comments (0)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/software.html">Software</a> 

						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2014/03/fun-with-mustache-and-notes-forms.html";
						</script>
					</p>
				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_52113D4A4BB57E4D48257C99005C8DEC" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_52113D4A4BB57E4D48257C99005C8DEC"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li id="nocomments">
							<h5>No comments yet, be the first to comment</h5>
						</li>
					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2014/03/rethinking-social-software.html"><i class="icon-hand-left"></i>Rethinking Social Software</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2014/03/learning-a-new-language-or-platform.html">Learning a new language or platform<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/">2014</a> <span class="divider">/</span></li>
  <li><a href="/blog/2014/03/">March</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/software.html">Software</a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I work as "Solution Director Innovation" for HCL Software. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="http://notessensei.spreadshirt.com/">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2022 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2014/03/fun-with-mustache-and-notes-forms.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/prism.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "52113D4A4BB57E4D48257C99005C8DEC");
 		};
	</script>

</body>
</html>
