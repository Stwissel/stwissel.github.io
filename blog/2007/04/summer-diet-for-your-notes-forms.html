<!DOCTYPE html>
<html lang="en">
<head>
<title>Summer diet for your Notes Forms - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - Summer diet for your Notes Forms" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2007/04/summer-diet-for-your-notes-forms.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - Summer diet for your Notes Forms" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2002,2022 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Summer diet for your Notes Forms - The title I wanted to give this post was Spring clean your notes forms, but then it did get delayed.... One hallmark of Notes applications is their durability. It is quite common to find applications being in use, that root back into R3 or R4. Quite a number of these applications still look like tha" />
<meta name="Keywords"
	content="Show-N-Tell Thursday," />
<meta name="Abstract"
	content="Summer diet for your Notes Forms - The title I wanted to give this post was Spring clean your notes forms, but then it did get delayed.... One hallmark of Notes applications is their durability. It is quite common to find applications being in use, that root back into R3 or R4. Quite a number of these applications still look like tha" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/prism.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/admonition.css" />
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body class="line-numbers">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

     
    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2007/">2007</a> <span class="divider">/</span></li>
  <li><a href="/blog/2007/04/">April</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a>
  </li>
	<li class="pull-right">
	<span class="divider">|</span><a href="/blog/d6plinks/SHWL-6XE78T" title="originally published at /blog/d6plinks/SHWL-6XE78T">SHWL-6XE78T</a>
	</li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2007/04/on-dead-students-guns-and-the-us-constitution.html"><i class="icon-hand-left"></i>On dead students, guns and the US constitution.</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2007/05/xml-xforms-j2ee-job-in-munich.html">XML / XForms / J2EE Job in Munich<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>Summer diet for your Notes Forms</small></h1>
					<hr />
					<div><p>The title I wanted to give this post was <strong>Spring clean your notes forms</strong>, but then it did get delayed....<br>
  One hallmark of Notes applications is their durability. It is quite common to find applications being in use, that root back into R3 or R4. Quite a number of these applications still look like that too. That's the flip-site of not needing to rip-and-replace. Sometimes you also will find, that older forms load slower and behave odd at times. Before you start beautifying your applications, it is a good idea to do some spring cleaning. To do so I use Domino's DXL to extract a form in XML, filter it through a XSLT transformation and reimport that into the database.<br>
  The LotusScript code is very straight forward, has been well covered on developer works and the help file and looks like this:</p>
<pre><code class="language-vb">Set importer = session.CreateDXLImporter(stream, dbCopy)
importer.ReplicaRequiredForReplaceOrUpdate = False
importer.DesignImportOption = DXLIMPORTOPTION_CREATE
Call importer.Process&lt;
</code></pre>
<p>The "<strong>meat</strong>" is in the transformation. The XSLT file consist of 4 principal sections that contain templates. In section 1 we find the start of the output including the wrapper and calls to various templates. In section 2 design elements are filtered out, in section 3 design elements are tweaked, finally in section 4 the remaining DXL is copied 1:1 to the resulting document; . The sequence of the sections is not relevant, since XSLT uses priorities not sequence to determine what element to apply. What are the elements you can or should spring clean:</p>
<ul>
 <li>In DXL I found NotesItems between the <code>&lt;/body&gt;</code> and the <code>&lt;/form&gt;</code> tag. Removing this from the form makes the form smaller, load faster without any change in behavior.</li>
 <li>Font information is encoded inside the <code>&lt;run&gt;</code> tag. The <code>&lt;run&gt;</code> tag is similar to HTML's <code>&lt;span&gt;</code>. When you designed and re-designed forms over and over, there will be <code>&lt;run&gt;</code> tags that only contain a font change, but not actual any characters. Filtering that out lightens the form - Filter out all paragraph formats and/or fonts to be able to apply a new look &amp; feel more easily</li>
 <li>Convert access controlled sections into subforms (to work in the web)</li>
 <li>Remove (all) LotusScript code and move it to libraries (see an upcoming SnTT post on "Classical Forms" about that).</li>
</ul>
<p>Let us look at some code....</p><p>Section 1 starts the whole stylesheet.</p>
<pre><code class="language-xml">    &lt;xsl:template match="/"&gt;
        &lt;database&gt;
            &lt;!-- We get the attribute from the first element which might be a database or a form --&gt;
            &lt;xsl:attribute name="replicaid"&gt;
                &lt;!-- Get the replicaid --&gt;
                &lt;xsl:value-of select="/child::node()[1]/@replicaid"/&gt;
            &lt;/xsl:attribute&gt;
            &lt;xsl:attribute name="version"&gt;
                &lt;!-- Get the designer version --&gt;
                &lt;xsl:value-of select="/child::node()[1]/@version"/&gt;
            &lt;/xsl:attribute&gt;
            &lt;!-- get all other attributes --&gt;
            &lt;xsl:apply-templates select="@*"/&gt;
            &lt;!-- apply the templates for regular forms --&gt;
            &lt;xsl:apply-templates/&gt;
            &lt;!-- apply the templates for the additional generation like LotusScript and Suforms --&gt;
            &lt;xsl:apply-templates mode="genLS" select="/d:form/d:globals"/&gt;
            &lt;xsl:apply-templates mode="genSub" select="//d:section[@accessfieldkind]"/&gt;
            &lt;xsl:apply-templates mode="genRead" select="//d:section[@accessfieldkind]"/&gt;
        &lt;/database&gt;

    &lt;/xsl:template&gt;
</code></pre>
<p>Section 2 features match clauses with no content inside the template. It is closed in the opening tag using <code>/&gt;</code>. If a tag should be filtered, but its content be processed you just have the <code>&lt;xsl:apply-templates /&gt;</code> statement as the only content.</p>
<pre><code class="language-xml">    &lt;!-- Section 2: Filter out elements we do not want or need --&gt;
    &lt;!--  Filter out  change of font if there is not content inside--&gt;
    &lt;xsl:template match="d:run[node()[last()=1][self::d:font]]"/&gt;

    &lt;!-- Filter out the note infoand update info --&gt;
    &lt;xsl:template match="d:noteinfo"/&gt;
    &lt;xsl:template match="d:updatedby"/&gt;
    &lt;xsl:template match="d:wassignedby"/&gt;

    &lt;!-- remove a form background color --&gt;
    &lt;xsl:template match="d:form/@bgcolor" /&gt;


    &lt;!-- Filter out items after the body tag --&gt;
    &lt;xsl:template match="d:form/d:item"/&gt;

    &lt;!-- Filter out attributes --&gt;
    &lt;xsl:template match="@replicaid"/&gt;
    &lt;xsl:template match="@version"/&gt;
    &lt;xsl:template match="@milestonebuild"/&gt;

    &lt;!-- remove left margin values from pardefs, so they use the default dangerous!!!! --&gt;
    &lt;xsl:template match="@leftmargin"/&gt;
    &lt;xsl:template match="@firstlineleftmargin"/&gt;

    &lt;!-- Filter font information we don't want --&gt;
    &lt;xsl:template match="d:font/@truetype"/&gt;
    &lt;xsl:template match="d:font/@name"/&gt;
    &lt;xsl:template match="d:font/@pitch"/&gt;
    &lt;xsl:template match="d:font/@familyid"/&gt;
</code></pre>
<p>There is actually much more in the stylesheet, so check the sample stylesheet in the download section.</p>
<p>Section 3 features some tweaks to existing elements:</p>
<pre><code class="language-xml">&lt;xsl:template match="d:richtext"&gt;
        &lt;richtext&gt;
            &lt;!-- Add a hidden field for Debug information and update all hidden fields to use that formula instead of hide='read edit copy preview previewedit' --&gt;
            &lt;xsl:if test="count(//d:field[@name='isNotDebug'])=0"&gt;
                &lt;pardef hide="read edit print copy preview previewedit"&gt;
                    &lt;xsl:attribute name="id"&gt;
                        &lt;xsl:value-of select="$pardefcount"/&gt;
                    &lt;/xsl:attribute&gt;
                &lt;/pardef&gt;
                &lt;par&gt;
                    &lt;xsl:attribute name="def"&gt;
                        &lt;xsl:value-of select="$pardefcount"/&gt;
                    &lt;/xsl:attribute&gt;
                    &lt;run&gt;
                        &lt;font color="red"/&gt;
                        &lt;field type="number" kind="computedfordisplay" name="isNotDebug"&gt;
                            &lt;code event="defaultvalue"&gt;
                                &lt;formula&gt;@isNotMember("[Debug]";@UserRoles)&lt;/formula&gt;
                            &lt;/code&gt;
                        &lt;/field&gt;
                    &lt;/run&gt;
                &lt;/par&gt;
            &lt;/xsl:if&gt;
            &lt;xsl:apply-templates/&gt;
        &lt;/richtext&gt;
    &lt;/xsl:template&gt;

    &lt;!-- Replace all paragraph definition where hide='read edit copy preview previewedit' with hidewhen isNotDebug --&gt;
    &lt;xsl:template
        match="d:pardef[@hide='read edit copy preview previewedit' or @hide='read edit print copy preview previewedit']"&gt;
        &lt;pardef&gt;
            &lt;xsl:attribute name="id"&gt;
                &lt;xsl:value-of select="@id"/&gt;
            &lt;/xsl:attribute&gt;
            &lt;code event="hidewhen"&gt;
                &lt;formula&gt;isNotDebug&lt;/formula&gt;
            &lt;/code&gt;
        &lt;/pardef&gt;
    &lt;/xsl:template&gt;

    &lt;!-- change the ugly fucsia font to light gray --&gt;
    &lt;xsl:template match="d:font/@color[node()='fucisa']"&gt;
        &lt;xsl:attribute name="color"&gt;gray&lt;/xsl:attribute&gt;
    &lt;/xsl:template&gt;

    &lt;!-- standardize on 9pt for 8 and 9 pt font sizes --&gt;
    &lt;xsl:template match="d:font/@size['8pt' or '9pt']"&gt;
        &lt;xsl:attribute name="size"&gt;9pt&lt;/xsl:attribute&gt;
    &lt;/xsl:template&gt;

    &lt;!-- remove font sizes for the rest --&gt;
    &lt;xsl:template match="d:font/@size[not ('8pt' or '9pt')]"/&gt;

    &lt;!-- more radical approach : remove all font information --&gt;
    &lt;!-- xsl:template match="d:font" / --&gt;
</code></pre>
<p>Section 4 has been used in many other examples before. It leverages on the fact, that the match="*" has the lowest priority and only is applied if there is no other suitable template:</p>
<pre><code class="language-xml">    &lt;!-- Section 4 : Copy any element 1:1 from source to target --&gt;
    &lt;xsl:template match="*"&gt;
        &lt;xsl:variable name="curTagname" select="name()"/&gt;
        &lt;xsl:element name="{$curTagname}"&gt;
            &lt;!-- Walk through the attributes --&gt;
            &lt;xsl:apply-templates select="@*"/&gt;
            &lt;!-- process the children --&gt;
            &lt;xsl:apply-templates/&gt;
        &lt;/xsl:element&gt;
    &lt;/xsl:template&gt;

    &lt;xsl:template match="@*"&gt;
        &lt;xsl:variable name="curAttName" select="name()"/&gt;
        &lt;xsl:attribute name="{$curAttName}"&gt;
            &lt;xsl:value-of select="."/&gt;
        &lt;/xsl:attribute&gt;
    &lt;/xsl:template&gt;
</code></pre>
<p>Before you send back that DXL into a datbase you could scrub it further by removing pardef sections that have identical definitions. However this would require a second run with another stylesheet or some good old LotusScript code.</p>
<p>As usual YMMV</p></div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 27 April 2007
<span class="divider">|</span>
<a href="/blog/2007/04/summer-diet-for-your-notes-forms.html#comments">Comments (1)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a> 

						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2007/04/summer-diet-for-your-notes-forms.html";
						</script>
					</p>
				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_B86D24EB022DD5784825726200186F6B" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_B86D24EB022DD5784825726200186F6B"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li>
							posted by <b>Thomas Bahn</b> on <i>Monday 30 April 2007 AD</i>:<br /> 
  Didn't you get some problems with this DXL-turn-around? Layout regions? (Shared) Action? Additional or missing line breaks? 
  <br /> 
  <br />Which version of Notes do you use? 
  <br /> 
  <br />Thomas 
  <br /> 
  <a href="http://www.assono.de/blog.nsf/" rel="nofollow">http://www.assono.de/blog.nsf/</a>
 
							<hr style="clear : both" />
						</li> 					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2007/04/on-dead-students-guns-and-the-us-constitution.html"><i class="icon-hand-left"></i>On dead students, guns and the US constitution.</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2007/05/xml-xforms-j2ee-job-in-munich.html">XML / XForms / J2EE Job in Munich<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2007/">2007</a> <span class="divider">/</span></li>
  <li><a href="/blog/2007/04/">April</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a>
  </li>
	<li class="pull-right">
	<span class="divider">|</span><a href="/blog/d6plinks/SHWL-6XE78T" title="originally published at /blog/d6plinks/SHWL-6XE78T">SHWL-6XE78T</a>
	</li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I work as "Solution Director Innovation" for HCL Software. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a rel="me" href="https://chaos.social/@stw">Chat on Mastodon</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://notessensei.myspreadshop.com">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="https://www.stickermule.com/u/43c09fe6343315f">Stickers from Stickermule</a></li>
						<li><a href="https://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
						<li><a href="https://github.com/Stwissel">GitHub</a></li>
						<li><a href="https://bitbucket.org/stwissel/">Bitbucket</a></li>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2023 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2007/04/summer-diet-for-your-notes-forms.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/prism.js"></script>
	<script type="text/javascript" src="/blog/js2/admonition.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "B86D24EB022DD5784825726200186F6B");
 		};
	</script>

</body>
</html>
