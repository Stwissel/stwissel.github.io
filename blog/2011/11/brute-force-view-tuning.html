<!DOCTYPE html>
<html lang="en">
<head>
<title>Brute Force View Tuning - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - Brute Force View Tuning" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2011/11/brute-force-view-tuning.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - Brute Force View Tuning" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2002,2022 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Brute Force View Tuning - Complex view selection formulas can slowdown your Domino performance substantially. So keeping them simple is a mandate for high performance applications. One of my favorite approaches here is to have a set of hidden fields in my forms that compute to true or false and then simply use SELECT vsf_Dem" />
<meta name="Keywords"
	content="Show-N-Tell Thursday," />
<meta name="Abstract"
	content="Brute Force View Tuning - Complex view selection formulas can slowdown your Domino performance substantially. So keeping them simple is a mandate for high performance applications. One of my favorite approaches here is to have a set of hidden fields in my forms that compute to true or false and then simply use SELECT vsf_Dem" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/prism.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body class="line-numbers">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

     
    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2011/">2011</a> <span class="divider">/</span></li>
  <li><a href="/blog/2011/11/">November</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a>
  </li>
	<li class="pull-right">
	<span class="divider">|</span><a href="/blog/d6plinks/SHWL-8NW3D5" title="originally published at /blog/d6plinks/SHWL-8NW3D5">SHWL-8NW3D5</a>
	</li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2011/11/doing-one-thing-really-well.html"><i class="icon-hand-left"></i>Doing one thing really well</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2011/11/view-selection-reports.html">View selection reports<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>Brute Force View Tuning</small></h1>
					<hr />
					<div>Complex view selection formulas can slowdown your Domino performance substantially. So keeping them simple is a mandate for high performance applications. One of my favorite approaches here is to have a set of hidden fields in my forms that compute to true or false and then simply use <code>SELECT vsf_Demo</code> as selection formula, where " <i>vfs</i>" stands for "View Selection Formula". In large applications that results in a rather nice performance. Downside of the approach: you need to compute these values on each alteration of a document (but that's not too hard). You can use this method even to retrofit existing applications to improve performance. These are the steps: 
<ol>
 <li>Create a FORM with one field for each view that contains the view selection formula</li>
 <li>Change the view selection formula (short of the <code>SELECT @All</code> ones) to point to that field</li>
 <li>Alter/Create the QuerySave event to: switch to that form, do a computeWithForm, switch back to the original form</li>
 <li>Create a script library with an easy function that takes a document and tells you if the document's selection formulas have been updated</li>
 <li>Add a call to that function to all agents</li>
 <li>Add an agent that runs on "documents created or changed" to catch any case where the two calls above didn't work (e.g. @Formula agents)</li>
 <li>Test, Test, Test</li>
 <li>Enjoy better performance</li>
</ol> The code you need to add to the querySave event is rather light: while this is the code in the querySave event of any form: 
<div class="lotusscript"><span class="kw1">Option</span><span class="kw1">Declare</span>
 <br><span class="kw1">Use</span><span class="st0">"CoreHandlerLibrary"</span>
 <br>
 <br><span class="kw1">Sub</span> Querysave <span class="br0">(</span>Source <span class="kw1">As</span><span class="kw2">Notesuidocument</span>, Continue <span class="kw1">As</span><span class="kw1">Variant</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; <span class="kw1">Dim</span> handler <span class="kw1">As</span> DocumentHandler 
 <br> &nbsp; &nbsp; <span class="kw1">Dim</span> doc <span class="kw1">As</span><span class="kw2">NotesDocument</span>
 <br> &nbsp; &nbsp; <span class="kw1">Set</span> doc = Source. <span class="me1">Document</span>
 <br> &nbsp; &nbsp; <span class="kw1">Set</span> handler = <span class="kw1">New</span> DocumentHandler <span class="br0">(</span>doc <span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; <span class="co1">'We recompute here, since we will save anyway we don't care for the result</span>
 <br> &nbsp; &nbsp; <span class="kw1">Call</span> handler. <span class="me1">docHasChangedAfterUpdate</span><span class="br0">(</span><span class="br0">)</span>
 <br><span class="kw1">End</span><span class="kw1">Sub</span>
</div> Being lazy and notoriously prone to typos I created some code that does step 1 and 2 for me in one go. 
<div class="lotusscript"><span class="coMULTI">%REM<br> &nbsp; &nbsp; Class ViewTuner<br> &nbsp; &nbsp; Description: Creates a form with all view selection formulas and updates all views<br> %END REM</span>
 <br><span class="kw1">Public</span><span class="kw1">Class</span> ViewTuner 
 <br> &nbsp; &nbsp; <span class="kw1">Private</span> ourForm <span class="kw1">As</span><span class="kw2">NotesDOMDocumentNode</span>
 <br> &nbsp; &nbsp; <span class="kw1">Private</span> formName <span class="kw1">As</span><span class="kw1">String</span>
 <br> &nbsp; &nbsp; <span class="kw1">Private</span> fieldNamesUsed <span class="kw1">List</span><span class="kw1">As</span><span class="kw1">String</span>
 <br> &nbsp; &nbsp; <span class="kw1">Private</span> resultStream <span class="kw1">As</span><span class="kw2">NotesStream</span>
 <br> &nbsp; &nbsp; <span class="kw1">Private</span> parser <span class="kw1">As</span><span class="kw2">NotesDOMParser</span>
 <br> &nbsp; &nbsp; <span class="kw1">Private</span> s <span class="kw1">As</span><span class="kw2">NotesSession</span>
 <br> &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; <span class="kw1">Public</span><span class="kw1">Sub</span><span class="kw1">New</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; formName = <span class="st0">"ViewSelectionFormulas"</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span><span class="kw1">me</span>. <span class="me1">s</span> = <span class="kw1">New</span><span class="kw2">NotesSession</span>
 <br> &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">Sub</span>
 <br> &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; <span class="coMULTI">%REM<br> &nbsp; &nbsp; &nbsp; &nbsp; Property Set formToUse<br> &nbsp; &nbsp; &nbsp; &nbsp; Description: Overwrite the formName if necessary<br> &nbsp; &nbsp; %END REM</span>
 <br> &nbsp; &nbsp; <span class="kw1">Public</span><span class="kw1">Property</span><span class="kw1">Set</span> formToUse <span class="kw1">As</span><span class="kw1">String</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">me</span>. <span class="me1">formName</span> = formToUse 
 <br> &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">Property</span>
 <br>
 <br> &nbsp; &nbsp; <span class="coMULTI">%REM<br> &nbsp; &nbsp; &nbsp; &nbsp; Function getEmptyForm<br> &nbsp; &nbsp; &nbsp; &nbsp; Description: Get an empty form DOM in DXL<br> &nbsp; &nbsp; %END REM</span>
 <br> &nbsp; &nbsp; <span class="kw1">Private</span><span class="kw1">Function</span> getEmptyForm <span class="br0">(</span>formName <span class="kw1">As</span><span class="kw1">String</span><span class="br0">)</span> &nbsp; <span class="kw1">As</span><span class="kw2">NotesDOMDocumentNode</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> rawform <span class="kw1">As</span><span class="kw2">NotesStream</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> s <span class="kw1">As</span><span class="kw1">New</span><span class="kw2">NotesSession</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> rawForm = s. <span class="me1">Createstream</span><span class="br0">(</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> resultStream = s. <span class="me1">Createstream</span><span class="br0">(</span><span class="br0">)</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> rawform. <span class="me1">Writetext</span><span class="br0">(</span><span class="st0">"&lt;?xml version='1.0' encoding='utf-8'?&gt;"</span><span class="br0">)</span>
 <br>
</div><div class="lotusscript">
  &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> rawform. <span class="me1">Writetext</span><span class="br0">(</span><span class="st0">"&lt;form name='("</span> + formName + <span class="st0">")' alias='"</span> + formName + <span class="st0">"'&gt;"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> rawform. <span class="me1">Writetext</span><span class="br0">(</span><span class="st0">"&lt;body&gt;&lt;richtext&gt;"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> rawform. <span class="me1">Writetext</span><span class="br0">(</span><span class="st0">"&lt;pardef id='1' hide='web mobile'/&gt;"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> rawform. <span class="me1">Writetext</span><span class="br0">(</span><span class="st0">"&lt;par def='1'&gt;&lt;run&gt;&lt;font color='red'/&gt;&amp;lt;!-- View selection formulas for all views in this application --&amp;gt;&lt;/run&gt;&lt;/par&gt;&lt;/richtext&gt;&lt;/body&gt;&lt;/subform&gt;"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; &nbsp; &nbsp; rawform. <span class="me1">Position</span> = <span class="nu0">0</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> parser = s. <span class="me1">Createdomparser</span><span class="br0">(</span>rawform, resultStream <span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> parser. <span class="me1">Process</span><span class="br0">(</span><span class="br0">)</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> getEmptyForm = parser. <span class="me1">Document</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> rawform. <span class="kw1">Close</span><span class="br0">(</span><span class="br0">)</span>
 <br>
 <br> &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">Function</span>
 <br>
 <br> &nbsp; &nbsp; <span class="coMULTI">%REM<br> &nbsp; &nbsp; &nbsp; &nbsp; Sub addField<br> &nbsp; &nbsp; &nbsp; &nbsp; Description: Add a field to the form DOM<br> &nbsp; &nbsp; %END REM</span>
 <br> &nbsp; &nbsp; <span class="kw1">Public</span><span class="kw1">Function</span> addField <span class="br0">(</span>fieldName <span class="kw1">As</span><span class="kw1">String</span>, fieldFormula <span class="kw1">As</span><span class="kw1">String</span><span class="br0">)</span><span class="kw1">As</span><span class="kw1">Boolean</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">If</span><span class="kw1">IsElement</span><span class="br0">(</span><span class="kw1">me</span>. <span class="me1">fieldNamesUsed</span><span class="br0">(</span>fieldName <span class="br0">)</span><span class="br0">)</span><span class="kw1">Then</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">'We have that field already, can't use it again</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; addField = <span class="kw1">False</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Exit</span><span class="kw1">function</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">If</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> tmp <span class="kw1">As</span><span class="kw2">NotesDOMNodeList</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> insertionpoint <span class="kw1">As</span><span class="kw2">NotesDOMNode</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> newFieldElement <span class="kw1">As</span><span class="kw2">NotesDOMNode</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">'Lazy initialization</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">If</span><span class="kw1">me</span>. <span class="me1">ourForm</span><span class="kw1">Is</span><span class="kw1">Nothing</span><span class="kw1">Then</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span><span class="kw1">me</span>. <span class="me1">ourForm</span> = <span class="kw1">me</span>. <span class="me1">getEmptyForm</span><span class="br0">(</span><span class="kw1">me</span>. <span class="me1">formName</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">If</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> tmp = <span class="kw1">me</span>. <span class="me1">ourForm</span>. <span class="me1">Getelementsbytagname</span><span class="br0">(</span><span class="st0">"run"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> insertionpoint = tmp. <span class="me1">Getitem</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> newFieldElement = <span class="kw1">me</span>. <span class="me1">getFieldElement</span><span class="br0">(</span>fieldname,fieldFormula <span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> insertionpoint. <span class="me1">Appendchild</span><span class="br0">(</span>newFieldElement <span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">me</span>. <span class="me1">fieldNamesUsed</span><span class="br0">(</span>fieldName <span class="br0">)</span> = fieldFormula 
 <br> &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">Function</span>
 <br>
 <br> &nbsp; &nbsp; <span class="coMULTI">%REM<br> &nbsp; &nbsp; &nbsp; &nbsp; Function getFieldElement<br> &nbsp; &nbsp; &nbsp; &nbsp; Description: Generate the XML representing a field with a selection formula<br> &nbsp; &nbsp; %END REM</span>
 <br> &nbsp; &nbsp; <span class="kw1">Private</span><span class="kw1">Function</span> getFieldElement <span class="br0">(</span>fieldname <span class="kw1">As</span><span class="kw1">String</span>,fieldFormula <span class="kw1">As</span><span class="kw1">String</span><span class="br0">)</span><span class="kw1">As</span><span class="kw2">NotesDOMNode</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="coMULTI">%REM<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; We need to create something like this:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;field &nbsp;type='number' kind='computed' name='vsf_DemoView'&gt;&lt;code<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; event='defaultvalue'&gt;&lt;formula&gt;@If(Color="Blue";@True;@False)&lt;/formula&gt;&lt;/code&gt;&lt;/field&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; %END REM</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> result <span class="kw1">As</span><span class="kw2">NotesDOMElementNode</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> code <span class="kw1">As</span><span class="kw2">NotesDOMElementNode</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> formula <span class="kw1">As</span><span class="kw2">NotesDOMElementNode</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> formulaContent <span class="kw1">As</span><span class="kw2">NotesDOMTextNode</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> result = <span class="kw1">me</span>. <span class="me1">ourForm</span>. <span class="me1">Createelementnode</span><span class="br0">(</span><span class="st0">"field"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> result. <span class="me1">Setattribute</span><span class="br0">(</span><span class="st0">"type"</span>, <span class="st0">"number"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> result. <span class="me1">Setattribute</span><span class="br0">(</span><span class="st0">"kind"</span>, <span class="st0">"computed"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> result. <span class="me1">Setattribute</span><span class="br0">(</span><span class="st0">"name"</span>, fieldname <span class="br0">)</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> code = <span class="kw1">me</span>. <span class="me1">ourForm</span>. <span class="me1">Createelementnode</span><span class="br0">(</span><span class="st0">"code"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> code. <span class="me1">Setattribute</span><span class="br0">(</span><span class="st0">"event"</span>, <span class="st0">"defaultvalue"</span><span class="br0">)</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> formula = <span class="kw1">me</span>. <span class="me1">ourForm</span>. <span class="me1">Createelementnode</span><span class="br0">(</span><span class="st0">"formula"</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> formulaContent = <span class="kw1">me</span>. <span class="me1">ourForm</span>. <span class="me1">Createtextnode</span><span class="br0">(</span>fieldFormula <span class="br0">)</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> formula. <span class="me1">appendChild</span><span class="br0">(</span>formulaContent <span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> code. <span class="me1">Appendchild</span><span class="br0">(</span>formula <span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> result. <span class="me1">Appendchild</span><span class="br0">(</span>code <span class="br0">)</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> getFieldElement = result 
 <br> &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">Function</span>
 <br>
 <br> &nbsp; &nbsp; <span class="coMULTI">%REM<br> &nbsp; &nbsp; &nbsp; &nbsp; Function saveSubformIntoDatabase<br> &nbsp; &nbsp; &nbsp; &nbsp; Description: Saves the subform into the database specified<br> &nbsp; &nbsp; %END REM</span>
 <br> &nbsp; &nbsp; <span class="kw1">Function</span> saveSubformIntoDatabase <span class="br0">(</span>db <span class="kw1">As</span><span class="kw2">NotesDatabase</span><span class="br0">)</span><span class="kw1">As</span><span class="kw1">String</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Dim</span> importer <span class="kw1">As</span><span class="kw2">NotesDXLImporter</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">'Write the changes into the stream</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span><span class="kw1">me</span>. <span class="me1">parser</span>. <span class="me1">Serialize</span><span class="br0">(</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">me</span>. <span class="me1">resultStream</span>. <span class="me1">Position</span> = <span class="nu0">0</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> importer = s. <span class="me1">Createdxlimporter</span><span class="br0">(</span><span class="br0">)</span>
 <br>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; importer. <span class="me1">Designimportoption</span> = &nbsp; <span class="nu0">6</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> importer. <span class="me1">Setoutput</span><span class="br0">(</span>db <span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> importer. <span class="me1">Setinput</span><span class="br0">(</span><span class="kw1">me</span>. <span class="me1">resultStream</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">On</span><span class="kw1">Error</span><span class="kw1">Resume</span><span class="kw1">next</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> importer. <span class="me1">Process</span><span class="br0">(</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">If</span><span class="kw1">Err</span> &lt;&gt; <span class="nu0">0</span><span class="kw1">Then</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">me</span>. <span class="me1">resultstream</span>. <span class="me1">Position</span> = <span class="nu0">0</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">MsgBox</span><span class="kw1">me</span>. <span class="me1">resultstream</span>. <span class="me1">Readtext</span><span class="br0">(</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">If</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; &nbsp; &nbsp; saveSubformIntoDatabase = importer. <span class="kw1">Log</span>
 <br>
 <br> &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">Function</span>
 <br>
 <br><span class="kw1">End</span><span class="kw1">Class</span>
</div> For handling changed documents this agents comes in handy: 
<div class="lotusscript"><span class="coMULTI">%REM<br> &nbsp; &nbsp; Created Jan 5, 2010 by Stephan H Wissel/Singapore/IBM<br> &nbsp; &nbsp; Description: Agent Sample how to update changed view selection formulas<br> %END REM</span>
 <br><span class="kw1">Option</span><span class="kw1">Public</span>
 <br><span class="kw1">Option</span><span class="kw1">Declare</span>
 <br>
 <br><span class="kw1">Use</span><span class="st0">"CoreHandlerLibrary"</span>
 <br><span class="kw1">Use</span><span class="st0">"AgentSupport"</span>
 <br><span class="kw1">Sub</span> Initialize <span class="br0">(</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; <span class="kw1">Dim</span> support <span class="kw1">As</span><span class="kw1">New</span> AgentSupport 
 <br> &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; <span class="kw1">Dim</span> doc <span class="kw1">As</span><span class="kw2">NotesDocument</span>
 <br> &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; <span class="kw1">Dim</span> factory <span class="kw1">As</span><span class="kw1">New</span> DH_Factory 
 <br> &nbsp; &nbsp; <span class="kw1">Dim</span> dh <span class="kw1">As</span> DocumentHandler 
 <br> &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; <span class="kw1">Set</span> doc = support. <span class="me1">docToProcess</span><span class="br0">(</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; <span class="kw1">Do</span><span class="kw1">Until</span> doc <span class="kw1">Is</span><span class="kw1">Nothing</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> dh = factory. <span class="me1">getDocumentHandler</span><span class="br0">(</span>Doc <span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">If</span> dh. <span class="me1">docHasChangedAfterUpdate</span><span class="br0">(</span><span class="br0">)</span><span class="kw1">Then</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> dh. <span class="me1">save</span><span class="br0">(</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">End</span><span class="kw1">If</span>&nbsp; &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; &nbsp; &nbsp; 
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Call</span> support. <span class="me1">Updateprocesseddoc</span><span class="br0">(</span>doc <span class="br0">)</span>
 <br> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">Set</span> doc = support. <span class="me1">docToProcess</span><span class="br0">(</span><span class="br0">)</span>
 <br> &nbsp; &nbsp; <span class="kw1">Loop</span>
 <br> &nbsp; &nbsp; 
 <br><span class="kw1">End</span><span class="kw1">Sub</span>
 <br>
</div> You need the <a href="/blog/downloads/2011/CoreHandlerLibrary.lss">CoreHandlerLibrary</a> and the <a href="/blog/downloads/2011/AgentSupport.lss">AgentSupport</a> As usual YMMV</div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 24 November 2011
<span class="divider">|</span>
<a href="/blog/2011/11/brute-force-view-tuning.html#comments">Comments (3)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a> 

						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2011/11/brute-force-view-tuning.html";
						</script>
					</p>
				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_55EA4253EEB017B9482579520006510A" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_55EA4253EEB017B9482579520006510A"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li>
							posted by <b>Nathan T. Freeman</b> on <i>Friday 25 November 2011 AD</i>:<br /> 
  Why not just use folders?
 
							<hr style="clear : both" />
						</li> 						<li>
							posted by <b>ursus</b> on <i>Friday 25 November 2011 AD</i>:<br /> 
  Hi Stefan 
  <br /> 
  <br />Cool idea - love your implementation, well done. 
  <br /> 
  <br />I have inherited a couple of databases that are quite large (40 - 60 GB on an AS/400 or whatever its called this week :o) and they VERY slow. The reason for this is that every document has reader lists attached to it. I am having a difficult time convincing the users that they do not need them :o( There aren't TOO may views so I could apply your technique but was wondering if you could quantify how much of a speed advantage I would get? I would have about 100 DB's that I would use this on and would have to run the conversion agent by hand as I need to have &quot;Full Access Admin&quot; set! 
  <br /> 
  <br />Greetings from Austria 
  <br />Ursus 
  <br /> 
  <br />PS: you at LotusPhere this year? 
  <br />
 
							<hr style="clear : both" />
						</li> 						<li>
							posted by <b>Stephan H. Wissel</b> on <i>Friday 25 November 2011 AD</i>:<br /> 
  In a Notes client app users can mess up by moving documents in an out of folders. So you need extra code to check for all documents, including the unchanged ones, that they are in all Folders they belong to and out any they are not supposed to be in. 
  <br />Also audit gets much harder. Definitely nothing you want to do in a retrofitting exercise. 
  <br /> 
  <img alt="Emoticon smile.gif" src="/blog/images/emoticons/smile.gif" border="0" /> stw
 
							<hr style="clear : both" />
						</li> 					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2011/11/doing-one-thing-really-well.html"><i class="icon-hand-left"></i>Doing one thing really well</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2011/11/view-selection-reports.html">View selection reports<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2011/">2011</a> <span class="divider">/</span></li>
  <li><a href="/blog/2011/11/">November</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a>
  </li>
	<li class="pull-right">
	<span class="divider">|</span><a href="/blog/d6plinks/SHWL-8NW3D5" title="originally published at /blog/d6plinks/SHWL-8NW3D5">SHWL-8NW3D5</a>
	</li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I work as "Solution Director Innovation" for HCL Software. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a rel="me" href="https://chaos.social/@stw">Chat on Mastodon</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://notessensei.myspreadshop.com">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="https://www.stickermule.com/u/43c09fe6343315f">Stickers from Stickermule</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
						<li><a href="https://www.stickermule.com/unlock?ref_id=7600480701&utm_medium=link&utm_source=invite">Stickers by Stickermule</a></li>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2023 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2011/11/brute-force-view-tuning.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/prism.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "55EA4253EEB017B9482579520006510A");
 		};
	</script>

</body>
</html>
