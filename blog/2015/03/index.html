<!DOCTYPE html>
<html lang="en">
<head>
<title>NotesSensei's Blog by month: By Date: March 2015</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - " />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - " />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2003,2022 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Thoughts, Insights and Opinions of Stephan H. Wissel. Topics included:  Salesforce, IBM, JEE, .Net, Software Archtecture, Personcentric Development, Agile Software, SDLC, Singapore and my Twins" />
<meta name="Keywords"
	content="lotus,domino,quickplace,sametime,blog,template,blogging,blogger,hcl,notes,r11,r10,r9,verse,r8,r7,r6,r5,raven,k-station,nsf,ntf,agile,sdlc,jee,ml,salesforce,.net,personcentric,singapore,twins,JavaScript,vertx, nodejs, salesforce, apex, webcomponents" />
<meta name="Abstract"
	content=" Thoughts, Insights and Opinions of Stephan H. Wissel. Topics included: Salesforce, IBM, HCL, JEE, NodeJS, ML, .Net, Vert.x, Software Archtecture, Personcentric Development, Agile Software, SDLC, Singapore and my Twins" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/prism.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>


	<div class="container">

    		<br />
		<header>
			<div id="main" class="hero-unit">
				<h1 id="jumbotron">wissel.net
				</h1>
				<p class="lead">Usability - Productivity - Business - The web -
					Singapore &amp; Twins</p>
			</div>
		</header>

     
		<div class="row-fluid">
			<div class="span9">
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2015/01/index.html"><i class="icon-hand-left"></i>By Date: January 2015</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2015/04/index.html">By Date: April 2015<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<div class="well well-raised">
					<h1>By Date: March 2015</h1>
				</div>
				<article class="well well-raised">
					<h1>
						<small><a href="/blog/2015/03/xpages-xml-document-datasource-take-2.html">XPages XML Document DataSource - Take 2</a></small>
					</h1>
					<hr />
					<div>For a recent project I revisited the idea of <a href="blog/2014/09/rethinking-the-mimedocument-data-source.html">storing XML documents</a> as MIME entries in Notes - while preserving some of the fields for use in views and the Notes client. <a href="https://twitter.com/gidgerby">Jesse</a> suggested I should have a look at <a href="http://www.javacodegeeks.com/2014/11/java-annotations-tutorial.html">annotations</a>. Turns out, it is easier that it sound. To create an annotation that works at runtime, I need a one liner only: 
<br><code>@Retention(RetentionPolicy.RUNTIME) public @interface ItemPathMappings { String[] value(); }</code>
<br> To further improve usefulness, I created a "BaseConfiguration" my classes will inherit from, that contains the common properties I want all my classes (and documents) to have. You might want to adjust it to your needs: 
<br>
<pre><code class="language-java">
ackage com.notessensei.domino;
import java.io.Serializable;
import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlAttribute;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlRootElement;
/**
 * Common methods implemented by all classes to be Dominoserialized
 */
@XmlRootElement(name = "BaseConfiguration")
@XmlAccessorType(XmlAccessType.NONE)
public abstract class BaseConfiguration implements Serializable, Comparable&lt;BaseConfiguration&gt; {
    private static final long serialVersionUID = 1L;
    @XmlAttribute(name = "name")
    protected String          name;

    public int compareTo(BaseConfiguration bc) {
        return this.toString().compareTo(bc.toString());
    }
    public String getName() {
        return this.name;
    }
    public BaseConfiguration setName(String name) {
        this.name = name;
        return this;
    }
    @Override
    public String toString() {
        return Serializer.toJSONString(this);
    }
    public String toXml() {
        return Serializer.toXMLString(this);
    }
}
</code></pre>
<br> The next building block is my Serializer support with a couple of static methods, that make dealing with XML and JSON easier. 
<pre><code class="language-java">
package com.notessensei.domino;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.io.PrintWriter;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBException;
import javax.xml.bind.Marshaller;
import javax.xml.bind.Unmarshaller;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;

/**
 * Helper class to serialize / deserialize from/to JSON and XML
 */
public class Serializer {

    public static String toJSONString(Object o) {
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        try {
            Serializer.saveJSON(o, out);
        } catch (IOException e) {
            return e.getMessage();
        }
        return out.toString();
    }

    public static String toXMLString(Object o) {
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        try {
            Serializer.saveXML(o, out);
        } catch (Exception e) {
            return e.getMessage();
        }
        return out.toString();
    }

    public static void saveJSON(Object o, OutputStream out) throws IOException {
        GsonBuilder gb = new GsonBuilder();
        gb.setPrettyPrinting();
        gb.disableHtmlEscaping();
        Gson gson = gb.create();
        PrintWriter writer = new PrintWriter(out);
        gson.toJson(o, writer);
        writer.flush();
        writer.close();
    }

    public static void saveXML(Object o, OutputStream out) throws Exception {
        JAXBContext context = JAXBContext.newInstance(o.getClass());
        Marshaller m = context.createMarshaller();
        m.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, Boolean.TRUE);
        m.marshal(o, out);
    }

    public static org.w3c.dom.Document getDocument(Object source) throws ParserConfigurationException, JAXBException {
        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
        DocumentBuilder db = dbf.newDocumentBuilder();
        org.w3c.dom.Document doc = db.newDocument();
        JAXBContext context = JAXBContext.newInstance(source.getClass());
        Marshaller m = context.createMarshaller();
        m.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, Boolean.TRUE);
        m.marshal(source, doc);
        return doc;
    }

    @SuppressWarnings("rawtypes")
    public static Object fromByte(byte[] source, Class targetClass) throws JAXBException {
        ByteArrayInputStream in = new ByteArrayInputStream(source);
        JAXBContext context = JAXBContext.newInstance(targetClass);
        Unmarshaller um = context.createUnmarshaller();
        return targetClass.cast(um.unmarshal(in));
    }
}
</code></pre>
<br> The key piece is for the XML serialization/deserialization to work is the abstract class <code>AbstractXmlDocument</code>. That class contains the load and save methods that interact with Domino's MIME capabilities as well as executing the XPath expressions to store the Notes fields. The implementations of this abstract class will have annotations that combine the Notes field name, the type and the XPath expression. An implementation would look like this: 
<br>
<pre><code class="language-java">
package com.notessensei.domino.xmldocument;
import javax.xml.bind.JAXBException;
import lotus.domino.Database;
import lotus.domino.Document;
import lotus.domino.NotesException;
import lotus.domino.Session;
import com.notessensei.domino.ApplicationConfiguration;
import com.notessensei.domino.Serializer;
import com.notessensei.domino.xmldocument.AbstractXmlDocument.ItemPathMappings;

// The ItemPathMappings are application specific!
@ItemPathMappings({ "Subject|Text|/Application/@name",
     "Description|Text|/Application/description",
     "Unid|Text|/Application/@unid",
     "Audience|Text|/Application/Audiences/Audience",
     "NumberOfViews|Number|count(/Application/Views/View)",
     "NumberOfForms|Number|count(/Application/Forms/Form)",
     "NumberOfColumns|Number|count(/Application/Views/View/columns/column)",
     "NumberOfFields|Number|count(/Application/Forms/Form/fields/field)",
     "NumberOfActions|Number|count(//action)" })
public class ApplicationXmlDocument extends AbstractXmlDocument {

    public ApplicationXmlDocument(String formName) {
        super(formName);
    }

    @SuppressWarnings("unchecked")
    @Override
    public ApplicationConfiguration load(Session session, Document d) {

        ApplicationConfiguration result = null;
        try {
            result = (ApplicationConfiguration) Serializer.fromByte(this.loadFromMime(session, d), ApplicationConfiguration.class);
        } catch (JAXBException e) {
            e.printStackTrace();
        }
        try {
            result.setUnid(d.getUniversalID());
        } catch (NotesException e) {
            // No Action Taken
        }
        return result;
    }

    @SuppressWarnings("unchecked")
    @Override
    public ApplicationConfiguration load(Session session, Database db, String unid) {
        Document doc;
        try {
            doc = db.getDocumentByUNID(unid);
            if (doc != null) {
                ApplicationConfiguration result = this.load(session, doc);
                doc.recycle();
                return result;
            }

        } catch (NotesException e) {
            e.printStackTrace();
        }

        return null;
    }
}
</code></pre> ## 
<br> Here is the base class: 
<br>
<pre><code class="language-java">
package com.notessensei.domino.xmldocument;

import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.util.Collection;
import java.util.HashSet;
import java.util.Map;
import java.util.Scanner;
import java.util.TreeMap;

import javax.xml.bind.JAXBException;
import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.OutputKeys;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;
import javax.xml.xpath.XPath;
import javax.xml.xpath.XPathExpressionException;
import javax.xml.xpath.XPathFactory;

import lotus.domino.Item;
import lotus.domino.MIMEEntity;
import lotus.domino.MIMEHeader;
import lotus.domino.NotesException;
import lotus.domino.Stream;

import org.w3c.dom.Document;
import org.xml.sax.InputSource;

import com.notessensei.domino.BaseConfiguration;
import com.notessensei.domino.Serializer;

@XmlAccessorType(XmlAccessType.NONE)
public abstract class AbstractXmlDocument {

    /**
     * Holds the the definition that extracts data from an XML Document into
     * a Notes Item. Will be triggered by an annotation in the implementation class
     */
    public class FieldExtractDefinition implements Comparable&lt;FieldExtractDefinition&gt; {

        public final static String ELEMENT_SEPARATOR = "\\|";
        private final String       path;
        private final String       itemName;
        private final FieldType    fieldType;

        /**
         * Creates a FieldExtractDefinition from a raw String in the format:
         * Itemname|FieldType|XPath
         *
         * @param rawString
         */
        public FieldExtractDefinition(String rawString) {
            Scanner scanner = new Scanner(rawString);
            scanner.useDelimiter(ELEMENT_SEPARATOR);
            this.itemName = scanner.next();
            this.fieldType = FieldType.valueOf(scanner.next().toUpperCase());
            // The rest of the elements make the XPath
            this.path = scanner.nextLine().substring(1);
        }

        public int compareTo(FieldExtractDefinition fed) {
            return this.toString().compareTo(fed.toString());
        }

        public FieldType getDataType() {
            return fieldType;
        }

        public String getItemName() {
            return itemName;
        }

        public String getXPath() {
            return path;
        }

        @Override
        public String toString() {
            return Serializer.toJSONString(this);
        }

    }

    public enum FieldType {
        NUMBER, TEXT, NAMES, READER, AUTHOR, DATE
    }

    @Retention(RetentionPolicy.RUNTIME)
    public @interface ItemPathMappings {

        String[] value();

    }

    private final String                             MIME_FIELD_NAME = "Body";
    private final String                             FORM_NAME       = "Form";

    private final Collection&lt;FieldExtractDefinition&gt; definitions     = new HashSet&lt;FieldExtractDefinition&gt;();

    private String                                   formName;

    private org.w3c.dom.Document                     style           = null;

    public AbstractXmlDocument(String formName) {
        this.formName = formName;
        // Now load the annotations
        ItemPathMappings ipm = this.getClass().getAnnotation(ItemPathMappings.class);
        if (ipm != null) {
            for (String oneMapping : ipm.value()) {
                this.definitions.add(new FieldExtractDefinition(oneMapping));
            }
        }
    }

    public String getFormName() {
        return this.formName;
    }

    public org.w3c.dom.Document getStyle() {
        return this.style;
    }

    public abstract &lt;T extends BaseConfiguration&gt; T load(lotus.domino.Session session, lotus.domino.Database db, String unid);

    public abstract &lt;T extends BaseConfiguration&gt; T load(lotus.domino.Session session, lotus.domino.Document d);

    public boolean save(lotus.domino.Session session, lotus.domino.Document d, Object source) {
        boolean success = true;
        try {
            boolean oldMime = session.isConvertMime();
            session.setConvertMime(false);

            // Save the form to be sure
            if (this.formName != null) {
                d.replaceItemValue(FORM_NAME, this.formName);
            }

            // We must remove the mime body - otherwise it will not work
            if (d.hasItem(MIME_FIELD_NAME)) {
                d.removeItem(MIME_FIELD_NAME);
            }

            org.w3c.dom.Document domDoc = Serializer.getDocument(source);

            // Create the top mime entry
            MIMEEntity root = d.createMIMEEntity(MIME_FIELD_NAME);
            MIMEHeader header = root.createHeader("Content-Type");
            header.setHeaderVal("multipart/mixed");

            MIMEEntity body = root.createChildEntity();
            MIMEHeader bheader = body.createHeader("Content-Type");
            bheader.setHeaderVal("multipart/alternative");

            MIMEEntity textMime = body.createChildEntity();
            MIMEHeader textHeader = textMime.createHeader("Content-Type");
            String cType = (this.style == null) ? "text/plain" : "text/html";
            textHeader.setHeaderVal(cType);

            Stream stream2 = session.createStream();
            stream2.write(this.dom2Byte(domDoc, this.style));
            textMime.setContentFromBytes(stream2, cType + "; charset=\"UTF-8\"", MIMEEntity.ENC_NONE);

            MIMEEntity xmlMime = body.createChildEntity();
            MIMEHeader xmlHeader = xmlMime.createHeader("Content-Type");
            xmlHeader.setHeaderVal("application/xml");

            Stream stream = session.createStream();
            stream.write(this.dom2Byte(domDoc, null));
            xmlMime.setContentFromBytes(stream, "application/xml; charset=\"UTF-8\"", MIMEEntity.ENC_NONE);

            // Now extract the fields
            this.extractFields(domDoc, d, body);

            session.setConvertMime(oldMime);
        } catch (NotesException e) {
            success = false;
            e.printStackTrace();
        } catch (ParserConfigurationException e) {
            success = false;
            e.printStackTrace();
        } catch (JAXBException e) {
            success = false;
            e.printStackTrace();
        }

        return success;
    }

    public Map&lt;String, String&gt; extractMappingResults(Object source) throws ParserConfigurationException, JAXBException {
        Map&lt;String, String&gt; result = new TreeMap&lt;String, String&gt;();
        org.w3c.dom.Document domDoc = (source instanceof org.w3c.dom.Document) ? (org.w3c.dom.Document) source : Serializer
                    .getDocument(source);
        for (FieldExtractDefinition f : this.definitions) {
            String candidate = this.extractOneField(domDoc, f.getXPath());
            if (candidate != null) {
                result.put(f.getItemName(), candidate);
            }
        }

        return result;
    }

    public void setFormName(String formName) {
        this.formName = formName;
    }

    public AbstractXmlDocument setPrettyPrintStyle(org.w3c.dom.Document style) {
        this.style = style;
        return this;
    }

    public void setStyle(InputStream styleStream) {

        Document d = null;
        final DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setValidating(false); // Will blow if set to true
        factory.setNamespaceAware(true);

        try {
            InputSource source = new InputSource(styleStream);
            final DocumentBuilder docb = factory.newDocumentBuilder();
            d = docb.parse(source);

        } catch (final Exception e) {
            e.printStackTrace();
            d = null;
        }

        if (d == null) {
            System.out.println("DOM from stream generation failed:\n");
        }

        this.style = d;
    }

    /**
     * Loads XML from Notes document and returns the content as bytes to
     * be marshalled into a Java object creation
     *
     * @param session
     *            NotesSession
     * @param d
     *            Document with MIME content
     * @return bytes for object instance creation
     */
    protected byte[] loadFromMime(lotus.domino.Session session, lotus.domino.Document d) {
        ByteArrayOutputStream out = new ByteArrayOutputStream();

        try {
            boolean oldMime = session.isConvertMime();
            session.setConvertMime(false);

            // Load the TOP mime entitiy - must be multipart/mixed
            MIMEEntity root = d.getMIMEEntity(MIME_FIELD_NAME);
            if (root != null &amp;&amp; root.getContentType().equals("multipart") &amp;&amp; root.getContentSubType().equals("mixed")) {
                // We check for the body whtou should be multipart/alternate
                MIMEEntity body = root.getFirstChildEntity();
                if (body != null &amp;&amp; body.getContentType().equals("multipart") &amp;&amp; body.getContentSubType().equals("alternative")) {
                    // Now we go after Content-Type = application/xml
                    MIMEEntity payload = body.getFirstChildEntity();

                    while (payload != null &amp;&amp; !payload.getContentSubType().equals("xml")) {
                        System.out.println(payload.getContentType());
                        System.out.println(payload.getContentSubType());
                        MIMEEntity nextMime = payload.getNextEntity();
                        payload.recycle();
                        payload = nextMime;
                    }

                    if (payload != null) {
                        Stream notesStream = session.createStream();
                        payload.getContentAsBytes(notesStream);
                        notesStream.setPosition(0);
                        notesStream.getContents(out);
                        notesStream.recycle();
                    }
                }

            }
            ;
            session.setConvertMime(oldMime);
        } catch (NotesException e) {
            e.printStackTrace();
        }

        return out.toByteArray();
    }

    private byte[] dom2Byte(Document dom, Document stylesheet) {
        StreamResult xResult = null;
        DOMSource source = null;
        final ByteArrayOutputStream out = new ByteArrayOutputStream();
        Transformer transformer = null;

        try {
            final TransformerFactory tFactory = TransformerFactory.newInstance();
            xResult = new StreamResult(out);
            source = new DOMSource(dom);

            if (stylesheet != null) {
                final DOMSource style = new DOMSource(stylesheet);
                transformer = tFactory.newTransformer(style);
            } else {
                transformer = tFactory.newTransformer();
            }

            // We don't want the XML declaration in front
            transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");

            transformer.transform(source, xResult);

        } catch (final Exception e) {
            e.printStackTrace();
        }

        return out.toByteArray();

    }

    private void extractFields(Document domDoc, lotus.domino.Document d, MIMEEntity body) {
        Map&lt;String, String&gt; itemList = null;
        try {
            itemList = this.extractMappingResults(domDoc);
        } catch (ParserConfigurationException e1) {
            e1.printStackTrace();
        } catch (JAXBException e1) {
            e1.printStackTrace();
        }

        if (itemList == null) {
            return;
        }

        for (FieldExtractDefinition f : this.definitions) {

            String fName = f.getItemName();
            String fValue = itemList.get(fName);

            if (!fName.equalsIgnoreCase(MIME_FIELD_NAME) &amp;&amp; !(fValue == null)) {
                // We can't allow to overwrite the body or write empty values
                try {
                    MIMEHeader h = body.createHeader(fName);
                    h.setHeaderVal(fValue);
                    Item curItem = d.replaceItemValue(fName, fValue);
                    FieldType ft = f.getDataType();
                    if (ft.equals(FieldType.AUTHOR)) {
                        curItem.setAuthors(true);
                    } else if (ft.equals(FieldType.READER)) {
                        curItem.setReaders(true);
                    }

                } catch (NotesException e) {
                    e.printStackTrace();
                }
            }

        }
    }

    private String extractOneField(Document domDoc, String xPathString) {

        Object exprResult = null;
        final XPath xpath = XPathFactory.newInstance().newXPath();
        final MagicNamespaceContext nsc = new MagicNamespaceContext();
        xpath.setNamespaceContext(nsc);

        try {
            exprResult = xpath.evaluate(xPathString, domDoc);
        } catch (final XPathExpressionException e) {
            System.err.println("XPATH failed for " + xPathString);
            System.err.println(e.getMessage());
        }
        // if it failed we abort
        if (exprResult == null) {
            return null;
        }

        return exprResult.toString();

    }
}
</code></pre>
<br> As time permits I will provide a full working example. 
<br> YMMV!</div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 05 March 2015
<span class="divider">|</span>
<a href="/blog/2015/03/xpages-xml-document-datasource-take-2.html#comments">Comments (0)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/xpages.html">XPages</a> 

						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2015/03/xpages-xml-document-datasource-take-2.html";
						</script>
					</p>
				</article>
				<article class="well well-raised">
					<h1>
						<small><a href="/blog/2015/03/develop-local-deploy-cloud-global-java-and-couchdb.html">Develop local, deploy (cloud) global - Java and CouchDB</a></small>
					</h1>
					<hr />
					<div>Leaving the cosy world of <a href="http://www-03.ibm.com/software/products/en/ibmdominodesigner">Domino Designer</a> behind, venturing into <a href="http://www.bluemix.net">IBM Bluemix</a>, Java and <a href="https://cloudant.com/">Cloudant</a>, I'm challenged with a new set of task to master. Spoiled by Notes where <code>Ctrl+O</code> gives you instant access to any application, regardless of being stored locally or on a server I struggled a little with my usual practise of 
<h3>develop local, deploy (Bluemix) global</h3> The task at hand is to develop a Java <a href="https://developer.ibm.com/wasdev/blog/2013/03/29/introducing_the_liberty_profile/">Liberty</a> based application, that uses CouchDB/Cloudant as its NoSQL data store. I want to be able to develop/test the application while being completely <a href="http://offlinefirst.org/">offline</a> and deploy it to Bluemix. I don't want any code to have conditions offline/online, but rather use configuration of the runtimes for it. 
<br> Luckily I have access to <a href="https://twitter.com/Sai_Vennam">really smart developers</a> (thx Sai), so I succeeded. 
<br> This is what I found out, I needed to do. The list serves as reference for myself and others living in a latency/bandwidth challenged environment. 
<ol>
 <li><b>Read</b>: There are a number of articles around, that contain bits and pieces of the information required. In no specific order: 
  <ul>
   <li>Refresh on Java <a href="http://docs.oracle.com/cd/E19857-01/820-1639/bhano/index.html">Naming References and Binding Information</a></li>
   <li>Sai Vennam introduces <a href="https://developer.ibm.com/bluemix/2014/07/08/cloudant_on_bluemix/">Cloudant on Bluemix</a></li>
   <li><a href="http://www-01.ibm.com/support/knowledgecenter/SSAW57_8.5.5/com.ibm.websphere.wlp.nd.doc/ae/twlp_setup.html?cp=SSAW57_8.5.5%2F1-6-0">Setting up the liberty profile</a></li>
   <li><a href="https://www-01.ibm.com/support/knowledgecenter/was_beta_liberty/com.ibm.websphere.wlp.nd.multiplatform.doc/ae/twlp_couchdb_create.html">Cloudant in the liberty profile</a></li>
  </ul> </li>
 <li><b>Install</b>: This is a big jump forward. No more looking for older versions, but rather bleeding edge. Tools of the trade: 
  <ul>
   <li><a href="http://git-scm.com/">GIT</a>. When you are on Windows or Mac, try the nice GUI of <a href="http://sourcetreeapp.com/">SourceTree</a>, and don't forget to learn <a href="https://github.com/nvie/gitflow">git-flow</a> (best explained <a href="https://www.atlassian.com/git/">here</a>)</li>
   <li>A current version of the <a href="http://eclipse.org/downloads/">Eclipse IDE</a> (Luna at the time of writing, the Java edition suffices)</li>
   <li>The <a href="https://developer.ibm.com/wasdev/downloads/liberty-profile-beta/">liberty profile beta</a>. The Beta is necessary, since it contains some of the features, notably couchdb, which are available in Bluemix by default. Use the option to drag the link onto your running Eclipse client</li>
   <li><a href="http://maven.apache.org/">Maven</a> - the Java way to resolve dependencies (guess where bower and npm got their ideas from)</li>
   <li><a href="http://curl.haxx.se/">CURL</a> (that's my little command line ninja stuff, you can get away without it)</li>
   <li>Apache <a href="http://couchdb.apache.org/">CouchDB</a></li>
  </ul> </li>
 <li><b>Configure</b>: Java loves indirection. So there are a few moving parts as well (details below) 
  <ul>
   <li>The Cloudant service in Bluemix</li>
   <li>The JNDI name in the web.xml. Bluemix will discover the Cloudant service and create the matching entries in the server.xml automagically</li>
   <li>A local profile for a server running the Liberty 9.0 profile</li>
   <li>The configuration for the local CouchDB in the local server.xml</li>
   <li>Replication between your local CouchDB instance and the Cloudant server database (if you want to keep the data in sync)</li>
  </ul> </li>
</ol> The flow of the data access looks like this 
<br>
<img src="/blog/images/2015/BlueMixLocal.jpg" border="0" alt="Develop local, deploy global"></div>
					<hr />
 <a href="/blog/2015/03/develop-local-deploy-cloud-global-java-and-couchdb.html">Read more</a>
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 02 March 2015
<span class="divider">|</span>
<a href="/blog/2015/03/develop-local-deploy-cloud-global-java-and-couchdb.html#comments">Comments (3)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/bluemix.html">Bluemix</a>  <a href="/blog/categories/couchdb.html">CouchDB</a>  <a href="/blog/categories/java.html">Java</a> 

						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2015/03/develop-local-deploy-cloud-global-java-and-couchdb.html";
						</script>
					</p>
				</article>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2015/01/index.html"><i class="icon-hand-left"></i>By Date: January 2015</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2015/04/index.html">By Date: April 2015<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>

			<div class="span3">
				<aside id="sidebar_reference" class="well">
					<h5>Reference</h5>
					<ol style="list-style-type: upper-roman; padding-left: 30px;">
						<li><a style="display: inline;"
							href="/blog/2012/04/extracting-data-from-domino-into-pdf-using-xslt-and-xslfo-part-1.html">Use
								XSL:FO rendering (Domino)</a></li>
						<li><a target="_blank" href="https://wissel.net/blog/imprint.html">old references (IBM)</a></li>
					</ol>
				</aside>

				<aside id="sidebar_categoriesArchive" class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Categories</li>
						<li ><a href="/blog/categories/afterhours.html">After hours</a></li>
						<li ><a href="/blog/categories/apex.html">Apex</a></li>
						<li ><a href="/blog/categories/blog.html">Blog</a></li>
						<li ><a href="/blog/categories/bluemix.html">Bluemix</a></li>
						<li ><a href="/blog/categories/buddhakids.html">Buddhakids</a></li>
						<li ><a href="/blog/categories/business.html">Business</a></li>
						<li ><a href="/blog/categories/buyingbroadband.html">Buying Broadband</a></li>
						<li ><a href="/blog/categories/caldav.html">calDAV</a></li>
						<li ><a href="/blog/categories/cloudcomputing.html">Cloud Computing</a></li>
						<li ><a href="/blog/categories/continuousintegration.html">Continuous integration</a></li>
						<li ><a href="/blog/categories/couchdb.html">CouchDB</a></li>
						<li ><a href="/blog/categories/coursera.html">Coursera</a></li>
						<li ><a href="/blog/categories/cycling.html">Cycling</a></li>
						<li ><a href="/blog/categories/docker.html">Docker</a></li>
						<li ><a href="/blog/categories/domino.html">Domino</a></li>
						<li ><a href="/blog/categories/dxlmagic.html">DXLMagic</a></li>
						<li ><a href="/blog/categories/elearning.html">eLearning</a></li>
						<li ><a href="/blog/categories/github.html">GitHub</a></li>
						<li ><a href="/blog/categories/gonephisching.html">Gone Phisching</a></li>
						<li ><a href="/blog/categories/grpc.html">gRPC</a></li>
						<li ><a href="/blog/categories/gtd.html">GTD</a></li>
						<li ><a href="/blog/categories/hclnotes.html">HCL Notes</a></li>
						<li ><a href="/blog/categories/heroku.html">Heroku</a></li>
						<li ><a href="/blog/categories/https.html">HTTP(S)</a></li>
						<li ><a href="/blog/categories/ibm.html">IBM</a></li>
						<li ><a href="/blog/categories/ibmlotus.html">IBM - Lotus</a></li>
						<li ><a href="/blog/categories/ibmnotes.html">IBM Notes</a></li>
						<li ><a href="/blog/categories/intercultural.html">Intercultural</a></li>
						<li ><a href="/blog/categories/java.html">Java</a></li>
						<li ><a href="/blog/categories/javascript.html">JavaScript</a></li>
						<li ><a href="/blog/categories/learning.html">Learning</a></li>
						<li ><a href="/blog/categories/lightning.html">Lightning</a></li>
						<li ><a href="/blog/categories/linux.html">Linux</a></li>
						<li ><a href="/blog/categories/lotus.html">Lotus</a></li>
						<li ><a href="/blog/categories/lotusnotes.html">Lotus Notes</a></li>
						<li ><a href="/blog/categories/lotusphere.html">Lotusphere</a></li>
						<li ><a href="/blog/categories/mac.html">Mac</a></li>
						<li ><a href="/blog/categories/macos.html">macOS</a></li>
						<li ><a href="/blog/categories/mobile.html">Mobile</a></li>
						<li ><a href="/blog/categories/networking.html">Networking</a></li>
						<li ><a href="/blog/categories/nginx.html">nginx</a></li>
						<li ><a href="/blog/categories/nodejs.html">NodeJS</a></li>
						<li ><a href="/blog/categories/nodered.html">NodeRED</a></li>
						<li ><a href="/blog/categories/nokia.html">Nokia</a></li>
						<li ><a href="/blog/categories/omnisophie.html">Omnisophie</a></li>
						<li ><a href="/blog/categories/opensource.html">OpenSource</a></li>
						<li ><a href="/blog/categories/pmd.html">PMD</a></li>
						<li ><a href="/blog/categories/protocols.html">Protocols</a></li>
						<li ><a href="/blog/categories/reactive.html">Reactive</a></li>
						<li ><a href="/blog/categories/salesforce.html">Salesforce</a></li>
						<li ><a href="/blog/categories/sametime.html">Sametime</a></li>
						<li ><a href="/blog/categories/sfdx.html">SFDX</a></li>
						<li ><a href="/blog/categories/showntellthursday.html">Show-N-Tell Thursday</a></li>
						<li ><a href="/blog/categories/singapore.html">Singapore</a></li>
						<li ><a href="/blog/categories/socialbusiness.html">SocialBusiness</a></li>
						<li ><a href="/blog/categories/software.html">Software</a></li>
						<li ><a href="/blog/categories/sywtbadd.html">SYWTBADD</a></li>
						<li ><a href="/blog/categories/technology.html">Technology</a></li>
						<li ><a href="/blog/categories/travel.html">Travel</a></li>
						<li ><a href="/blog/categories/twins.html">Twins</a></li>
						<li ><a href="/blog/categories/umsys.html">UMsys</a></li>
						<li ><a href="/blog/categories/unittesting.html">UnitTesting</a></li>
						<li ><a href="/blog/categories/vertx.html">vert.x</a></li>
						<li ><a href="/blog/categories/webcomponents.html">WebComponents</a></li>
						<li ><a href="/blog/categories/webdevelopment.html">WebDevelopment</a></li>
						<li ><a href="/blog/categories/workflow.html">Workflow</a></li>
						<li ><a href="/blog/categories/writingchinese.html">Writing Chinese</a></li>
						<li ><a href="/blog/categories/xml.html">XML</a></li>
						<li ><a href="/blog/categories/xpages.html">XPages</a></li>
						<li class="nav-header">Archives</li>
						<li ><a href="/blog/2002/">2002</a></li>
						<li ><a href="/blog/2003/">2003</a></li>
						<li ><a href="/blog/2004/">2004</a></li>
						<li ><a href="/blog/2005/">2005</a></li>
						<li ><a href="/blog/2006/">2006</a></li>
						<li ><a href="/blog/2007/">2007</a></li>
						<li ><a href="/blog/2008/">2008</a></li>
						<li ><a href="/blog/2009/">2009</a></li>
						<li ><a href="/blog/2010/">2010</a></li>
						<li ><a href="/blog/2011/">2011</a></li>
						<li ><a href="/blog/2012/">2012</a></li>
						<li ><a href="/blog/2013/">2013</a></li>
						<li ><a href="/blog/2014/">2014</a></li>
						<li ><a href="/blog/2015/">2015</a></li>
						<li ><a href="/blog/2016/">2016</a></li>
						<li ><a href="/blog/2017/">2017</a></li>
						<li ><a href="/blog/2018/">2018</a></li>
						<li ><a href="/blog/2019/">2019</a></li>
						<li ><a href="/blog/2020/">2020</a></li>
						<li ><a href="/blog/2021/">2021</a></li>
						<li ><a href="/blog/2022/">2022</a></li>
						<li ><a href="/blog/all.html" title="That's a long list!">Complete archive</a></li>
					</ul>
				</aside>

				<aside id="sidebar_visitors" class="well">
					<h5>Visitors</h5>
<script type="text/javascript" id="clstr_globe" src="//cdn.clustrmaps.com/globe.js?d=dyaFRPfPewNw_y5-9frkSPIp1gvX8qjkkF-LpRyuvQs"></script>
				</aside>

			</div>
		</div>
	</div>
	<!-- Footer	================================================== -->
		<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I work as "Solution Director Innovation" for HCL Software. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://notessensei.myspreadshop.com">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
						<li><a rel="me" href="https://chaos.social/@stw">Chat on Mastodon</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2022 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

		<script type="text/javascript" src="/blog/js/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/prism.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>

</body>
</html>
