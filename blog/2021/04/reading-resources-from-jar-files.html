<!DOCTYPE html>
<html lang="en">
<head>
<title>Reading Resources from JAR Files - NotesSensei's Blog</title>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72033-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible"  content="chrome=1" />
<meta http-equiv="Content-Language" content="en" />
<meta rel="meta" link="application/rdf+xml" content="/foaf.rdf" />
<meta property="og:title"     content="wissel.net - Reading Resources from JAR Files" />
<meta property="og:type"      content="blog" />
<meta property="og:url"       content="https://wissel.net/blog/2021/04/reading-resources-from-jar-files.html" />
<meta property="og:image"     content="//www.wissel.net/blog/img/wisselnet.gif" />
<meta property="og:site_name" content="wissel.net" />
<meta name="viewport"         content="width=device-width, initial-scale=1.0" />
<meta name="ROBOTS"           content="FOLLOW, NOIMAGEINDEX" />
<meta name="DC.Title"         content="NotesSensei's Weblog - Reading Resources from JAR Files" />
<meta name="Author"           content="Stephan H. Wissel" />
<meta name="ICBM"             content="1.2994, 103.8425" />
<meta name="Copyright"        content="2002,2020 Stephan H. Wissel - Creative commons licence" />
<meta name="twitter:site"     content="@notessensei" />
<meta name="twitter:card"     content="summary" />
<meta name="xing:author"      content="https://www.xing.com/profile/StephanH_Wissel" />
<meta name="description"
	content="Reading Resources from JAR Files - One interesting challenge I encountered is the need or ability to make an Java application extensible by providing additional classes and configuation. Ideally extension should happen by dropping a properly crafted JAR file into a specified location and restard the server. Along the line I learned a" />
<meta name="Keywords"
	content="Java," />
<meta name="Abstract"
	content="Reading Resources from JAR Files - One interesting challenge I encountered is the need or ability to make an Java application extensible by providing additional classes and configuation. Ideally extension should happen by dropping a properly crafted JAR file into a specified location and restard the server. Along the line I learned a" />
<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/blog/style/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/responsive.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/wisselblog.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/main.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/blogcodedisplay.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/shariff.complete.css" />
<link rel="stylesheet" type="text/css" href="/blog/style/markdown.css" />
<link rel="stylesheet" type="text/css" href="/blog/css/prism.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16" />


<link rel="alternate" type="application/rss+xml" title="RSS News Feed" href="https://feeds.feedburner.com/Wisselnetfeed" />

<meta name="Revisit-After" content="90 Days" />
</head>
<body class="line-numbers">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<a class="btn btn-navbar" data-toggle="collapse"
				data-target=".nav-collapse"> <span class="icon-bar"></span> <span
				class="icon-bar"></span> <span class="icon-bar"></span>
			</a> <a class="brand" href="/">wissel.net</a>
			<div class="nav-collapse">
				<ul class="nav">
					<li><a href="/index.html">Home</a></li>
					<li class="active"><a href="/blog/">Blog</a></li>
					<li><a href="/blog/series.html">Series</a></li>
					<li><a href="/blog/downloads/">Downloads</a></li>
					<li><a href="https://stwissel.github.io/presentations/" title="Presentations maintained on GitHub">Presentations</a></li>
					<li><a href="/blog/imprint.html">About / Imprint</a></li>
				</ul>
				<form action="//www.google.com/cse" id="cse-search-box"
					class="navbar-search pull-right">
					<div>
						<input type="hidden" name="cx"
							value="partner-pub-4562257798204150:muo14ionenw" /> <input
							type="hidden" name="ie" value="ISO-8859-1" /> <input type="text"
							name="q" class="search-query span2" placeholder="Search" />
						<!-- input type="submit" name="sa" value="Search" class="btn btn-small"/-->
					</div>
				</form>
			</div>
		</div>
	</div>
<div class="navbar-spacer"></div>

	<div class="container">
    		<br />
		<header>
			<div id="mainsmall"  class="hero-unit">
				<h2>wissel.net</h2>
				<p>Usability - Productivity - Business - The web - Singapore &amp; Twins</p>
			</div>
		</header>

     
    <ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2021/">2021</a> <span class="divider">/</span></li>
  <li><a href="/blog/2021/04/">April</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/java.html">Java</a>
  </li>
</ul>

		<div class="row-fluid">
			<div class="span12">
				
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2021/01/collecting-java-streams.html"><i class="icon-hand-left"></i>Collecting Java Streams</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2021/10/streaming-couchdb-data.html">Streaming CouchDB data<i class="icon-hand-right"></i></a>
					</li>
				</ul>

				<article class="well well-raised">
					<h1><small>Reading Resources from JAR Files</small></h1>
					<hr />
					<div><p>One interesting challenge I <a href="https://www.theprojectthatshallnotbenamed.com/">encountered</a> is the need or ability to make an Java application extensible by providing additional classes and configuation. Ideally extension should happen by dropping a properly crafted JAR file into a specified location and restard the server. Along the line I learned about Java's classpath. This is what is to be shared here.</p>
<h3>Act one: onto the classpath</h3>
<p>When you start off with Java, you would expect, that you simply can set the <a href="https://docs.oracle.com/javase/tutorial/essential/environment/paths.html">classpath</a> varible either using an environment variable or the <code>java -cp</code> parameter. Then you learn the <a href="https://stackoverflow.com/questions/11922681/differences-between-java-cp-and-java-jar">hard way</a>, that <code>java -jar</code> and <code>java -cp</code> are mutually exclusive. After a short flirt with <a href="https://product.hubspot.com/blog/the-fault-in-our-jars-why-we-stopped-building-fat-jars">fatJAR</a>, you end up with a directory structure like this:</p>
<p><img src="/blog/images/2021/ApplicationDirectoryStructure.png" alt="Directory Structure"></p>
<p>The secreingredient to make this work is the manifest file inside the <code>myApp.jar</code>. It needs to be told to put all jar files in <code>libs</code> onto the classpath too. In <a href="https://maven.apache.org/">maven</a>, it looks like this:</p>
<pre><code class="language-xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
    &lt;version&gt;${maven.jar.plugin.version}&lt;/version&gt;
    &lt;configuration&gt;
        &lt;archive&gt;
            &lt;manifest&gt;
                &lt;mainClass&gt;com.hcl.domino.keep.Launch&lt;/mainClass&gt;
            &lt;/manifest&gt;
            &lt;manifestEntries&gt;
                &lt;Class-Path&gt;.&lt;/Class-Path&gt;
                &lt;Class-Path&gt;libs/*&lt;/Class-Path&gt;
            &lt;/manifestEntries&gt;
        &lt;/archive&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre>
<p>Now, that all JARS are successfully availble on the classspath, we can try to retrieve them.</p><h3>Act two: find a resource</h3>
<p>Reliably opening resources in an Java app needs to be done using an <a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html">InputStream</a>. It is the only way to happily ignore if the resource is inside a JAR or happens to live on the file system. Why is that important? Well, in a Docker deployment I usually don't package my applications as Jars, since they live inside a container already. We don't want to play <a href="https://en.wikipedia.org/wiki/Inception">Inception</a>.</p>
<p>There are two method returning a resource as an InputStream:</p>
<ul>
 <li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getResourceAsStream-java.lang.String-"><code>Class.getResourceAsStream</code></a></li>
 <li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ClassLoader.html#getResourceAsStream-java.lang.String-"><code>ClassLoader.getResourceAsStream</code></a></li>
</ul>
<p>On the surface they do the same, but on a closer look slightly different. <code>Class.getResourceAsStream</code> looks for resources at the path location of the class itself, so when a resource is at the root of the jar, you need a leading <code>/</code>, e.g. <code>/config.json</code>. <code>ClassLoader.getResourceAsStream</code> on the other hand would return <code>null</code> when the resource name is prefixed with <code>/</code>, while without it works as expected e.g. <code>config.json</code>.</p>
<p>I use <a href="https://github.com/google/guava/wiki/IOExplained">Google Guava's</a> I/O system to read a resource into a String:</p>
<pre><code class="language-java">  static Optional&lt;String&gt; stream2String(final InputStream in) {
    try {
      ByteSource byteSource = new ByteSource() {
        @Override
        public InputStream openStream() {
          return in;
        }
      };

      return Optional.of(byteSource.asCharSource(StandardCharsets.UTF_8).read());
    } catch (IOException e) {
      e.printStackTrace();
      return Optional.empty();
    }
  }
</code></pre>
<p>Getting one file is only half the Story, we want all of them</p>
<h3>Act three: find all resources</h3>
<p>The method we need for this is <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ClassLoader.html#getResources-java.lang.String-"><code>ClassLoader.getResources</code></a>. It returns an <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Enumeration.html">Enumeration</a> of URLs. You might be tempted to use <a href="https://docs.oracle.com/javase/8/docs/api/java/net/URL.html#getFile--"><code>URL.getFile()</code></a> to get hands on the file, but you will fail when the resource is inside a jar, indicated by the URL starting with <code>jar:file:/</code>. The solution is the same as for single resources: use the InputStream provided by <a href="https://docs.oracle.com/javase/8/docs/api/java/net/URL.html#openStream--"><code>URL.openStream()</code></a>. I use this helper:</p>
<pre><code class="language-java">String readFromURL(final URL source) {
    try (InputStream in = source.openStream()) {
      return stream2String(in).orElseThrow(() -&gt; new Exception("Can't read " + source));
    } catch (Exception e) {
      return e.getMessage();
    }

  }
</code></pre>
<p>You can test this with a quick code snippet, it will provide you with 3 resources:</p>
<pre><code class="language-java">void allTheFileContent() throws IOException {
    Enumeration&lt;URL&gt; r = this.getClass().getClassLoader().getResources("settings.json");
    Collections.list(r).stream()
        .map(this::readFromURL)
        .forEach(System.out::println);
  }
</code></pre>
<h3>Act four: merge</h3>
<p>In my use case, I need a combined <code>settings.json</code> file. Luckily the <a href="https://vertx.io">Eclipse vert.x</a> framework provides a <a href="https://vertx.io/docs/apidocs/io/vertx/core/json/JsonObject.html#mergeIn-io.vertx.core.json.JsonObject-"><code>JsonObject.mergeIn()</code></a> method that does the heavy lifting. Add a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collector.html"><code>Collector</code></a> and you get:</p>
<pre><code class="language-java">JsonObject merge(final String resourceName) throws IOException {
    Enumeration&lt;URL&gt; r = this.getClass().getClassLoader().getResources(resourceName);
    return Collections.list(r).stream()
        .map(this::readFromURL)
        .map(JsonObject::new)
        .collect(Collector.of(() -&gt; new JsonObject(),
            JsonObject::mergeIn,
            JsonObject::mergeIn));
  }
</code></pre>
<p>Mission accomplished: all settings merged. As usual YMMV</p></div>
					<hr />
					<p>
						Posted by <a rel="author" href="https://plus.google.com/u/0/+StephanWissel">
Stephan H Wissel</a> on 29 April 2021
<span class="divider">|</span>
<a href="/blog/2021/04/reading-resources-from-jar-files.html#comments">Comments (0)</a>
<span class="divider">|</span>
categories:  <a href="/blog/categories/java.html">Java</a> 

						<script type="text/javascript">
							var permaLink = "https://wissel.net/blog/2021/04/reading-resources-from-jar-files.html";
						</script>
					</p>
				</article>
				<a name="comments"></a>
				<div class="well well-raised" style="text-align : center">
				<button class="btn btn-lg btn-info" data-toggle="collapse" data-target="#commentform_ce4a84f0-a8d6-11eb-af9d-1184c78a15d1" type="button">
		            Add your comment...&nbsp;&nbsp;<span class="glyphicon glyphicon-comment"></span>
	            </button>
	            </div>
				<div id="commentform_ce4a84f0-a8d6-11eb-af9d-1184c78a15d1"  class="collapse"></div>
				<div class="well well-raised">
					<h4>Comments</h4>
					<ol id="commentList">
						<li id="nocomments">
							<h5>No comments yet, be the first to comment</h5>
						</li>
					</ol>
				</div>
				<ul class="breadcrumb pull-centre">
					<li><a href="/blog/2021/01/collecting-java-streams.html"><i class="icon-hand-left"></i>Collecting Java Streams</a>
						<span class="divider">|</span></li>
					<li><a href="/blog/"><i class="icon-hand-up"></i>Main</a></li>
					<span class="divider">|</span>
					<li><a href="/blog/2021/10/streaming-couchdb-data.html">Streaming CouchDB data<i class="icon-hand-right"></i></a>
					</li>
				</ul>

			</div>
		</div>
		<ul class="breadcrumb">
  <li><a href="/blog/">Blog</a> <span class="divider">/</span></li>
  <li><a href="/blog/2021/">2021</a> <span class="divider">/</span></li>
  <li><a href="/blog/2021/04/">April</a></li>
  <li class="pull-right">
    <span class="divider">|</span><a href="/blog/categories/java.html">Java</a>
  </li>
</ul>

	</div>
	<footer>
		<div class="container">
			<div class="row">
				<div class="span2">
					<h4>About Me</h4>
					<p>
						I work as "Solution Director Innovation" for HCL Software. I'm based in Singapore.
						<g:plusone size="small" href="https://wissel.net/blog/"></g:plusone>
					</p>
					<a href="//stackoverflow.com/users/131021/stwissel">
					<img src="//stackoverflow.com/users/flair/131021.png" width="208" height="58" alt="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer" title="profile for stwissel at Stack Overflow, Q&amp;A for professional and enthusiast programmer">
				</a>
				</div>
				<div class="span2">
					<h4>Contact</h4>
					<ul>
						<li><a href="https://www.twitter.com/notessensei">Twitter</a></li>
						<li><a href="https://sg.linkedin.com/in/notessensei">LinkedIn</a></li>
						<li><a href="https://www.xing.com/profile/StephanH_Wissel">XING</a></li>
						<li><a href="https://notessensei.myspreadshop.com">NotesSensei's Spreadshirt shop</a></li>
						<li><a href="http://about.me/stephan.wissel/#" title="Another identity site, nothing much here">About Me</a></li>
						<li><a rel="me" href="https://chaos.social/@stw">Chat on Mastodon</a></li>
					</ul>
				</div>
				<div class="span8">
					<h4>Disclaimer</h4>
					<p>This site is in no way affiliated, endorsed, sanctioned,
						supported, nor enlightened by my current or previous employers.
						I may be an employee, but the opinions, theories, facts, etc.
						presented here are my own and are in now way given in any official
						capacity. In short, these are my words and this is my site, not
						my current or former employers' - and don't even begin to think otherwise.</p>
					<p>
						<b>&copy; 2003 - 2022 Stephan H. Wissel - some rights reserved</b> as
						listed here: <a rel="license"
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"><img
							alt="Creative Commons License" style="border-width: 0"
							src="//licensebuttons.net/l/by-nc-sa/3.0/88x31.png" /></a>
						Unless otherwise labeled by its originating author, the content
						found on this site is made available under the terms of an <a
							href="//creativecommons.org/licenses/by-nc-sa/3.0/"
							target="_blank"
							title="Learn more about the creative commons  Attribution-ShareAlike License">Attribution/NonCommercial/ShareAlike
							Creative Commons License</a>, with the exception that no rights are
						granted -- since they are not mine to grant -- in any logo,
						graphic design, trademarks or trade names of any type. Code
						samples and code downloads on this site are, unless otherwise
						labeled, made available under an <a
							href="//www.apache.org/licenses/LICENSE-2.0.html">Apache
							2.0</a> license. Other license models are available on written
						request and written confirmation.
					</p>
				</div>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		var permaLink = "https://wissel.net/blog/2021/04/reading-resources-from-jar-files.html";
	</script>
		<script type="text/javascript" src="/blog/js/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="/blog/js/bootstrap.js"></script>
	<script type="text/javascript" src="/blog/js/blogmain.js"></script>
    <script type="text/javascript" src="/blog/js2/prism.js"></script>
	<script src="//www.google-analytics.com/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-72033-1";
		urchinTracker();
	</script>
	<script type="text/javascript" src="//feeds.feedburner.com/~s/Wisselnet?i=https://wissel.net/blog" charset="utf-8"></script>

		<script src="/blog/js2/mustache.js"></script>
	<script src="/blog/js2/blogcomments.js"></script>
	<script type="text/javascript" src="/blog/js2/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/blog/js2/Markdown.Editor.js"></script>
	<script type="text/javascript" src="//www.google.com/recaptcha/api.js"></script>
	<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
	<script type="text/javascript">
		var onloadCallback = function() {
    		renderComment("6LcBxUEUAAAAACzKM8YKb-RVVaIZ3MN6F1Z8FB_4", "ce4a84f0-a8d6-11eb-af9d-1184c78a15d1");
 		};
	</script>

</body>
</html>
